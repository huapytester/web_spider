{
    "title": "Python 标准库笔记(1) — String模块",
    "create_date": "2017/08/21",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/jhao104/blog/829775\">j_hao104</a>   </div><blockquote><p>String模块包含大量实用常量和类，以及一些过时的遗留功能，并还可用作字符串操作。</p></blockquote>\n<h1>1. 常用方法</h1>\n<table>\n<tbody>\n<tr>\n<th>常用方法</th>\n<th>描述</th>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td>str.capitalize()</td>\n<td>把字符串的首字母大写</td>\n</tr>\n<tr>\n<td>str.center(width)</td>\n<td>将原字符串用空格填充成一个长度为width的字符串，原字符串内容居中</td>\n</tr>\n<tr>\n<td>str.count(s)</td>\n<td>返回字符串s在str中出现的次数</td>\n</tr>\n<tr>\n<td>str.decode(encoding=’UTF-8’,errors=’strict’)</td>\n<td>以指定编码格式解码字符串</td>\n</tr>\n<tr>\n<td>str.encode(encoding=’UTF-8’,errors=’strict’)</td>\n<td>以指定编码格式编码字符串</td>\n</tr>\n<tr>\n<td>str.endswith(s)</td>\n<td>判断字符串str是否以字符串s结尾</td>\n</tr>\n<tr>\n<td>str.find(s)</td>\n<td>返回字符串s在字符串str中的位置索引，没有则返回-1</td>\n</tr>\n<tr>\n<td>str.index(s)</td>\n<td>和find()方法一样，但是如果s不存在于str中则会抛出异常</td>\n</tr>\n<tr>\n<td>str.isalnum()</td>\n<td>如果str至少有一个字符并且都是字母或数字则返回True,否则返回False</td>\n</tr>\n<tr>\n<td>str.isalpha()</td>\n<td>如果str至少有一个字符并且都是字母则返回True,否则返回False</td>\n</tr>\n<tr>\n<td>str.isdigit()</td>\n<td>如果str只包含数字则返回 True 否则返回 False</td>\n</tr>\n<tr>\n<td>str.islower()</td>\n<td>如果str存在区分大小写的字符，并且都是小写则返回True 否则返回False</td>\n</tr>\n<tr>\n<td>str.isspace()</td>\n<td>如果str中只包含空格，则返回 True，否则返回 False</td>\n</tr>\n<tr>\n<td>str.istitle()</td>\n<td>如果str是标题化的(单词首字母大写)则返回True，否则返回False</td>\n</tr>\n<tr>\n<td>str.isupper()</td>\n<td>如果str存在区分大小写的字符，并且都是大写则返回True 否则返回False</td>\n</tr>\n<tr>\n<td>str.ljust(width)</td>\n<td>返回一个原字符串左对齐的并使用空格填充至长度width的新字符串</td>\n</tr>\n<tr>\n<td>str.lower()</td>\n<td>转换str中所有大写字符为小写</td>\n</tr>\n<tr>\n<td>str.lstrip()</td>\n<td>去掉str左边的不可见字符</td>\n</tr>\n<tr>\n<td>str.partition(s)</td>\n<td>用s将str切分成三个值</td>\n</tr>\n<tr>\n<td>str.replace(a, b)</td>\n<td>将字符串str中的a替换成b</td>\n</tr>\n<tr>\n<td>str.rfind(s)</td>\n<td>类似于 find()函数，不过是从右边开始查找</td>\n</tr>\n<tr>\n<td>str.rindex(s)</td>\n<td>类似于 index()，不过是从右边开始</td>\n</tr>\n<tr>\n<td>str.rjust(width)</td>\n<td>返回一个原字符串右对齐的并使用空格填充至长度width的新字符串</td>\n</tr>\n<tr>\n<td>str.rpartition(s)</td>\n<td>类似于 partition()函数,不过是从右边开始查找</td>\n</tr>\n<tr>\n<td>str.rstrip()</td>\n<td>去掉str右边的不可见字符</td>\n</tr>\n<tr>\n<td>str.split(s)</td>\n<td>以s为分隔符切片str</td>\n</tr>\n<tr>\n<td>str.splitlines()</td>\n<td>按照行分隔，返回一个包含各行作为元素的列表</td>\n</tr>\n<tr>\n<td>str.startswith(s)</td>\n<td>检查字符串str是否是以s开头，是则返回True，否则返回False</td>\n</tr>\n<tr>\n<td>str.strip()</td>\n<td>等于同时执行rstrip()和lstrip()</td>\n</tr>\n<tr>\n<td>str.title()</td>\n<td>返回”标题化”的str,所有单词都是以大写开始，其余字母均为小写</td>\n</tr>\n<tr>\n<td>str.upper()</td>\n<td>返回str所有字符为大写的字符串</td>\n</tr>\n<tr>\n<td>str.zfill(width)</td>\n<td>返回长度为 width 的字符串，原字符串str右对齐，前面填充0</td>\n</tr>\n</tbody>\n</table>\n<h1>2.字符串常量</h1>\n<table>\n<tbody>\n<tr>\n<th>常数</th>\n<th>含义</th>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td>string.ascii_lowercase</td>\n<td>小写字母’abcdefghijklmnopqrstuvwxyz’</td>\n</tr>\n<tr>\n<td>string.ascii_uppercase</td>\n<td>大写的字母’ABCDEFGHIJKLMNOPQRSTUVWXYZ’</td>\n</tr>\n<tr>\n<td>string.ascii_letters</td>\n<td>ascii_lowercase和ascii_uppercase常量的连接串</td>\n</tr>\n<tr>\n<td>string.digits</td>\n<td>数字0到9的字符串:’0123456789’</td>\n</tr>\n<tr>\n<td>string.hexdigits</td>\n<td>字符串’0123456789abcdefABCDEF’</td>\n</tr>\n<tr>\n<td>string.letters</td>\n<td>字符串’abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ’</td>\n</tr>\n<tr>\n<td>string.lowercase</td>\n<td>小写字母的字符串’abcdefghijklmnopqrstuvwxyz’</td>\n</tr>\n<tr>\n<td>string.octdigits</td>\n<td>字符串’01234567’</td>\n</tr>\n<tr>\n<td>string.punctuation</td>\n<td>所有标点字符</td>\n</tr>\n<tr>\n<td>string.printable</td>\n<td>可打印的字符的字符串。包含数字、字母、标点符号和空格</td>\n</tr>\n<tr>\n<td>string.uppercase</td>\n<td>大学字母的字符串’ABCDEFGHIJKLMNOPQRSTUVWXYZ’</td>\n</tr>\n<tr>\n<td>string.whitespace</td>\n<td>空白字符 ‘\\t\\n\\x0b\\x0c\\r ‘</td>\n</tr>\n</tbody>\n</table>\n<h1>3.字符串模板Template</h1>\n<p>通过string.Template可以为Python定制字符串的替换标准,下面是具体列子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5bf6970705823\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;from string import Template\r\n&gt;&gt;&gt;s = Template('$who like $what')\r\n&gt;&gt;&gt;print s.substitute(who='i', what='python')\r\ni like python\r\n\r\n&gt;&gt;&gt;print s.safe_substitute(who='i') # 缺少key时不会抛错\r\ni like $what\r\n\r\n&gt;&gt;&gt;Template('${who}LikePython').substitute(who='I') # 在字符串内时使用{}\r\n'ILikePython'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5bf6970705823-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5bf6970705823-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5bf6970705823-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5bf6970705823-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5bf6970705823-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5bf6970705823-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5bf6970705823-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5bf6970705823-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5bf6970705823-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5bf6970705823-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5bf6970705823-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Template</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5bf6970705823-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'$who like $what'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5bf6970705823-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">who</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'i'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">what</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'python'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5bf6970705823-4\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">like </span><span class=\"crayon-v\">python</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5bf6970705823-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5bf6970705823-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">safe_substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">who</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'i'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 缺少key时不会抛错</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5bf6970705823-7\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">what</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5bf6970705823-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5bf6970705823-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'${who}LikePython'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">who</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'I'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 在字符串内时使用{}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5bf6970705823-10\"><span class=\"crayon-s\">'ILikePython'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>Template还有更加高级的用法，可以通过继承string.Template, 重写变量delimiter(定界符)和idpattern(替换格式), 定制不同形式的模板。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c01763001337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport string\r\n\r\ntemplate_text = ''' Delimiter : $de Replaced : %with_underscore Ingored : %notunderscored '''\r\n\r\nd = {'de': 'not replaced',\r\n     'with_underscore': 'replaced',\r\n     'notunderscored': 'not replaced'}\r\n\r\nclass MyTemplate(string.Template):\r\n    # 重写模板 定界符(delimiter)为\"%\", 替换模式(idpattern)必须包含下划线(_)\r\n    delimiter = '%'\r\n    idpattern = '[a-z]+_[a-z]+'\r\n\r\nprint string.Template(template_text).safe_substitute(d)  # 采用原来的Template渲染\r\n\r\nprint MyTemplate(template_text).safe_substitute(d)  # 使用重写后的MyTemplate渲染</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c01763001337-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c01763001337-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-3\"><span class=\"crayon-v\">template_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''' Delimiter : $de Replaced : %with_underscore Ingored : %notunderscored '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-5\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'de'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not replaced'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'with_underscore'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'replaced'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-7\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'notunderscored'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not replaced'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Template</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 重写模板 定界符(delimiter)为\"%\", 替换模式(idpattern)必须包含下划线(_)</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">delimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">idpattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'[a-z]+_[a-z]+'</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-14\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">template_text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">safe_substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 采用原来的Template渲染</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c01763001337-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c01763001337-16\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">template_text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">safe_substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 使用重写后的MyTemplate渲染</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c05826681336\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n Delimiter : not replaced\r\n    Replaced : %with_underscore\r\n    Ingored : %notunderscored\r\n\r\n    Delimiter : $de\r\n    Replaced : replaced\r\n    Ingored : %notunderscored</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c05826681336-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c05826681336-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c05826681336-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c05826681336-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c05826681336-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c05826681336-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c05826681336-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c05826681336-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replaced</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c05826681336-2\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Replaced</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">with_underscore</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c05826681336-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Ingored</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">notunderscored</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c05826681336-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c05826681336-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Delimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">de</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c05826681336-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Replaced</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replaced</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c05826681336-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Ingored</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">notunderscored</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>原生的Template只会渲染界定符为$的情况，重写后的MyTemplate会渲染界定符为%且替换格式带有下划线的情况。</p>\n<h1>4.常用字符串技巧</h1>\n<ul>\n<li>1.反转字符串</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c09758834489\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; s = '1234567890'\r\n&gt;&gt;&gt; print s[::-1]\r\n0987654321</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c09758834489-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c09758834489-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c09758834489-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c09758834489-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1234567890'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c09758834489-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c09758834489-3\"><span class=\"crayon-cn\">0987654321</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<ul>\n<li>2.关于字符串链接</li>\n</ul>\n<p>尽量使用join()链接字符串，因为’+’号连接n个字符串需要申请n-1次内存,使用join()需要申请1次内存。</p>\n<ul>\n<li>3.固定长度分割字符串</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c0d762046526\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; import re\r\n&gt;&gt;&gt; s = '1234567890'\r\n&gt;&gt;&gt; re.findall(r'.{1,3}', s)  # 已三个长度分割字符串\r\n['123', '456', '789', '0']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c0d762046526-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c0d762046526-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c0d762046526-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c0d762046526-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c0d762046526-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c0d762046526-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1234567890'</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c0d762046526-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'.{1,3}'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 已三个长度分割字符串</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c0d762046526-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'123'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'456'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'789'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<ul>\n<li>4.使用()括号生成字符串<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c10863086632\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsql = ('SELECT count() FROM table '\r\n       'WHERE id = \"10\" '\r\n       'GROUP BY sex')\r\n\r\nprint sql\r\n\r\nSELECT count() FROM table WHERE id = \"10\" GROUP BY sex</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c10863086632-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c10863086632-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c10863086632-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c10863086632-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c10863086632-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d742ba5c10863086632-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c10863086632-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c10863086632-1\"><span class=\"crayon-v\">sql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'SELECT count() FROM table '</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c10863086632-2\"><span class=\"crayon-h\">       </span><span class=\"crayon-s\">'WHERE id = \"10\" '</span></div><div class=\"crayon-line\" id=\"crayon-599d742ba5c10863086632-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-s\">'GROUP BY sex'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c10863086632-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c10863086632-5\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sql</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d742ba5c10863086632-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d742ba5c10863086632-7\"><span class=\"crayon-k \">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GROUP </span><span class=\"crayon-e\">BY </span><span class=\"crayon-v\">sex</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</li>\n</ul>\n<ul>\n<li>5.将print的字符串写到文件</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d742ba5c14488412889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; print &gt;&gt; open(\"somefile.txt\", \"w+\"), \"Hello World\"  # Hello World将写入文件somefile.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d742ba5c14488412889-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d742ba5c14488412889-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"somefile.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"w+\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello World\"</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># Hello World将写入文件somefile.txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88379\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88379votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88379\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,标准库",
    "article_url": "http://python.jobbole.com/88379/",
    "url_object_id": "1ac1141293da7d106955f278ab2ed126",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e634580.png"
    ]
}
{
    "title": "用不到 50 行的 Python 代码构建最小的区块链",
    "create_date": "2017/08/03",
    "agree_num": 2,
    "comment_num": 1,
    "fav_num": 5,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/crypto-currently/lets-build-the-tiniest-blockchain-e70965a248b\">Gerald Nash</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32571\">黑色巧克力</a>   </div><h1><strong>引用</strong></h1>\n<div id=\"news_content\"><em>译者注：随着比特币的不断发展,它的底层技术区块链也逐步走进公众视野,引起大众注意。本文用不到50行的Python代码构建最小的数据区块链，简单介绍了区块链去中心化的结构与其实现原理。</em><br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/88528e83991bcdd96c2b921bf3543581.png\"><img class=\"aligncenter wp-image-88249 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/88528e83991bcdd96c2b921bf3543581.png\" alt=\"56358984-283f-3a7f-8812-6bb8f9c14090\" width=\"887\" height=\"535\"></a></div>\n<p>尽管一些人认为区块链是一个等待问题的解决方案，但毫无疑问，这种新技术是计算机的奇迹。但是，区块链到底是什么呢?</p>\n<h1><strong>区块链</strong></h1>\n<p><a href=\"https://www.google.com/search?q=blockchain+definition&amp;oq=blockchain+definition&amp;aqs=chrome.0.0l6.2941j0j7&amp;sourceid=chrome&amp;ie=UTF-8\" target=\"_blank\">它是比特币或其他加密货币进行交易的数字账本，账本按时间顺序记录并对外公开。</a></p>\n<p>在更一般的术语中，它是一个公共数据库，新数据存储在一个名为块的容器中，并被添加到一个不可变链（后来的区块链）中添加了过去的数据。在比特币和其他加密货币的情况下，这些数据是一组交易记录。当然，数据可以是任何类型的。</p>\n<p>区块链技术已经催生了新的、完全数字化的货币，如比特币和莱特币，这些货币并不是由中央政府发行或管理的。因此为那些认为今天的银行系统是骗局或终将失败的人带来了新的自由。区块链所包含的以太坊技术对分布式计算进行了变革创新，它引入了一些有趣的概念，比如<a href=\"https://blockgeeks.com/guides/smart-contracts/\" target=\"_blank\">智能合约</a>。</p>\n<p>在本文中，我将用不到50行的Python2代码来做一个简单的区块链。我称它为SnakeCoin。</p>\n<p>首先将定义块将是什么样子。在区块链中，每个块都存储一个时间戳和一个索引。在SnakeCoin中，需要把两者都存储起来。为了确保整个区块链的完整性，每个块都有一个自动识别散列。与比特币一样，每个块的散列将是块索引、时间戳、数据和前块哈希的加密哈希。数据可以是你想要的任何东西。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d74df4eef9744255481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib as hasher\r\n\r\nclass Block:\r\n  def __init__(self, index, timestamp, data, previous_hash):\r\n    self.index = index\r\n    self.timestamp = timestamp\r\n    self.data = data\r\n    self.previous_hash = previous_hash\r\n    self.hash = self.hash_block()\r\n\r\n  def hash_block(self):\r\n    sha = hasher.sha256()\r\n    sha.update(str(self.index) + \r\n               str(self.timestamp) + \r\n               str(self.data) + \r\n               str(self.previous_hash))\r\n    return sha.hexdigest()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4eef9744255481-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4eef9744255481-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">hashlib </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hasher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Block</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timestamp</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">previous_hash</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hash_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-10\"> </div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">hash_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hasher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sha256</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sha</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-14\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-15\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4eef9744255481-16\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4eef9744255481-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sha</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hexdigest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>这一步后有块结构，但现在是创建区块链，所以需要向实际的链中添加块。如前所述，每个块都需要上一个块的信息。但是按照这个说法就有一个问题，区块链的第一个区块是如何到达那里的呢？不得不说，第一个块，或者说是起源块，它是一个特殊的块。在很多情况下，它是手动添加的，或者有独特的逻辑允许添加。</p>\n<p>下面将创建一个函数简单地返回一个起源块以便产生第一个区块。这个块是索引0，它具有任意的数据值和“前一个哈希”参数中的任意值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d74df4ef04994145910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport datetime as date\r\n\r\ndef create_genesis_block():\r\n  # Manually construct a block with\r\n  # index zero and arbitrary previous hash\r\n  return Block(0, date.datetime.now(), \"Genesis Block\", \"0\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef04994145910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef04994145910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef04994145910-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef04994145910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef04994145910-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef04994145910-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d74df4ef04994145910-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef04994145910-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d74df4ef04994145910-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">create_genesis_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef04994145910-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Manually construct a block with</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef04994145910-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># index zero and arbitrary previous hash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef04994145910-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Genesis Block\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>现在已经创建好了起源块，接下来需要一个函数，以便在区块链中生成后续的块。这个函数将把链中的前一个块作为参数，创建要生成的块的数据，并使用适当的数据返回新块。当新的块哈希信息来自前面的块时，区块链的完整性会随着每个新块而增加。如果不这样做，外部组织就更容易“改变过去”，用全新的方式取代已有的链条。这一系列的散列可以作为加密的证据，有助于确保一旦将块添加到区块链，它就不能被替换或删除。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d74df4ef08598541271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef next_block(last_block):\r\n  this_index = last_block.index + 1\r\n  this_timestamp = date.datetime.now()\r\n  this_data = \"Hey! I'm block \" + str(this_index)\r\n  this_hash = last_block.hash\r\n  return Block(this_index, this_timestamp, this_data, this_hash)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef08598541271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef08598541271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef08598541271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef08598541271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef08598541271-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef08598541271-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d74df4ef08598541271-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">next_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef08598541271-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">this_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef08598541271-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">this_timestamp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef08598541271-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">this_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hey! I'm block \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">this_index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef08598541271-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">this_hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef08598541271-6\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">this_index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this_timestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this_hash</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>大部分的工作已经完成，现在可以创建区块链了。在这次的示例中，区块链本身是一个简单的Python列表。列表的第一个元素是起源块。当然，还需要添加后续的块，因为SnakeCoin是最小的区块链，这里只添加20个新的块。可以用for循环来生成新块。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d74df4ef0c629893152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Create the blockchain and add the genesis block\r\nblockchain = [create_genesis_block()]\r\nprevious_block = blockchain[0]\r\n\r\n# How many blocks should we add to the chain\r\n# after the genesis block\r\nnum_of_blocks_to_add = 20\r\n\r\n# Add blocks to the chain\r\nfor i in range(0, num_of_blocks_to_add):\r\n  block_to_add = next_block(previous_block)\r\n  blockchain.append(block_to_add)\r\n  previous_block = block_to_add\r\n  # Tell everyone about it!\r\n  print \"Block #{} has been added to the blockchain!\".format(block_to_add.index)\r\n  print \"Hash: {}\\n\".format(block_to_add.hash)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d74df4ef0c629893152-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d74df4ef0c629893152-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-1\"><span class=\"crayon-p\"># Create the blockchain and add the genesis block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-2\"><span class=\"crayon-v\">blockchain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">create_genesis_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-3\"><span class=\"crayon-v\">previous_block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-5\"><span class=\"crayon-p\"># How many blocks should we add to the chain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-6\"><span class=\"crayon-p\"># after the genesis block</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-7\"><span class=\"crayon-v\">num_of_blocks_to_add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-9\"><span class=\"crayon-p\"># Add blocks to the chain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-10\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_of_blocks_to_add</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">block_to_add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">previous_block</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block_to_add</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">previous_block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_to_add</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Tell everyone about it!</span></div><div class=\"crayon-line\" id=\"crayon-599d74df4ef0c629893152-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Block #{} has been added to the blockchain!\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block_to_add</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d74df4ef0c629893152-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hash: {}\\n\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block_to_add</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>下面来测试一下目前产生的区块链。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0272fca4b155e5b6db7b9cb8812300b1.png\"><img class=\"aligncenter wp-image-88250 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0272fca4b155e5b6db7b9cb8812300b1.png\" alt=\"56358984-283f-3a7f-8812-6bb8f9c14090\" width=\"800\" height=\"969\"></a></p>\n<p>看到了吧，这就是区块链。如果希望在控制台中查看更多信息，可以<a href=\"https://gist.github.com/aunyks/8f2c2fd51cc17f342737917e1c2582e2\" target=\"_blank\">编辑完整的源文件</a>并打印每个块的时间戳或数据。</p>\n<p>这就是SnakeCoin要提供的所有东西。为了使SnakeCoin规模达到今天生产区块链的规模，必须添加更多的功能，比如服务器层，以跟踪多台机器上的链变化，以及在给定的时间段内限制添加的块数量的<a href=\"https://en.bitcoin.it/wiki/Proof_of_work\" target=\"_blank\">工作算法</a>。</p>\n<p>如果想了解更多的技术信息，可以在<a href=\"https://bitcoin.org/bitcoin.pdf\" target=\"_blank\">这里</a>查看原始的比特币白皮书。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88248\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88248votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88248\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,区块链,比特币",
    "article_url": "http://python.jobbole.com/88248/",
    "url_object_id": "563012d9b4f2362bef7851c524e87b0f",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/88528e83991bcdd96c2b921bf3543581.png"
    ]
}
{
    "title": "使用 MPI for Python 并行化遗传算法",
    "create_date": "2017/08/03",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h2 id=\"前言\">前言</h2>\n<p>本文中作者使用MPI的Python接口mpi4py来将自己的遗传算法框架GAFT进行多进程并行加速。并对加速效果进行了简单测试。</p>\n<p>项目链接:</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/PytLab/gaft\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">https://github.com/PytLab/gaft</span></a></li>\n<li>PyPI: <a href=\"https://pypi.python.org/pypi/gaft\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">https://pypi.python.org/pypi/gaft</span></a></li>\n</ul>\n<h2 id=\"正文\">正文</h2>\n<p>我们在用遗传算法优化目标函数的时候，函数通常都是高维函数，其导数一般比较难求取。这样我们的适应度函数计算通常都是比较费时的计算。</p>\n<p>例如在使用遗传算法寻找最优结构时候通常需要调用量化软件进行第一性原理计算结构的total energy，这是非常费时的过程; 例如我们优化力场参数的时候，以力场计算出的能量同基准能量之前的误差作为适应度，也需要调用相应的力场程序获取总能量来求取，同样这个过程也是相对耗时的。</p>\n<p>这就会导致一个问题，当我们的<strong>种群比较大</strong>的时候，我们需要利用适应度信息来产生下一代种群，这时候每一代繁殖的过程将会很耗时。但有幸的是，种群的选择交叉变异过程对于种群中的个体都是<strong>相互独立</strong>的过程，我们可以将这一部分进行并行处理来加速遗传算法的迭代。</p>\n<h3 id=\"使用mpi4py\">使用mpi4py</h3>\n<p>由于实验室的集群都是MPI环境，我还是选择使用MPI接口来将代码并行化，这里我还是用了MPI接口的Python版本mpi4py来将代码并行化。关于mpi4py的使用，我之前写过一篇博客专门做了介绍，可以参见<a href=\"http://python.jobbole.com/87650/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">《Python多进程并行编程实践-mpi4py的使用》</span></a></p>\n<h3 id=\"将mpi4py的接口进一步封装\">将mpi4py的接口进一步封装</h3>\n<p>为了能让mpi的接口在GAFT中更方便的调用，我决定将mpi4py针对遗传算法中需要用的地方进行进一步封装，为此我单独写了个<code><span style=\"font-family: Courier New\">MPIUtil</span></code>类, 详细代码参见<a href=\"https://github.com/PytLab/gaft/blob/master/gaft/mpiutil.py\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">gaft/mpiutil.py</span></a>。</p>\n<h4 id=\"封装通信子常用的接口\">封装通信子常用的接口</h4>\n<p>例如进程同步, 获取rank，进程数，判断是否为主进程等。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c2f474102055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass MPIUtil(object):\r\n    def __init__(self):\r\n        logger_name = 'gaft.{}'.format(self.__class__.__name__)\r\n        self._logger = logging.getLogger(logger_name)\r\n\r\n    # Wrapper for common MPI interfaces.\r\n    def barrier(self):\r\n        if MPI_INSTALLED:\r\n            mpi_comm = MPI.COMM_WORLD\r\n            mpi_comm.barrier()\r\n\r\n    @property\r\n    def rank(self):\r\n        if MPI_INSTALLED:\r\n            mpi_comm = MPI.COMM_WORLD\r\n            return mpi_comm.Get_rank()\r\n        else:\r\n            return 0\r\n\r\n    @property\r\n    def size(self):\r\n        if MPI_INSTALLED:\r\n            mpi_comm = MPI.COMM_WORLD\r\n            return mpi_comm.Get_size()\r\n        else:\r\n            return 1\r\n\r\n    @property\r\n    def is_master(self):\r\n        return self.rank == 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c2f474102055-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c2f474102055-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MPIUtil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'gaft.{}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__class__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">logger_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Wrapper for common MPI interfaces.</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">barrier</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI_INSTALLED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">COMM_WORLD</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-10\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">barrier</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">property</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI_INSTALLED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">COMM_WORLD</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-16\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get_rank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">property</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI_INSTALLED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">COMM_WORLD</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-24\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get_size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">property</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c2f474102055-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">is_master</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c2f474102055-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n<p></p>\n<h4 id=\"组内集合通信接口\">组内集合通信接口</h4>\n<p>由于本次并行化的任务是在种群繁衍时候进行的，因此我需要将上一代种群进行划分，划分成多个子部分，然后在每个进程中对划分好的子部分进行选择交叉变异等遗传操作。在最后将每个字部分得到的子种群进行收集合并。为此写了几个划分和收集的接口:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c38288943839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef split_seq(self, sequence):\r\n    '''\r\n    Split the sequence according to rank and processor number.\r\n    '''\r\n    starts = [i for i in range(0, len(sequence), len(sequence)//self.size)]\r\n    ends = starts[1: ] + [len(sequence)]\r\n    start, end = list(zip(starts, ends))[self.rank]\r\n\r\n    return sequence[start: end]\r\n\r\ndef split_size(self, size):\r\n    '''\r\n    Split a size number(int) to sub-size number.\r\n    '''\r\n    if size &lt; self.size:\r\n        warn_msg = ('Splitting size({}) is smaller than process ' +\r\n                    'number({}), more processor would be ' +\r\n                    'superflous').format(size, self.size)\r\n        self._logger.warning(warn_msg)\r\n        splited_sizes = [1]*size + [0]*(self.size - size)\r\n    elif size % self.size != 0:\r\n        residual = size % self.size\r\n        splited_sizes = [size // self.size]*self.size\r\n        for i in range(residual):\r\n            splited_sizes[i] += 1\r\n    else:\r\n        splited_sizes = [size // self.size]*self.size\r\n\r\n    return splited_sizes[self.rank]\r\n\r\ndef merge_seq(self, seq):\r\n    '''\r\n    Gather data in sub-process to root process.\r\n    '''\r\n    if self.size == 1:\r\n        return seq\r\n\r\n    mpi_comm = MPI.COMM_WORLD\r\n    merged_seq= mpi_comm.allgather(seq)\r\n    return list(chain(*merged_seq))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c38288943839-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c38288943839-40\">40</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">split_seq</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-3\"><span class=\"crayon-s\">    Split the sequence according to rank and processor number.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-4\"><span class=\"crayon-s\">    '''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">starts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ends</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">starts</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">starts</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ends</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rank</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sequence</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">start</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-10\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-11\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">split_size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-13\"><span class=\"crayon-s\">    Split a size number(int) to sub-size number.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-14\"><span class=\"crayon-s\">    '''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">warn_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Splitting size({}) is smaller than process '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'number({}), more processor would be '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'superflous'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">warning</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">warn_msg</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">splited_sizes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">residual</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-23\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">splited_sizes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-24\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">residual</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">splited_sizes</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">splited_sizes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-28\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-29\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">splited_sizes</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rank</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-30\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-31\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">merge_seq</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-33\"><span class=\"crayon-s\">    Gather data in sub-process to root process.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-34\"><span class=\"crayon-s\">    '''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seq</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-38\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">COMM_WORLD</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c38288943839-39\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">merged_seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi_comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c38288943839-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">chain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">merged_seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0087 seconds] -->\r\n<p></p>\n<h4 id=\"用于限制程序在主进程执行的装饰器\">用于限制程序在主进程执行的装饰器</h4>\n<p>有些函数例如日志输出，数据收集的函数，我只希望在主进程执行，为了方便，写了个装饰器来限制函数在主进程中执行:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c3e879049641\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef master_only(func):\r\n    '''\r\n    Decorator to limit a function to be called\r\n    only in master process in MPI env.\r\n    '''\r\n    @wraps(func)\r\n    def _call_in_master_proc(*args, **kwargs):\r\n        if mpi.is_master:\r\n            return func(*args, **kwargs)\r\n\r\n    return _call_in_master_proc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3e879049641-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3e879049641-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3e879049641-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3e879049641-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3e879049641-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3e879049641-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master_only</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3e879049641-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-3\"><span class=\"crayon-s\">    Decorator to limit a function to be called</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3e879049641-4\"><span class=\"crayon-s\">    only in master process in MPI env.</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-5\"><span class=\"crayon-s\">    '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3e879049641-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">wraps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_call_in_master_proc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3e879049641-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">is_master</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3e879049641-10\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c3e879049641-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_call_in_master_proc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h3 id=\"在遗传算法主循环中添加并行\">在遗传算法主循环中添加并行</h3>\n<p>主要在种群繁衍中对种群针对进程数进行划分然后并行进行遗传操作并合并子种群完成并行，代码改动很少。详见:<a href=\"https://github.com/PytLab/gaft/blob/master/gaft/engine.py#L67\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">https://github.com/PytLab/gaft/blob/master/gaft/engine.py#L67</span></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c43176512629\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Enter evolution iteration.\r\nfor g in range(ng):\r\n    # Scatter jobs to all processes.\r\n    local_indvs = []\r\n    local_size = mpi.split_size(self.population.size // 2)\r\n\r\n    # Fill the new population.\r\n    for _ in range(local_size):\r\n        # Select father and mother.\r\n        parents = self.selection.select(self.population, fitness=self.fitness)\r\n        # Crossover.\r\n        children = self.crossover.cross(*parents)\r\n        # Mutation.\r\n        children = [self.mutation.mutate(child) for child in children]\r\n        # Collect children.\r\n        local_indvs.extend(children)\r\n\r\n    # Gather individuals from all processes.\r\n    indvs = mpi.merge_seq(local_indvs)\r\n    # The next generation.\r\n    self.population.individuals = indvs</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c43176512629-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c43176512629-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-1\"><span class=\"crayon-c\"># Enter evolution iteration.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ng</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Scatter jobs to all processes.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_indvs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split_size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Fill the new population.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Select father and mother.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">parents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">selection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Crossover.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">children</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">crossover</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cross</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">parents</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Mutation.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">children</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mutation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mutate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Collect children.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_indvs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Gather individuals from all processes.</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">indvs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mpi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">merge_seq</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_indvs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c43176512629-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># The next generation.</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c43176512629-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">individuals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indvs</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p>\n<h3 id=\"测试加速效果\">测试加速效果</h3>\n<h4 id=\"测试一维搜索\">测试一维搜索</h4>\n<p>下面我针对项目中的一维优化的例子进行并行加速测试来看看加速的效果。例子代码在<a href=\"https://github.com/PytLab/gaft/tree/master/examples/ex01\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">/examples/ex01/</span></a></p>\n<p>由于自己本子核心数量有限，我把gaft安装在实验室集群上使用MPI利用多核心进行并行计算一维优化，种群大小为50，代数为100，针对不同核心数可以得到不同的优化时间和加速比。可视化如下图:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/09a97d7ebd719f435412bc9bef0fd6bb.png\"><img class=\"alignnone size-medium wp-image-88244\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/09a97d7ebd719f435412bc9bef0fd6bb-189x300.png\" alt=\"WX20170802-225140@2x\"></a></p>\n<p>核心数与优化时间的关系:</p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-08-02-%E4%BD%BF%E7%94%A8MPI%E5%B9%B6%E8%A1%8C%E5%8C%96%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95/n_vs_time_1d.png\" alt=\"\"></p>\n<p>核心数与加速比:</p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-08-02-%E4%BD%BF%E7%94%A8MPI%E5%B9%B6%E8%A1%8C%E5%8C%96%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95/n_vs_speedup_1d.png\" alt=\"\"></p>\n<h4 id=\"测试力场优化\">测试力场优化</h4>\n<p>这里我对自己要研究的对象进行加速测试，这部分代码并未开源，针对每个个体的适应度计算都需要调用其他的计算程序，因此此过程相比直接有函数表达式的目标函数计算要耗时很多。</p>\n<p>同样，我针对不同核心数看看使用MPI在集群上加速的效果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e1d3925c68775d2d59eb3fc09158da0.png\"><img class=\"alignnone size-medium wp-image-88245\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e1d3925c68775d2d59eb3fc09158da0-300x193.png\" alt=\"WX20170802-225259@2x\"></a></p>\n<p>核心数与优化时间的关系:</p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-08-02-%E4%BD%BF%E7%94%A8MPI%E5%B9%B6%E8%A1%8C%E5%8C%96%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95/n_vs_time.png\" alt=\"\"></p>\n<p>核心数与加速比:</p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-08-02-%E4%BD%BF%E7%94%A8MPI%E5%B9%B6%E8%A1%8C%E5%8C%96%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95/n_vs_speedup.png\" alt=\"\"></p>\n<p>可见针对上述两个案例，MPI对遗传算法的加速还是比较理想的，程序可以扔到集群上飞起啦~~~</p>\n<h2 id=\"总结\">总结</h2>\n<p>本文主要总结了使用mpi4py对遗传算法进行并行化的方法和过程，并对加速效果进行了测试，可见MPI对于遗传算法框架GAFT的加速效果还是较为理想的。带有MPI并行的遗传算法框架目前也已更新并上传至GitHub(<a href=\"https://github.com/PytLab/gaft\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc\">https://github.com/PytLab/gaft</span></a>) 欢迎围观[]~(￣▽￣)~*</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88242\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88242votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88242\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "实践项目,MPI,mpi4py,并行计算,最优化,遗传算法",
    "article_url": "http://python.jobbole.com/88242/",
    "url_object_id": "00d40a3f7cd12c61091d8d36d0dfe04f",
    "front_image_url": [
        "http://pytlab.org/assets/images/blog_img/2017-08-02-使用MPI并行化遗传算法/feature.png"
    ]
}
{
    "title": "学习用 Python 编程时要避免的 3 个错误",
    "create_date": "2017/08/21",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 1,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/6/3-things-i-did-wrong-learning-python\">Pete Savage</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8780-1.html\">polebug</a>   </div><blockquote><p>这些错误会造成很麻烦的问题，需要数小时才能解决。</p></blockquote>\n<p>当你做错事时，承认错误并不是一件容易的事，但是犯错是任何学习过程中的一部分，无论是学习走路，还是学习一种新的编程语言都是这样，比如学习 Python。</p>\n<p>为了让初学 Python 的程序员避免犯同样的错误，以下列出了我学习 Python 时犯的三种错误。这些错误要么是我长期以来经常犯的，要么是造成了需要几个小时解决的麻烦。</p>\n<p>年轻的程序员们可要注意了，这些错误是会浪费一下午的！</p>\n<h1 id=\"toc_1\">1、 可变数据类型作为函数定义中的默认参数</h1>\n<p>这似乎是对的？你写了一个小函数，比如，搜索当前页面上的链接，并可选将其附加到另一个提供的列表中。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d56761747026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef search_for_links(page, add_to=[]):\r\n    new_links = page.search_for_links()\r\n    add_to.extend(new_links)\r\n    return add_to</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d56761747026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d56761747026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d56761747026-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d56761747026-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d56761747026-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search_for_links</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d56761747026-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">new_links</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">search_for_links</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d56761747026-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">new_links</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d56761747026-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add_to</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>从表面看，这像是十分正常的 Python 代码，事实上它也是，而且是可以运行的。但是，这里有个问题。如果我们给<span style=\"color: #ff0000\"> <strong><strong>add_to</strong></strong></span> 参数提供了一个列表，它将按照我们预期的那样工作。但是，如果我们让它使用默认值，就会出现一些神奇的事情。</p>\n<p>试试下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d5f448209536\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fn(var1, var2=[]):\r\n    var2.append(var1)\r\n    print var2\r\nfn(3)\r\nfn(4)\r\nfn(5)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d5f448209536-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d5f448209536-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d5f448209536-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d5f448209536-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d5f448209536-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d5f448209536-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d5f448209536-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">var1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">var2</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d5f448209536-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">var2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">var1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d5f448209536-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">var2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d5f448209536-4\"><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d5f448209536-5\"><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d5f448209536-6\"><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>可能你认为我们将看到：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d63091366275\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[3]\r\n[4]\r\n[5]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d63091366275-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d63091366275-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d63091366275-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d63091366275-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d63091366275-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d63091366275-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但实际上，我们看到的却是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d67242320594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[3]\r\n[3, 4]\r\n[3, 4, 5]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d67242320594-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d67242320594-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d67242320594-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d67242320594-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d67242320594-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d67242320594-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>为什么呢？如你所见，每次都使用的是同一个列表，输出为什么会是这样？在 Python 中，当我们编写这样的函数时，这个列表被实例化为函数定义的一部分。当函数运行时，它并不是每次都被实例化。这意味着，这个函数会一直使用完全一样的列表对象，除非我们提供一个新的对象：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d6b314438138\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfn(3, [4])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d6b314438138-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d6b314438138-1\"><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d6e437685396\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[4, 3]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d6e437685396-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d6e437685396-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>答案正如我们所想的那样。要想得到这种结果，正确的方法是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d71118744799\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fn(var1, var2=None):\r\n    if not var2:\r\n        var2 = []\r\n    var2.append(var1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d71118744799-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d71118744799-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d71118744799-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d71118744799-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d71118744799-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">var1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">var2</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d71118744799-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">var2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d71118744799-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">var2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d71118744799-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">var2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">var1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>或是在第一个例子中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d75873931168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef search_for_links(page, add_to=None):\r\n    if not add_to:\r\n        add_to = []\r\n    new_links = page.search_for_links()\r\n    add_to.extend(new_links)\r\n    return add_to</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d75873931168-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d75873931168-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d75873931168-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d75873931168-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d75873931168-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d75873931168-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d75873931168-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search_for_links</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d75873931168-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d75873931168-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d75873931168-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">new_links</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">search_for_links</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d75873931168-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">add_to</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">new_links</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d75873931168-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add_to</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>这将在模块加载的时候移走实例化的内容，以便每次运行函数时都会发生列表实例化。请注意，对于不可变数据类型，比如<a href=\"https://docs.python.org/2/library/functions.html?highlight=tuple#tuple\"><strong>元组</strong></a>、<a href=\"https://docs.python.org/2/library/string.html\"><strong>字符串</strong></a>、<a href=\"https://docs.python.org/2/library/functions.html#int\"><strong>整型</strong></a>，是不需要考虑这种情况的。这意味着，像下面这样的代码是非常可行的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d78000734667\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef func(message=\"my message\"):\r\n    print message</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d78000734667-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d78000734667-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d78000734667-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"my message\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d78000734667-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h1 id=\"toc_2\">2、 可变数据类型作为类变量</h1>\n<p>这和上面提到的最后一个错误很相像。思考以下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d7c849840564\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass URLCatcher(object):\r\n    urls = []\r\n    def add_url(self, url):\r\n        self.urls.append(url)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d7c849840564-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d7c849840564-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d7c849840564-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d7c849840564-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d7c849840564-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URLCatcher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d7c849840564-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d7c849840564-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d7c849840564-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这段代码看起来非常正常。我们有一个储存 URL 的对象。当我们调用 add_url 方法时，它会添加一个给定的 URL 到存储中。看起来非常正确吧？让我们看看实际是怎样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d7f577002047\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\na = URLCatcher()\r\na.add_url('http://www.google.com')\r\nb = URLCatcher()\r\nb.add_url('http://www.bbc.co.hk')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d7f577002047-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d7f577002047-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d7f577002047-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d7f577002047-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d7f577002047-1\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URLCatcher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d7f577002047-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://www.google.com'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d7f577002047-3\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URLCatcher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d7f577002047-4\"><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://www.bbc.co.hk'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>b.urls：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d82084760132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['http://www.google.com', 'http://www.bbc.co.uk']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d82084760132-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d82084760132-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'http://www.google.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.bbc.co.uk'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>a.urls：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d85081601572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['http://www.google.com', 'http://www.bbc.co.uk']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d85081601572-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d85081601572-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'http://www.google.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.bbc.co.uk'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>等等，怎么回事？！我们想的不是这样啊。我们实例化了两个单独的对象 <span style=\"color: #ff0000\"><strong>a</strong></span> 和 <span style=\"color: #ff0000\"><strong>b</strong></span>。把一个 URL 给了 <span style=\"color: #ff0000\"><strong>a</strong></span>，另一个给了 <span style=\"color: #ff0000\"><strong>b</strong></span>。这两个对象怎么会都有这两个 URL 呢？</p>\n<p>这和第一个错例是同样的问题。创建类定义时，URL 列表将被实例化。该类所有的实例使用相同的列表。在有些时候这种情况是有用的，但大多数时候你并不想这样做。你希望每个对象有一个单独的储存。为此，我们修改代码为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d89385823452\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass URLCatcher(object):\r\n    def __init__(self):\r\n        self.urls = []\r\n    def add_url(self, url):\r\n        self.urls.append(url)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d89385823452-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d89385823452-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d89385823452-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d89385823452-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d89385823452-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d89385823452-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URLCatcher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d89385823452-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d89385823452-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d89385823452-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d89385823452-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>现在，当创建对象时，URL 列表被实例化。当我们实例化两个单独的对象时，它们将分别使用两个单独的列表。</p>\n<h1 id=\"toc_3\">3、 可变的分配错误</h1>\n<p>这个问题困扰了我一段时间。让我们做出一些改变，并使用另一种可变数据类型 – <a href=\"https://docs.python.org/2/library/stdtypes.html?highlight=dict#dict\"><strong>字典</strong></a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d8c513488809\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\na = {'1': \"one\", '2': 'two'}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d8c513488809-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d8c513488809-1\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"one\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'two'</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，假设我们想把这个字典用在别的地方，且保持它的初始数据完整。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d8f505489209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nb = a\r\n\r\nb['3'] = 'three'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d8f505489209-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d8f505489209-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d8f505489209-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d8f505489209-1\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d8f505489209-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d8f505489209-3\"><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'three'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>简单吧？</p>\n<p>现在，让我们看看原来那个我们不想改变的字典 <span style=\"color: #ff0000\"><strong>a</strong></span>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d93308906396\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n'1': \"one\", '2': 'two', '3': 'three'}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d93308906396-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d93308906396-1\"><span class=\"crayon-s\">'1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"one\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'two'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'three'</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>哇等一下，我们再看看 <span style=\"color: #ff0000\"><strong>b</strong></span>？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d96291265997\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{'1': \"one\", '2': 'two', '3': 'three'}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d96291265997-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d96291265997-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"one\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'two'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'three'</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>等等，什么？有点乱……让我们回想一下，看看其它不可变类型在这种情况下会发生什么，例如一个<span style=\"color: #ff0000\"><strong>元组</strong></span>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d99085189292\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nc = (2, 3)\r\nd = c\r\nd = (4, 5)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d99085189292-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6a54d99085189292-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d99085189292-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d99085189292-1\"><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6a54d99085189292-2\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6a54d99085189292-3\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在 <span style=\"color: #ff0000\"><strong>c</strong> </span>是<span style=\"color: #ff0000\"> <strong>(2, 3)</strong></span>，而 <span style=\"color: #ff0000\"><strong>d</strong></span> 是<span style=\"color: #ff0000\"> <strong>(4, 5)</strong></span>。</p>\n<p>这个函数结果如我们所料。那么，在之前的例子中到底发生了什么？当使用可变类型时，其行为有点像 <span style=\"color: #ff0000\"><strong>C</strong></span> 语言的一个指针。在上面的代码中，我们令 <span style=\"color: #ff0000\"><strong>b = a</strong></span>，我们真正表达的意思是：<span style=\"color: #ff0000\"><strong>b</strong></span> 成为 <span style=\"color: #ff0000\"><strong>a</strong></span> 的一个引用。它们都指向 Python 内存中的同一个对象。听起来有些熟悉？那是因为这个问题与先前的相似。其实，这篇文章应该被称为「可变引发的麻烦」。</p>\n<p>列表也会发生同样的事吗？是的。那么我们如何解决呢？这必须非常小心。如果我们真的需要复制一个列表进行处理，我们可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54d9d348209688\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nb = a[:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54d9d348209688-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54d9d348209688-1\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这将遍历并复制列表中的每个对象的引用，并且把它放在一个新的列表中。但是要注意：如果列表中的每个对象都是可变的，我们将再次获得它们的引用，而不是完整的副本。</p>\n<p>假设在一张纸上列清单。在原来的例子中相当于，A 某和 B 某正在看着同一张纸。如果有个人修改了这个清单，两个人都将看到相同的变化。当我们复制引用时，每个人现在有了他们自己的清单。但是，我们假设这个清单包括寻找食物的地方。如果“冰箱”是列表中的第一个，即使它被复制，两个列表中的条目也都指向同一个冰箱。所以，如果冰箱被 A 修改，吃掉了里面的大蛋糕，B 也将看到这个蛋糕的消失。这里没有简单的方法解决它。只要你记住它，并编写代码的时候，使用不会造成这个问题的方式。</p>\n<p>字典以相同的方式工作，并且你可以通过以下方式创建一个昂贵副本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6a54da0187250150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nb = a.copy()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6a54da0187250150-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6a54da0187250150-1\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>再次说明，这只会创建一个新的字典，指向原来存在的相同的条目。因此，如果我们有两个相同的列表，并且我们修改字典 <span style=\"color: #ff0000\"><strong>a</strong></span> 的一个键指向的可变对象，那么在字典 b 中也将看到这些变化。</p>\n<p>可变数据类型的麻烦也是它们强大的地方。以上都不是实际中的问题；它们是一些要注意防止出现的问题。在第三个项目中使用昂贵复制操作作为解决方案在 99% 的时候是没有必要的。你的程序或许应该被改改，所以在第一个例子中，这些副本甚至是不需要的。</p>\n<p><em>编程快乐！在评论中可以随时提问。</em></p>\n<hr>\n<p><strong>作者简介：</strong></p>\n<p>Pete Savage – Peter 是一位充满激情的开源爱好者，在过去十年里一直在推广和使用开源产品。他从 Ubuntu 社区开始，在许多不同的领域自愿参与音频制作领域的研究工作。在职业经历方面，他起初作为公司的系统管理员，大部分时间在管理和建立数据中心，之后在 Red Hat 担任 CloudForms 产品的主要测试工程师。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88376\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88376votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88376\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,错误",
    "article_url": "http://python.jobbole.com/88376/",
    "url_object_id": "00c3bead4a0f624b93f4dfd77410c05e",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"
    ]
}
{
    "title": "用 Python 做股市数据分析（2）",
    "create_date": "2017/08/21",
    "agree_num": 2,
    "comment_num": 0,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://ntguardian.wordpress.com/2016/09/26/introduction-stock-market-data-python-2/\">Curtis Miller</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>这篇博文是用Python分析股市数据系列两部中的第二部，内容基于我在<em><a href=\"http://datasciencecourse.net/2016/index.html\">犹他大学 数学3900 (数据科学)</a></em>的课程 （<a href=\"http://python.jobbole.com/87813/\">阅读第一部分</a>）。在这两篇博文中，我会讨论一些基础知识，包括比如如何用pandas从雅虎财经获得数据， 可视化股市数据，平均数指标的定义，设计<span class=\"st\">移动平均交汇点分析移动平均线的方法，回溯测试和 基准分析法。这篇文章会讨论如何设计用移动平均交汇点分析移动平均线的系统，如何做回溯测试和基准分析，最后留有一些练习题以飨读者。</span></p>\n<p>注意：本文仅代表作者本人的观点。文中的内容不应该被当做经济建议。我不对文中代码负责，取用者自己负责</p>\n<h2>交易策略</h2>\n<p>在特定的预期条件达成时一个<strong>开放头寸</strong>会被关闭。<strong>多头</strong>头寸表示交易中需要金融商品价格上升才能产生盈利，<strong>空头</strong>头寸表示交易中需要金融商品价格下降才能产生盈利。在股票交易中，多头头寸是牛市，空头头寸是熊市，反之则不成立。（股票期权交易中这个非常典型）</p>\n<p>例如你在预计股价上涨的情况下购入股票，并计划在股票价格上涨高于购入价时抛出，这就是多头头寸。就是说你持有一定的金融产品，如果它们价格上涨，你将会获利，并且没有上限；如果它们价格下降，你会亏损。由于股票价格不会为负，亏损是有限度的。相反的，如果你预计股价会下跌，就从交易公司借贷股票然后卖出，同时期待未来股票价格下降后再低价买入还贷来赚取差额，这就是<strong>空头股票</strong>。如果股价下跌你会获利。空头头寸的获利额度受股价所限（最佳情况就是股票变得一文不值，你不用花钱就能将它们买回来），而损失却没有下限，因为你有可能需要花很多钱才能买回股票。所以交换所只会在确定投资者有很好的经济基础的情况下才会让他们空头借贷股票。</p>\n<p>所有股民都应该决定他在每一股上可以冒多大的风险。比如有人决定无论什么情况他都不会在某一次交易中投入总额的10%去冒险。同时在交易中，股民要有一个<strong>撤出策略，</strong>这是让股民退出头寸的各种条件。股民也可以设置一个<strong>目标</strong>，这是导致股民退出头寸的最小盈利额。同样的，股民也需要有一个他能承受的最大损失额度。当预计损失大于可承受额度时，股民应该退出头寸以避免更大损失（这可以通过设置<strong>停止损失委托</strong>来避免未来的损失）。</p>\n<p>我们要设计一个<strong>交易策略</strong>，它包含用于快速交易的交易激发信号、决定交易额度的规则和完整的退出策略。我们的目标是设计并评估该交易策略。</p>\n<p>假设每次交易金额占总额的比例是固定的（10%）。同时设定在每一次交易中，如果损失超过了20%的交易值，我们就退出头寸。现在我们要决定什么时候进入头寸，什么时候退出以保证盈利。</p>\n<p>这里我要演示<span class=\"st\"><a href=\"http://www.investopedia.com/university/movingaverage/movingaverages4.asp\">移动平均交汇点分析移动平均线的方法</a>。我会使用两条移动平均线，一条快速的，另一条是慢速的。我们的策略是：</span></p>\n<ul>\n<li>当快速移动平均线和慢速移动线交汇时开始交易</li>\n<li>当快速移动平均线和慢速移动线再次交汇时停止交易</li>\n</ul>\n<p>做多是指在快速平均线上升到慢速平均线之上时开始交易，当快速平均线下降到慢速平均线之下时停止交易。卖空正好相反，它是指在快速平均线下降到慢速平均线之下时开始交易，快速平均线上升到慢速平均线之上时停止交易。</p>\n<p>现在我们有一整套策略了。在使用它之前我们需要先做一下测试。回溯测试是一个常用的测试方法，它使用历史数据来看策略是否会盈利。例如这张苹果公司的股票价值图，如果20天的移动平均是快速线，50天的移动平均是慢速线，那么我们这个策略不是很挣钱，至少在你一直做多头头寸的时候。</p>\n<p>下面让我们来自动化回溯测试的过程。首先我们要识别什么时候20天平均线在50天之下，以及之上。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f03404753381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple['20d-50d'] =apple['20d'] -apple['50d']\r\napple.tail()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f03404753381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f03404753381-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f03404753381-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'50d'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f03404753381-2\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>Open</th>\n<th>High</th>\n<th>Low</th>\n<th>Close</th>\n<th>Volume</th>\n<th>Adj Close</th>\n<th>20d</th>\n<th>50d</th>\n<th>200d</th>\n<th>20d-50d</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2016-08-26</th>\n<td>107.410004</td>\n<td>107.949997</td>\n<td>106.309998</td>\n<td>106.940002</td>\n<td>27766300</td>\n<td>106.940002</td>\n<td>107.87</td>\n<td>101.51</td>\n<td>102.73</td>\n<td>6.36</td>\n</tr>\n<tr>\n<th>2016-08-29</th>\n<td>106.620003</td>\n<td>107.440002</td>\n<td>106.290001</td>\n<td>106.820000</td>\n<td>24970300</td>\n<td>106.820000</td>\n<td>107.91</td>\n<td>101.74</td>\n<td>102.68</td>\n<td>6.17</td>\n</tr>\n<tr>\n<th>2016-08-30</th>\n<td>105.800003</td>\n<td>106.500000</td>\n<td>105.500000</td>\n<td>106.000000</td>\n<td>24863900</td>\n<td>106.000000</td>\n<td>107.98</td>\n<td>101.96</td>\n<td>102.63</td>\n<td>6.02</td>\n</tr>\n<tr>\n<th>2016-08-31</th>\n<td>105.660004</td>\n<td>106.570000</td>\n<td>105.639999</td>\n<td>106.099998</td>\n<td>29662400</td>\n<td>106.099998</td>\n<td>108.00</td>\n<td>102.16</td>\n<td>102.60</td>\n<td>5.84</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<td>106.139999</td>\n<td>106.800003</td>\n<td>105.620003</td>\n<td>106.730003</td>\n<td>26643600</td>\n<td>106.730003</td>\n<td>108.04</td>\n<td>102.39</td>\n<td>102.56</td>\n<td>5.65</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>我们将差异的符号称为<strong>状态转换。</strong>快速移动平均线在慢速移动平均线之上代表牛市状态；相反则为熊市。以下的代码用于识别状态转换。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f0e539965488\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not\r\napple[\"Regime\"] = np.where(apple['20d-50d'] &gt; 0, 1, 0)\r\n# We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]\r\napple[\"Regime\"] = np.where(apple['20d-50d'] &lt; 0, -1, apple[\"Regime\"])\r\napple.loc['2016-01-01':'2016-08-07',\"Regime\"].plot(ylim = (-2,2)).axhline(y = 0, color = \"black\", lw = 2)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f0e539965488-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f0e539965488-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f0e539965488-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f0e539965488-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f0e539965488-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f0e539965488-1\"><span class=\"crayon-c\"># np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f0e539965488-2\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f0e539965488-3\"><span class=\"crayon-c\"># We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f0e539965488-4\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f0e539965488-5\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'2016-01-01'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'2016-08-07'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ylim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">axhline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"black\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lw</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1firhyecbjvj20iw0bawen.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f13992950602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple[\"Regime\"].plot(ylim =(-2,2)).axhline(y =0, color =\"black\", lw =2)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f13992950602-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f13992950602-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ylim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">axhline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"black\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lw</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1firhydtvtrj20iw0b1aaf.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f17619786886\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple[\"Regime\"].value_counts()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f17619786886-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f17619786886-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">value_counts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f1a838258184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n 1    966\r\n-1    663\r\n 0     50\r\nName: Regime, dtype: int64</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f1a838258184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f1a838258184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f1a838258184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f1a838258184-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f1a838258184-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">966</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f1a838258184-2\"><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">663</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f1a838258184-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">50</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f1a838258184-4\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Regime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int64</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><span style=\"color: #000000\">从上面的曲线可以看到有966天苹果公司的股票是牛市，663天是熊市，有54天没有倾向性。（原文中牛市和熊市说反了，译文中更正；原文数字跟代码结果对不上，译文按照代码结果更正）</span></p>\n<p>交易信号出现在状态转换之时。牛市出现时，买入信号被激活；牛市完结时，卖出信号被激活。同样的，熊市出现时卖出信号被激活，熊市结束时，买入信号被激活。（只有在你空头股票，或者使用一些其他的方法例如用股票期权赌市场的时候这种情况才对你有利）</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1firhjs7w2xj20kl033mx4.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f1d488694683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# To ensure that all trades close out, I temporarily change the regime of the last row to 0\r\nregime_orig = apple.ix[-1, \"Regime\"]\r\napple.ix[-1, \"Regime\"] = 0\r\napple[\"Signal\"] = np.sign(apple[\"Regime\"] - apple[\"Regime\"].shift(1))\r\n# Restore original regime data\r\napple.ix[-1, \"Regime\"] = regime_orig\r\napple.tail()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f1d488694683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f1d488694683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f1d488694683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f1d488694683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f1d488694683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f1d488694683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f1d488694683-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f1d488694683-1\"><span class=\"crayon-c\"># To ensure that all trades close out, I temporarily change the regime of the last row to 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f1d488694683-2\"><span class=\"crayon-v\">regime_orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f1d488694683-3\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f1d488694683-4\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f1d488694683-5\"><span class=\"crayon-c\"># Restore original regime data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f1d488694683-6\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">regime_orig</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f1d488694683-7\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<div class=\"entry-content\">\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>Open</th>\n<th>High</th>\n<th>Low</th>\n<th>Close</th>\n<th>Volume</th>\n<th>Adj Close</th>\n<th>20d</th>\n<th>50d</th>\n<th>200d</th>\n<th>20d-50d</th>\n<th>Regime</th>\n<th>Signal</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2016-08-26</th>\n<td>107.410004</td>\n<td>107.949997</td>\n<td>106.309998</td>\n<td>106.940002</td>\n<td>27766300</td>\n<td>106.940002</td>\n<td>107.87</td>\n<td>101.51</td>\n<td>102.73</td>\n<td>6.36</td>\n<td>1.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<th>2016-08-29</th>\n<td>106.620003</td>\n<td>107.440002</td>\n<td>106.290001</td>\n<td>106.820000</td>\n<td>24970300</td>\n<td>106.820000</td>\n<td>107.91</td>\n<td>101.74</td>\n<td>102.68</td>\n<td>6.17</td>\n<td>1.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<th>2016-08-30</th>\n<td>105.800003</td>\n<td>106.500000</td>\n<td>105.500000</td>\n<td>106.000000</td>\n<td>24863900</td>\n<td>106.000000</td>\n<td>107.98</td>\n<td>101.96</td>\n<td>102.63</td>\n<td>6.02</td>\n<td>1.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<th>2016-08-31</th>\n<td>105.660004</td>\n<td>106.570000</td>\n<td>105.639999</td>\n<td>106.099998</td>\n<td>29662400</td>\n<td>106.099998</td>\n<td>108.00</td>\n<td>102.16</td>\n<td>102.60</td>\n<td>5.84</td>\n<td>1.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<td>106.139999</td>\n<td>106.800003</td>\n<td>105.620003</td>\n<td>106.730003</td>\n<td>26643600</td>\n<td>106.730003</td>\n<td>108.04</td>\n<td>102.39</td>\n<td>102.56</td>\n<td>5.65</td>\n<td>1.0</td>\n<td>-1.0</td>\n</tr>\n</tbody>\n</table>\n</div>\n<div>\n<div id=\"highlighter_131857\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f23072164420\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple[\"Signal\"].plot(ylim =(-2, 2))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f23072164420-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f23072164420-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ylim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n</div>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1firhyd8hv5j20iw0b1glu.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f27397631490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple[\"Signal\"].value_counts()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f27397631490-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f27397631490-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">value_counts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f2d530918437\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n 0.0    1637\r\n-1.0      21\r\n 1.0      20\r\nName: Signal, dtype: int64</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f2d530918437-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f2d530918437-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f2d530918437-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f2d530918437-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f2d530918437-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1637</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f2d530918437-2\"><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f2d530918437-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f2d530918437-4\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Signal</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int64</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><span style=\"color: #000000\">我们会买入苹果公司的股票20次，抛出21次 （原文数字跟代码结果不符，译文根据代码结果更正）。如果我们只选了苹果公司的股票，六年内只有21次交易发生。如果每次多头转空头的时候我们都采取行动，我们将会参与21次交易。（请记住交易次数不是越多越好，毕竟交易不是免费的）</span></p>\n<p>你也许注意到了这个系统不是很稳定。快速平均线在慢速平均线之上就激发交易，即使这个状态只是短短一瞬，这样会导致交易马上终止（这样并不好因为现实中每次交易都要付费，这个费用会很快消耗掉收益）。同时所有的牛市瞬间转为熊市，如果你允许同时押熊市和牛市，那就会出现每次交易结束就自动激发另一场押相反方向交易的诡异情况。更好的系统会要求有更多的证据来证明市场的发展方向，但是这里我们不去追究那个细节。</p>\n<p>下面我们来看看每次买入卖出时候的股票价格。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f31719838432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple.loc[apple[\"Signal\"] ==1, \"Close\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f31719838432-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f31719838432-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f34306060380\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDate\r\n2010-03-16    224.449997\r\n2010-06-18    274.070011\r\n2010-09-20    283.230007\r\n2011-05-12    346.569988\r\n2011-07-14    357.770004\r\n2011-12-28    402.640003\r\n2012-06-25    570.770020\r\n2013-05-17    433.260010\r\n2013-07-31    452.529984\r\n2013-10-16    501.110001\r\n2014-03-26    539.779991\r\n2014-04-25    571.939980\r\n2014-08-18     99.160004\r\n2014-10-28    106.739998\r\n2015-02-05    119.940002\r\n2015-04-28    130.559998\r\n2015-10-27    114.550003\r\n2016-03-11    102.260002\r\n2016-07-01     95.889999\r\n2016-07-25     97.339996\r\nName: Close, dtype: float64</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f34306060380-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f34306060380-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-1\"><span class=\"crayon-i\">Date</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-2\"><span class=\"crayon-cn\">2010</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">224.449997</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-3\"><span class=\"crayon-cn\">2010</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">274.070011</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-4\"><span class=\"crayon-cn\">2010</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">283.230007</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-5\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">346.569988</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-6\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">14</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">357.770004</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-7\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">402.640003</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-8\"><span class=\"crayon-cn\">2012</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">570.770020</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-9\"><span class=\"crayon-cn\">2013</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">433.260010</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-10\"><span class=\"crayon-cn\">2013</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">452.529984</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-11\"><span class=\"crayon-cn\">2013</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">501.110001</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-12\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">539.779991</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-13\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">571.939980</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-14\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">99.160004</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-15\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">106.739998</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-16\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">119.940002</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-17\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">130.559998</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-18\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">114.550003</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-19\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">102.260002</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-20\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">95.889999</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f34306060380-21\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">97.339996</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f34306060380-22\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Close</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">float64</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p></p>\n<div>\n<div id=\"highlighter_869531\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f38391107168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple.loc[apple[\"Signal\"] ==-1, \"Close\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f38391107168-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f38391107168-1\"><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f3c213635648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDate\r\n2010-06-11    253.509995\r\n2010-07-22    259.020000\r\n2011-03-30    348.630009\r\n2011-03-31    348.510006\r\n2011-05-27    337.409992\r\n2011-11-17    377.410000\r\n2012-05-09    569.180023\r\n2012-10-17    644.610001\r\n2013-06-26    398.069992\r\n2013-10-03    483.409996\r\n2014-01-28    506.499977\r\n2014-04-22    531.700020\r\n2014-06-11     93.860001\r\n2014-10-17     97.669998\r\n2015-01-05    106.250000\r\n2015-04-16    126.169998\r\n2015-06-25    127.500000\r\n2015-12-18    106.029999\r\n2016-05-05     93.239998\r\n2016-07-08     96.680000\r\n2016-09-01    106.730003\r\nName: Close, dtype: float64</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3c213635648-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3c213635648-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-1\"><span class=\"crayon-i\">Date</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-2\"><span class=\"crayon-cn\">2010</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">253.509995</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-3\"><span class=\"crayon-cn\">2010</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">259.020000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-4\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">348.630009</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-5\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">348.510006</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-6\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">337.409992</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-7\"><span class=\"crayon-cn\">2011</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">377.410000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-8\"><span class=\"crayon-cn\">2012</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">569.180023</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-9\"><span class=\"crayon-cn\">2012</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">644.610001</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-10\"><span class=\"crayon-cn\">2013</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">398.069992</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-11\"><span class=\"crayon-cn\">2013</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">483.409996</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-12\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">506.499977</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-13\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">531.700020</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-14\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">93.860001</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-15\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">97.669998</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-16\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">106.250000</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-17\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">126.169998</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-18\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.500000</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-19\"><span class=\"crayon-cn\">2015</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">106.029999</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-20\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">93.239998</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-21\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">96.680000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3c213635648-22\"><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">106.730003</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3c213635648-23\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Close</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">float64</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p></p>\n<div>\n<div id=\"highlighter_512864\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f3f627002938\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Create a DataFrame with trades, including the price at the trade and the regime under which the trade is made.\r\napple_signals = pd.concat([\r\n        pd.DataFrame({\"Price\": apple.loc[apple[\"Signal\"] == 1, \"Close\"],\r\n                     \"Regime\": apple.loc[apple[\"Signal\"] == 1, \"Regime\"],\r\n                     \"Signal\": \"Buy\"}),\r\n        pd.DataFrame({\"Price\": apple.loc[apple[\"Signal\"] == -1, \"Close\"],\r\n                     \"Regime\": apple.loc[apple[\"Signal\"] == -1, \"Regime\"],\r\n                     \"Signal\": \"Sell\"}),\r\n    ])\r\napple_signals.sort_index(inplace = True)\r\napple_signals</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3f627002938-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3f627002938-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3f627002938-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3f627002938-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f3f627002938-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f3f627002938-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-1\"><span class=\"crayon-c\"># Create a DataFrame with trades, including the price at the trade and the regime under which the trade is made.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3f627002938-2\"><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">concat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3f627002938-4\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-5\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3f627002938-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-7\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3f627002938-8\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sell\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f3f627002938-10\"><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f3f627002938-11\"><span class=\"crayon-v\">apple_signals</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n\n</div>\n</div>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>Price</th>\n<th>Regime</th>\n<th>Signal</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-03-16</th>\n<td>224.449997</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-06-11</th>\n<td>253.509995</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<td>274.070011</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-22</th>\n<td>259.020000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-09-20</th>\n<td>283.230007</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2011-03-30</th>\n<td>348.630009</td>\n<td>0.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2011-03-31</th>\n<td>348.510006</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2011-05-12</th>\n<td>346.569988</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2011-05-27</th>\n<td>337.409992</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2011-07-14</th>\n<td>357.770004</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2011-11-17</th>\n<td>377.410000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2011-12-28</th>\n<td>402.640003</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2012-05-09</th>\n<td>569.180023</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2012-06-25</th>\n<td>570.770020</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2012-10-17</th>\n<td>644.610001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2013-05-17</th>\n<td>433.260010</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2013-06-26</th>\n<td>398.069992</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2013-07-31</th>\n<td>452.529984</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2013-10-03</th>\n<td>483.409996</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2013-10-16</th>\n<td>501.110001</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2014-01-28</th>\n<td>506.499977</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2014-03-26</th>\n<td>539.779991</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2014-04-22</th>\n<td>531.700020</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2014-04-25</th>\n<td>571.939980</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2014-06-11</th>\n<td>93.860001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2014-08-18</th>\n<td>99.160004</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2014-10-17</th>\n<td>97.669998</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2014-10-28</th>\n<td>106.739998</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2015-01-05</th>\n<td>106.250000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2015-02-05</th>\n<td>119.940002</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2015-04-16</th>\n<td>126.169998</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2015-04-28</th>\n<td>130.559998</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2015-06-25</th>\n<td>127.500000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2015-10-27</th>\n<td>114.550003</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2015-12-18</th>\n<td>106.029999</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2016-03-11</th>\n<td>102.260002</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-05-05</th>\n<td>93.239998</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2016-07-01</th>\n<td>95.889999</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-07-08</th>\n<td>96.680000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2016-07-25</th>\n<td>97.339996</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<td>106.730003</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n</tbody>\n</table>\n</div>\n<div>\n<div id=\"highlighter_212918\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f4a484977707\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Let's see the profitability of long trades\r\napple_long_profits = pd.DataFrame({\r\n        \"Price\": apple_signals.loc[(apple_signals[\"Signal\"] == \"Buy\") &amp;\r\n                                  apple_signals[\"Regime\"] == 1, \"Price\"],\r\n        \"Profit\": pd.Series(apple_signals[\"Price\"] - apple_signals[\"Price\"].shift(1)).loc[\r\n            apple_signals.loc[(apple_signals[\"Signal\"].shift(1) == \"Buy\") &amp; (apple_signals[\"Regime\"].shift(1) == 1)].index\r\n        ].tolist(),\r\n        \"End Date\": apple_signals[\"Price\"].loc[\r\n            apple_signals.loc[(apple_signals[\"Signal\"].shift(1) == \"Buy\") &amp; (apple_signals[\"Regime\"].shift(1) == 1)].index\r\n        ].index\r\n    })\r\napple_long_profits</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f4a484977707-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f4a484977707-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-1\"><span class=\"crayon-c\"># Let's see the profitability of long trades</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-2\"><span class=\"crayon-v\">apple_long_profits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-4\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tolist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f4a484977707-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f4a484977707-12\"><span class=\"crayon-v\">apple_long_profits</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n\n</div>\n</div>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>End Date</th>\n<th>Price</th>\n<th>Profit</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-03-16</th>\n<td>2010-06-11</td>\n<td>224.449997</td>\n<td>29.059998</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<td>2010-07-22</td>\n<td>274.070011</td>\n<td>-15.050011</td>\n</tr>\n<tr>\n<th>2010-09-20</th>\n<td>2011-03-30</td>\n<td>283.230007</td>\n<td>65.400002</td>\n</tr>\n<tr>\n<th>2011-05-12</th>\n<td>2011-05-27</td>\n<td>346.569988</td>\n<td>-9.159996</td>\n</tr>\n<tr>\n<th>2011-07-14</th>\n<td>2011-11-17</td>\n<td>357.770004</td>\n<td>19.639996</td>\n</tr>\n<tr>\n<th>2011-12-28</th>\n<td>2012-05-09</td>\n<td>402.640003</td>\n<td>166.540020</td>\n</tr>\n<tr>\n<th>2012-06-25</th>\n<td>2012-10-17</td>\n<td>570.770020</td>\n<td>73.839981</td>\n</tr>\n<tr>\n<th>2013-05-17</th>\n<td>2013-06-26</td>\n<td>433.260010</td>\n<td>-35.190018</td>\n</tr>\n<tr>\n<th>2013-07-31</th>\n<td>2013-10-03</td>\n<td>452.529984</td>\n<td>30.880012</td>\n</tr>\n<tr>\n<th>2013-10-16</th>\n<td>2014-01-28</td>\n<td>501.110001</td>\n<td>5.389976</td>\n</tr>\n<tr>\n<th>2014-03-26</th>\n<td>2014-04-22</td>\n<td>539.779991</td>\n<td>-8.079971</td>\n</tr>\n<tr>\n<th>2014-04-25</th>\n<td>2014-06-11</td>\n<td>571.939980</td>\n<td>-478.079979</td>\n</tr>\n<tr>\n<th>2014-08-18</th>\n<td>2014-10-17</td>\n<td>99.160004</td>\n<td>-1.490006</td>\n</tr>\n<tr>\n<th>2014-10-28</th>\n<td>2015-01-05</td>\n<td>106.739998</td>\n<td>-0.489998</td>\n</tr>\n<tr>\n<th>2015-02-05</th>\n<td>2015-04-16</td>\n<td>119.940002</td>\n<td>6.229996</td>\n</tr>\n<tr>\n<th>2015-04-28</th>\n<td>2015-06-25</td>\n<td>130.559998</td>\n<td>-3.059998</td>\n</tr>\n<tr>\n<th>2015-10-27</th>\n<td>2015-12-18</td>\n<td>114.550003</td>\n<td>-8.520004</td>\n</tr>\n<tr>\n<th>2016-03-11</th>\n<td>2016-05-05</td>\n<td>102.260002</td>\n<td>-9.020004</td>\n</tr>\n<tr>\n<th>2016-07-01</th>\n<td>2016-07-08</td>\n<td>95.889999</td>\n<td>0.790001</td>\n</tr>\n<tr>\n<th>2016-07-25</th>\n<td>2016-09-01</td>\n<td>97.339996</td>\n<td>9.390007</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>从上表可以看出2013年5月17日那天苹果公司股票价格大跌，我们的系统会表现很差。但是那个价格下降不是因为苹果遇到了什么大危机，而仅仅是一次分股。由于分红不如分股那么显著，这也许会影响系统行为。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f51918034510\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Let's see the result over the whole period for which we have Apple data\r\npandas_candlestick_ohlc(apple, stick = 45, otherseries = [\"20d\", \"50d\", \"200d\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f51918034510-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f51918034510-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f51918034510-1\"><span class=\"crayon-c\"># Let's see the result over the whole period for which we have Apple data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f51918034510-2\"><span class=\"crayon-e\">pandas_candlestick_ohlc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">otherseries</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"20d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"50d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"200d\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1firhycvbo9j20iw0bqgn6.jpg\"></p>\n<p>我们不希望我们的交易系统的表现受到分红和分股的影响。一个解决方案是利用历史的分红分股数据来设计交易系统，这些数据可以真实地反映股市的行为从而帮助我们找到最佳解决方案，但是这个方法要更复杂一些。另一个方案就是根据分红和分股来调整股票的价格。</p>\n<p>雅虎财经只提供调整之后的股票闭市价格，不过这些对于我们调整开市，高价和低价已经足够了。调整闭市股价是这样实现的：</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1firhnaoet0j20m0027t8n.jpg\"></p>\n<p>让我们回到开始，先调整股票价格，然后再来评价我们的交易系统。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f56136363765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef ohlc_adj(dat):\r\n    \"\"\"\r\n    :param dat: pandas DataFrame with stock data, including \"Open\", \"High\", \"Low\", \"Close\", and \"Adj Close\", with \"Adj Close\" containing adjusted closing prices\r\n \r\n    :return: pandas DataFrame with adjusted stock data\r\n \r\n    This function adjusts stock data for splits, dividends, etc., returning a data frame with\r\n    \"Open\", \"High\", \"Low\" and \"Close\" columns. The input DataFrame is similar to that returned\r\n    by pandas Yahoo! Finance API.\r\n    \"\"\"\r\n    return pd.DataFrame({\"Open\": dat[\"Open\"] * dat[\"Adj Close\"] / dat[\"Close\"],\r\n                       \"High\": dat[\"High\"] * dat[\"Adj Close\"] / dat[\"Close\"],\r\n                       \"Low\": dat[\"Low\"] * dat[\"Adj Close\"] / dat[\"Close\"],\r\n                       \"Close\": dat[\"Adj Close\"]})\r\n \r\napple_adj = ohlc_adj(apple)\r\n \r\n# This next code repeats all the earlier analysis we did on the adjusted data\r\n \r\napple_adj[\"20d\"] = np.round(apple_adj[\"Close\"].rolling(window = 20, center = False).mean(), 2)\r\napple_adj[\"50d\"] = np.round(apple_adj[\"Close\"].rolling(window = 50, center = False).mean(), 2)\r\napple_adj[\"200d\"] = np.round(apple_adj[\"Close\"].rolling(window = 200, center = False).mean(), 2)\r\n \r\napple_adj['20d-50d'] = apple_adj['20d'] - apple_adj['50d']\r\n# np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not\r\napple_adj[\"Regime\"] = np.where(apple_adj['20d-50d'] &gt; 0, 1, 0)\r\n# We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]\r\napple_adj[\"Regime\"] = np.where(apple_adj['20d-50d'] &lt; 0, -1, apple_adj[\"Regime\"])\r\n# To ensure that all trades close out, I temporarily change the regime of the last row to 0\r\nregime_orig = apple_adj.ix[-1, \"Regime\"]\r\napple_adj.ix[-1, \"Regime\"] = 0\r\napple_adj[\"Signal\"] = np.sign(apple_adj[\"Regime\"] - apple_adj[\"Regime\"].shift(1))\r\n# Restore original regime data\r\napple_adj.ix[-1, \"Regime\"] = regime_orig\r\n \r\n# Create a DataFrame with trades, including the price at the trade and the regime under which the trade is made.\r\napple_adj_signals = pd.concat([\r\n        pd.DataFrame({\"Price\": apple_adj.loc[apple_adj[\"Signal\"] == 1, \"Close\"],\r\n                     \"Regime\": apple_adj.loc[apple_adj[\"Signal\"] == 1, \"Regime\"],\r\n                     \"Signal\": \"Buy\"}),\r\n        pd.DataFrame({\"Price\": apple_adj.loc[apple_adj[\"Signal\"] == -1, \"Close\"],\r\n                     \"Regime\": apple_adj.loc[apple_adj[\"Signal\"] == -1, \"Regime\"],\r\n                     \"Signal\": \"Sell\"}),\r\n    ])\r\napple_adj_signals.sort_index(inplace = True)\r\napple_adj_long_profits = pd.DataFrame({\r\n        \"Price\": apple_adj_signals.loc[(apple_adj_signals[\"Signal\"] == \"Buy\") &amp;\r\n                                  apple_adj_signals[\"Regime\"] == 1, \"Price\"],\r\n        \"Profit\": pd.Series(apple_adj_signals[\"Price\"] - apple_adj_signals[\"Price\"].shift(1)).loc[\r\n            apple_adj_signals.loc[(apple_adj_signals[\"Signal\"].shift(1) == \"Buy\") &amp; (apple_adj_signals[\"Regime\"].shift(1) == 1)].index\r\n        ].tolist(),\r\n        \"End Date\": apple_adj_signals[\"Price\"].loc[\r\n            apple_adj_signals.loc[(apple_adj_signals[\"Signal\"].shift(1) == \"Buy\") &amp; (apple_adj_signals[\"Regime\"].shift(1) == 1)].index\r\n        ].index\r\n    })\r\n \r\npandas_candlestick_ohlc(apple_adj, stick = 45, otherseries = [\"20d\", \"50d\", \"200d\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f56136363765-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f56136363765-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-3\"><span class=\"crayon-s\">    :param dat: pandas DataFrame with stock data, including \"Open\", \"High\", \"Low\", \"Close\", and \"Adj Close\", with \"Adj Close\" containing adjusted closing prices</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-4\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-5\"><span class=\"crayon-s\">    :return: pandas DataFrame with adjusted stock data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-6\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-7\"><span class=\"crayon-s\">    This function adjusts stock data for splits, dividends, etc., returning a data frame with</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-8\"><span class=\"crayon-s\">    \"Open\", \"High\", \"Low\" and \"Close\" columns. The input DataFrame is similar to that returned</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-9\"><span class=\"crayon-s\">    by pandas Yahoo! Finance API.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-10\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Open\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Open\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-12\"><span class=\"crayon-h\">                       </span><span class=\"crayon-s\">\"High\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"High\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-13\"><span class=\"crayon-h\">                       </span><span class=\"crayon-s\">\"Low\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Low\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-14\"><span class=\"crayon-h\">                       </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-16\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-18\"><span class=\"crayon-c\"># This next code repeats all the earlier analysis we did on the adjusted data</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-19\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-20\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"20d\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rolling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-21\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"50d\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rolling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-22\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"200d\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rolling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-23\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-24\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'50d'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-25\"><span class=\"crayon-c\"># np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-26\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-27\"><span class=\"crayon-c\"># We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-28\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'20d-50d'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-29\"><span class=\"crayon-c\"># To ensure that all trades close out, I temporarily change the regime of the last row to 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-30\"><span class=\"crayon-v\">regime_orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-31\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-32\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-33\"><span class=\"crayon-c\"># Restore original regime data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-34\"><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">regime_orig</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-35\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-36\"><span class=\"crayon-c\"># Create a DataFrame with trades, including the price at the trade and the regime under which the trade is made.</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-37\"><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">concat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-39\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-40\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-42\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-43\"><span class=\"crayon-h\">                     </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sell\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-45\"><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-46\"><span class=\"crayon-v\">apple_adj_long_profits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-48\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tolist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj_signals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">index</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f56136363765-56\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f56136363765-57\"><span class=\"crayon-e\">pandas_candlestick_ohlc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">otherseries</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"20d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"50d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"200d\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0160 seconds] -->\r\n<p></p>\n<div> <img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1firhyce1bcj20iw0bqwg1.jpg\"></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f5f691436841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple_adj_long_profits</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f5f691436841-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f5f691436841-1\"><span class=\"crayon-v\">apple_adj_long_profits</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>End Date</th>\n<th>Price</th>\n<th>Profit</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-03-16</th>\n<td>2010-06-10</td>\n<td>29.355667</td>\n<td>3.408371</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<td>2010-07-22</td>\n<td>35.845436</td>\n<td>-1.968381</td>\n</tr>\n<tr>\n<th>2010-09-20</th>\n<td>2011-03-30</td>\n<td>37.043466</td>\n<td>8.553623</td>\n</tr>\n<tr>\n<th>2011-05-12</th>\n<td>2011-05-27</td>\n<td>45.327660</td>\n<td>-1.198030</td>\n</tr>\n<tr>\n<th>2011-07-14</th>\n<td>2011-11-17</td>\n<td>46.792503</td>\n<td>2.568702</td>\n</tr>\n<tr>\n<th>2011-12-28</th>\n<td>2012-05-09</td>\n<td>52.661020</td>\n<td>21.781659</td>\n</tr>\n<tr>\n<th>2012-06-25</th>\n<td>2012-10-17</td>\n<td>74.650634</td>\n<td>10.019459</td>\n</tr>\n<tr>\n<th>2013-05-17</th>\n<td>2013-06-26</td>\n<td>57.882798</td>\n<td>-4.701326</td>\n</tr>\n<tr>\n<th>2013-07-31</th>\n<td>2013-10-04</td>\n<td>60.457234</td>\n<td>4.500835</td>\n</tr>\n<tr>\n<th>2013-10-16</th>\n<td>2014-01-28</td>\n<td>67.389473</td>\n<td>1.122523</td>\n</tr>\n<tr>\n<th>2014-03-11</th>\n<td>2014-03-17</td>\n<td>72.948554</td>\n<td>-1.272298</td>\n</tr>\n<tr>\n<th>2014-03-24</th>\n<td>2014-04-22</td>\n<td>73.370393</td>\n<td>-1.019203</td>\n</tr>\n<tr>\n<th>2014-04-25</th>\n<td>2014-10-17</td>\n<td>77.826851</td>\n<td>16.191371</td>\n</tr>\n<tr>\n<th>2014-10-28</th>\n<td>2015-01-05</td>\n<td>102.749105</td>\n<td>-0.028185</td>\n</tr>\n<tr>\n<th>2015-02-05</th>\n<td>2015-04-16</td>\n<td>116.413846</td>\n<td>6.046838</td>\n</tr>\n<tr>\n<th>2015-04-28</th>\n<td>2015-06-26</td>\n<td>126.721620</td>\n<td>-3.184117</td>\n</tr>\n<tr>\n<th>2015-10-27</th>\n<td>2015-12-18</td>\n<td>112.152083</td>\n<td>-7.897288</td>\n</tr>\n<tr>\n<th>2016-03-10</th>\n<td>2016-05-05</td>\n<td>100.015950</td>\n<td>-7.278331</td>\n</tr>\n<tr>\n<th>2016-06-23</th>\n<td>2016-06-27</td>\n<td>95.582210</td>\n<td>-4.038123</td>\n</tr>\n<tr>\n<th>2016-06-30</th>\n<td>2016-07-11</td>\n<td>95.084904</td>\n<td>1.372569</td>\n</tr>\n<tr>\n<th>2016-07-25</th>\n<td>2016-09-01</td>\n<td>96.815526</td>\n<td>9.914477</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>可以看到根据分红和分股调整之后的价格图变得很不一样了。之后的分析我们都会用到这个调整之后的数据。</p>\n<p>假设我们在股市有一百万，让我们来看看根据下面的条件，我们的系统会如何反应：</p>\n<ul>\n<li>每次用总额的10%来进行交易</li>\n<li>退出头寸如果亏损达到了交易额的20%</li>\n</ul>\n<p>模拟的时候要记住：</p>\n<ul>\n<li>每次交易有100支股票</li>\n<li>我们的避损规则是当股票价格下降到一定数值时就抛出。我们需要检查这段时间内的低价是否低到可以出发避损规则。现实中除非我们买入看空期权，我们无法保证我们能以设定低值价格卖出股票。这里为了简洁我们将设定值作为卖出值。</li>\n<li>每次交易都会付给中介一定的佣金。这里我们没有考虑这个。</li>\n</ul>\n<p>下面的代码演示了如何实现回溯测试：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f65271007689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# We need to get the low of the price during each trade.\r\ntradeperiods =pd.DataFrame({\"Start\": apple_adj_long_profits.index,\r\n                            \"End\": apple_adj_long_profits[\"End Date\"]})\r\napple_adj_long_profits[\"Low\"] =tradeperiods.apply(lambdax: min(apple_adj.loc[x[\"Start\"]:x[\"End\"], \"Low\"]), axis =1)\r\napple_adj_long_profits</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f65271007689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f65271007689-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f65271007689-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f65271007689-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f65271007689-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f65271007689-1\"><span class=\"crayon-c\"># We need to get the low of the price during each trade.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f65271007689-2\"><span class=\"crayon-v\">tradeperiods</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Start\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj_long_profits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f65271007689-3\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"End\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple_adj_long_profits</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f65271007689-4\"><span class=\"crayon-v\">apple_adj_long_profits</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Low\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tradeperiods</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambdax</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple_adj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Start\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"End\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Low\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">axis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f65271007689-5\"><span class=\"crayon-v\">apple_adj_long_profits</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>End Date</th>\n<th>Price</th>\n<th>Profit</th>\n<th>Low</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-03-16</th>\n<td>2010-06-10</td>\n<td>29.355667</td>\n<td>3.408371</td>\n<td>26.059775</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<td>2010-07-22</td>\n<td>35.845436</td>\n<td>-1.968381</td>\n<td>31.337127</td>\n</tr>\n<tr>\n<th>2010-09-20</th>\n<td>2011-03-30</td>\n<td>37.043466</td>\n<td>8.553623</td>\n<td>35.967068</td>\n</tr>\n<tr>\n<th>2011-05-12</th>\n<td>2011-05-27</td>\n<td>45.327660</td>\n<td>-1.198030</td>\n<td>43.084626</td>\n</tr>\n<tr>\n<th>2011-07-14</th>\n<td>2011-11-17</td>\n<td>46.792503</td>\n<td>2.568702</td>\n<td>46.171251</td>\n</tr>\n<tr>\n<th>2011-12-28</th>\n<td>2012-05-09</td>\n<td>52.661020</td>\n<td>21.781659</td>\n<td>52.382438</td>\n</tr>\n<tr>\n<th>2012-06-25</th>\n<td>2012-10-17</td>\n<td>74.650634</td>\n<td>10.019459</td>\n<td>73.975759</td>\n</tr>\n<tr>\n<th>2013-05-17</th>\n<td>2013-06-26</td>\n<td>57.882798</td>\n<td>-4.701326</td>\n<td>52.859502</td>\n</tr>\n<tr>\n<th>2013-07-31</th>\n<td>2013-10-04</td>\n<td>60.457234</td>\n<td>4.500835</td>\n<td>60.043080</td>\n</tr>\n<tr>\n<th>2013-10-16</th>\n<td>2014-01-28</td>\n<td>67.389473</td>\n<td>1.122523</td>\n<td>67.136651</td>\n</tr>\n<tr>\n<th>2014-03-11</th>\n<td>2014-03-17</td>\n<td>72.948554</td>\n<td>-1.272298</td>\n<td>71.167335</td>\n</tr>\n<tr>\n<th>2014-03-24</th>\n<td>2014-04-22</td>\n<td>73.370393</td>\n<td>-1.019203</td>\n<td>69.579335</td>\n</tr>\n<tr>\n<th>2014-04-25</th>\n<td>2014-10-17</td>\n<td>77.826851</td>\n<td>16.191371</td>\n<td>76.740971</td>\n</tr>\n<tr>\n<th>2014-10-28</th>\n<td>2015-01-05</td>\n<td>102.749105</td>\n<td>-0.028185</td>\n<td>101.411076</td>\n</tr>\n<tr>\n<th>2015-02-05</th>\n<td>2015-04-16</td>\n<td>116.413846</td>\n<td>6.046838</td>\n<td>114.948237</td>\n</tr>\n<tr>\n<th>2015-04-28</th>\n<td>2015-06-26</td>\n<td>126.721620</td>\n<td>-3.184117</td>\n<td>119.733299</td>\n</tr>\n<tr>\n<th>2015-10-27</th>\n<td>2015-12-18</td>\n<td>112.152083</td>\n<td>-7.897288</td>\n<td>104.038477</td>\n</tr>\n<tr>\n<th>2016-03-10</th>\n<td>2016-05-05</td>\n<td>100.015950</td>\n<td>-7.278331</td>\n<td>91.345994</td>\n</tr>\n<tr>\n<th>2016-06-23</th>\n<td>2016-06-27</td>\n<td>95.582210</td>\n<td>-4.038123</td>\n<td>91.006996</td>\n</tr>\n<tr>\n<th>2016-06-30</th>\n<td>2016-07-11</td>\n<td>95.084904</td>\n<td>1.372569</td>\n<td>93.791913</td>\n</tr>\n<tr>\n<th>2016-07-25</th>\n<td>2016-09-01</td>\n<td>96.815526</td>\n<td>9.914477</td>\n<td>95.900485</td>\n</tr>\n</tbody>\n</table>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f6b237875943\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Now we have all the information needed to simulate this strategy in apple_adj_long_profits\r\ncash =1000000\r\napple_backtest =pd.DataFrame({\"Start Port. Value\": [],\r\n                         \"End Port. Value\": [],\r\n                         \"End Date\": [],\r\n                         \"Shares\": [],\r\n                         \"Share Price\": [],\r\n                         \"Trade Value\": [],\r\n                         \"Profit per Share\": [],\r\n                         \"Total Profit\": [],\r\n                         \"Stop-Loss Triggered\": []})\r\nport_value =.1# Max proportion of portfolio bet on any trade\r\nbatch =100# Number of shares bought per batch\r\nstoploss =.2# % of trade loss that would trigger a stoploss\r\nforindex, row inapple_adj_long_profits.iterrows():\r\n    batches =np.floor(cash *port_value) //np.ceil(batch *row[\"Price\"]) # Maximum number of batches of stocks invested in\r\n    trade_val =batches *batch *row[\"Price\"] # How much money is put on the line with each trade\r\n    ifrow[\"Low\"] &lt; (1-stoploss) *row[\"Price\"]:   # Account for the stop-loss\r\n        share_profit =np.round((1-stoploss) *row[\"Price\"], 2)\r\n        stop_trig =True\r\n    else:\r\n        share_profit =row[\"Profit\"]\r\n        stop_trig =False\r\n    profit =share_profit *batches *batch # Compute profits\r\n    # Add a row to the backtest data frame containing the results of the trade\r\n    apple_backtest =apple_backtest.append(pd.DataFrame({\r\n                \"Start Port. Value\": cash,\r\n                \"End Port. Value\": cash +profit,\r\n                \"End Date\": row[\"End Date\"],\r\n                \"Shares\": batch *batches,\r\n                \"Share Price\": row[\"Price\"],\r\n                \"Trade Value\": trade_val,\r\n                \"Profit per Share\": share_profit,\r\n                \"Total Profit\": profit,\r\n                \"Stop-Loss Triggered\": stop_trig\r\n            }, index =[index]))\r\n    cash =max(0, cash +profit)\r\n \r\napple_backtest</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f6b237875943-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f6b237875943-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-1\"><span class=\"crayon-c\"># Now we have all the information needed to simulate this strategy in apple_adj_long_profits</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-2\"><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-3\"><span class=\"crayon-v\">apple_backtest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Start Port. Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-4\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"End Port. Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-5\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-6\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Shares\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-7\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Share Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-8\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Trade Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-9\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Profit per Share\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-10\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Total Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-11\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Stop-Loss Triggered\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-12\"><span class=\"crayon-v\">port_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span><span class=\"crayon-c\"># Max proportion of portfolio bet on any trade</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-13\"><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-c\"># Number of shares bought per batch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-14\"><span class=\"crayon-v\">stoploss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span><span class=\"crayon-c\"># % of trade loss that would trigger a stoploss</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-15\"><span class=\"crayon-v\">forindex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-v\">inapple_adj_long_profits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iterrows</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">port_value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ceil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Maximum number of batches of stocks invested in</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># How much money is put on the line with each trade</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ifrow</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Low\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stoploss</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># Account for the stop-loss</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">share_profit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stoploss</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">stop_trig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">share_profit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Profit\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">stop_trig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">profit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">share_profit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Compute profits</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Add a row to the backtest data frame containing the results of the trade</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">apple_backtest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">apple_backtest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Start Port. Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"End Port. Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">profit</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"End Date\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Shares\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batches</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Share Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Trade Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Profit per Share\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">share_profit</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Total Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">profit</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Stop-Loss Triggered\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stop</span><span class=\"crayon-sy\">_</span>trig</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">profit</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f6b237875943-38\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f6b237875943-39\"><span class=\"crayon-v\">apple_backtest</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p>\n</p></div>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>End Date</th>\n<th>End Port. Value</th>\n<th>Profit per Share</th>\n<th>Share Price</th>\n<th>Shares</th>\n<th>Start Port. Value</th>\n<th>Stop-Loss Triggered</th>\n<th>Total Profit</th>\n<th>Trade Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-03-16</th>\n<td>2010-06-10</td>\n<td>1.011588e+06</td>\n<td>3.408371</td>\n<td>29.355667</td>\n<td>3400.0</td>\n<td>1.000000e+06</td>\n<td>0.0</td>\n<td>11588.4614</td>\n<td>99809.2678</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<td>2010-07-22</td>\n<td>1.006077e+06</td>\n<td>-1.968381</td>\n<td>35.845436</td>\n<td>2800.0</td>\n<td>1.011588e+06</td>\n<td>0.0</td>\n<td>-5511.4668</td>\n<td>100367.2208</td>\n</tr>\n<tr>\n<th>2010-09-20</th>\n<td>2011-03-30</td>\n<td>1.029172e+06</td>\n<td>8.553623</td>\n<td>37.043466</td>\n<td>2700.0</td>\n<td>1.006077e+06</td>\n<td>0.0</td>\n<td>23094.7821</td>\n<td>100017.3582</td>\n</tr>\n<tr>\n<th>2011-05-12</th>\n<td>2011-05-27</td>\n<td>1.026536e+06</td>\n<td>-1.198030</td>\n<td>45.327660</td>\n<td>2200.0</td>\n<td>1.029172e+06</td>\n<td>0.0</td>\n<td>-2635.6660</td>\n<td>99720.8520</td>\n</tr>\n<tr>\n<th>2011-07-14</th>\n<td>2011-11-17</td>\n<td>1.031930e+06</td>\n<td>2.568702</td>\n<td>46.792503</td>\n<td>2100.0</td>\n<td>1.026536e+06</td>\n<td>0.0</td>\n<td>5394.2742</td>\n<td>98264.2563</td>\n</tr>\n<tr>\n<th>2011-12-28</th>\n<td>2012-05-09</td>\n<td>1.073316e+06</td>\n<td>21.781659</td>\n<td>52.661020</td>\n<td>1900.0</td>\n<td>1.031930e+06</td>\n<td>0.0</td>\n<td>41385.1521</td>\n<td>100055.9380</td>\n</tr>\n<tr>\n<th>2012-06-25</th>\n<td>2012-10-17</td>\n<td>1.087343e+06</td>\n<td>10.019459</td>\n<td>74.650634</td>\n<td>1400.0</td>\n<td>1.073316e+06</td>\n<td>0.0</td>\n<td>14027.2426</td>\n<td>104510.8876</td>\n</tr>\n<tr>\n<th>2013-05-17</th>\n<td>2013-06-26</td>\n<td>1.078880e+06</td>\n<td>-4.701326</td>\n<td>57.882798</td>\n<td>1800.0</td>\n<td>1.087343e+06</td>\n<td>0.0</td>\n<td>-8462.3868</td>\n<td>104189.0364</td>\n</tr>\n<tr>\n<th>2013-07-31</th>\n<td>2013-10-04</td>\n<td>1.086532e+06</td>\n<td>4.500835</td>\n<td>60.457234</td>\n<td>1700.0</td>\n<td>1.078880e+06</td>\n<td>0.0</td>\n<td>7651.4195</td>\n<td>102777.2978</td>\n</tr>\n<tr>\n<th>2013-10-16</th>\n<td>2014-01-28</td>\n<td>1.088328e+06</td>\n<td>1.122523</td>\n<td>67.389473</td>\n<td>1600.0</td>\n<td>1.086532e+06</td>\n<td>0.0</td>\n<td>1796.0368</td>\n<td>107823.1568</td>\n</tr>\n<tr>\n<th>2014-03-11</th>\n<td>2014-03-17</td>\n<td>1.086547e+06</td>\n<td>-1.272298</td>\n<td>72.948554</td>\n<td>1400.0</td>\n<td>1.088328e+06</td>\n<td>0.0</td>\n<td>-1781.2172</td>\n<td>102127.9756</td>\n</tr>\n<tr>\n<th>2014-03-24</th>\n<td>2014-04-22</td>\n<td>1.085120e+06</td>\n<td>-1.019203</td>\n<td>73.370393</td>\n<td>1400.0</td>\n<td>1.086547e+06</td>\n<td>0.0</td>\n<td>-1426.8842</td>\n<td>102718.5502</td>\n</tr>\n<tr>\n<th>2014-04-25</th>\n<td>2014-10-17</td>\n<td>1.106169e+06</td>\n<td>16.191371</td>\n<td>77.826851</td>\n<td>1300.0</td>\n<td>1.085120e+06</td>\n<td>0.0</td>\n<td>21048.7823</td>\n<td>101174.9063</td>\n</tr>\n<tr>\n<th>2014-10-28</th>\n<td>2015-01-05</td>\n<td>1.106140e+06</td>\n<td>-0.028185</td>\n<td>102.749105</td>\n<td>1000.0</td>\n<td>1.106169e+06</td>\n<td>0.0</td>\n<td>-28.1850</td>\n<td>102749.1050</td>\n</tr>\n<tr>\n<th>2015-02-05</th>\n<td>2015-04-16</td>\n<td>1.111582e+06</td>\n<td>6.046838</td>\n<td>116.413846</td>\n<td>900.0</td>\n<td>1.106140e+06</td>\n<td>0.0</td>\n<td>5442.1542</td>\n<td>104772.4614</td>\n</tr>\n<tr>\n<th>2015-04-28</th>\n<td>2015-06-26</td>\n<td>1.109035e+06</td>\n<td>-3.184117</td>\n<td>126.721620</td>\n<td>800.0</td>\n<td>1.111582e+06</td>\n<td>0.0</td>\n<td>-2547.2936</td>\n<td>101377.2960</td>\n</tr>\n<tr>\n<th>2015-10-27</th>\n<td>2015-12-18</td>\n<td>1.101928e+06</td>\n<td>-7.897288</td>\n<td>112.152083</td>\n<td>900.0</td>\n<td>1.109035e+06</td>\n<td>0.0</td>\n<td>-7107.5592</td>\n<td>100936.8747</td>\n</tr>\n<tr>\n<th>2016-03-10</th>\n<td>2016-05-05</td>\n<td>1.093921e+06</td>\n<td>-7.278331</td>\n<td>100.015950</td>\n<td>1100.0</td>\n<td>1.101928e+06</td>\n<td>0.0</td>\n<td>-8006.1641</td>\n<td>110017.5450</td>\n</tr>\n<tr>\n<th>2016-06-23</th>\n<td>2016-06-27</td>\n<td>1.089480e+06</td>\n<td>-4.038123</td>\n<td>95.582210</td>\n<td>1100.0</td>\n<td>1.093921e+06</td>\n<td>0.0</td>\n<td>-4441.9353</td>\n<td>105140.4310</td>\n</tr>\n<tr>\n<th>2016-06-30</th>\n<td>2016-07-11</td>\n<td>1.090989e+06</td>\n<td>1.372569</td>\n<td>95.084904</td>\n<td>1100.0</td>\n<td>1.089480e+06</td>\n<td>0.0</td>\n<td>1509.8259</td>\n<td>104593.3944</td>\n</tr>\n<tr>\n<th>2016-07-25</th>\n<td>2016-09-01</td>\n<td>1.101895e+06</td>\n<td>9.914477</td>\n<td>96.815526</td>\n<td>1100.0</td>\n<td>1.090989e+06</td>\n<td>0.0</td>\n<td>10905.9247</td>\n<td>106497.0786</td>\n</tr>\n</tbody>\n</table>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f74561579791\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napple_backtest[\"End Port. Value\"].plot()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f74561579791-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f74561579791-1\"><span class=\"crayon-v\">apple_backtest</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"End Port. Value\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></div>\n<div></div>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1firhyc2ic0j20iw0ag0sy.jpg\"></p>\n<p>我们的财产总额六年增加了10%。考虑到每次交易额只有总额的10%，这个成绩不算差。</p>\n<p>同时我们也注意到这个策略并没有引发停止损失委托。这意味着我们可以不需要它么？这个难说。毕竟这个激发事件完全取决于我们的设定值。</p>\n<p>停止损失委托是被自动激活的，它并不会考虑股市整体走势。也就是说不论是股市真正的走低还是暂时的波动都会激发停止损失委托。而后者是我们需要注意的因为在现实中，由价格波动激发停止损失委托不仅让你支出一笔交易费用，同时还无法保证最终的卖出价格是你设定的价格。</p>\n<p>下面的链接分别<a href=\"http://www.investopedia.com/articles/stocks/09/use-stop-loss.asp\">支持</a>和<a href=\"http://www.marketwatch.com/story/why-i-stopped-using-stop-loss-orders-2013-05-09\">反对</a>使用停止损失委托，但是之后的内容我不会要求我们的回溯测试系统使用它。这样可以简化系统，但不是很符合实际（我相信工业系统应该有停止损失委托）。</p>\n<p>现实中我们不会只用总额的10%去押一支股票而是投资多种股票。在给定的时间可以跟不同公司同时交易，而且大部分财产应该在股票上，而不是现金。现在我们开始投资多支股票 （原文是stops，感觉是typo，译文按照stocks翻译），并且在两条移动平均线交叉的时候退市（不使用止损）。我们需要改变回溯测试的代码。我们会用一个pandas的DataFrame来存储所有股票的买卖，上一层的循环也需要记录更多的信息。</p>\n<p>下面的函数用于产生买卖订单，以及另一回溯测试函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f79676088665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndefma_crossover_orders(stocks, fast, slow):\r\n    \"\"\"\r\n    :param stocks: A list of tuples, the first argument in each tuple being a string containing the ticker symbol of each stock (or however you want the stock represented, so long as it's unique), and the second being a pandas DataFrame containing the stocks, with a \"Close\" column and indexing by date (like the data frames returned by the Yahoo! Finance API)\r\n    :param fast: Integer for the number of days used in the fast moving average\r\n    :param slow: Integer for the number of days used in the slow moving average\r\n \r\n    :return: pandas DataFrame containing stock orders\r\n \r\n    This function takes a list of stocks and determines when each stock would be bought or sold depending on a moving average crossover strategy, returning a data frame with information about when the stocks in the portfolio are bought or sold according to the strategy\r\n    \"\"\"\r\n    fast_str =str(fast) +'d'\r\n    slow_str =str(slow) +'d'\r\n    ma_diff_str =fast_str +'-'+slow_str\r\n \r\n    trades =pd.DataFrame({\"Price\": [], \"Regime\": [], \"Signal\": []})\r\n    fors instocks:\r\n        # Get the moving averages, both fast and slow, along with the difference in the moving averages\r\n        s[1][fast_str] =np.round(s[1][\"Close\"].rolling(window =fast, center =False).mean(), 2)\r\n        s[1][slow_str] =np.round(s[1][\"Close\"].rolling(window =slow, center =False).mean(), 2)\r\n        s[1][ma_diff_str] =s[1][fast_str] -s[1][slow_str]\r\n \r\n        # np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not\r\n        s[1][\"Regime\"] =np.where(s[1][ma_diff_str] &gt; 0, 1, 0)\r\n        # We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]\r\n        s[1][\"Regime\"] =np.where(s[1][ma_diff_str] &lt; 0, -1, s[1][\"Regime\"])\r\n        # To ensure that all trades close out, I temporarily change the regime of the last row to 0\r\n        regime_orig =s[1].ix[-1, \"Regime\"]\r\n        s[1].ix[-1, \"Regime\"] =0\r\n        s[1][\"Signal\"] =np.sign(s[1][\"Regime\"] -s[1][\"Regime\"].shift(1))\r\n        # Restore original regime data\r\n        s[1].ix[-1, \"Regime\"] =regime_orig\r\n \r\n        # Get signals\r\n        signals =pd.concat([\r\n            pd.DataFrame({\"Price\": s[1].loc[s[1][\"Signal\"] ==1, \"Close\"],\r\n                         \"Regime\": s[1].loc[s[1][\"Signal\"] ==1, \"Regime\"],\r\n                         \"Signal\": \"Buy\"}),\r\n            pd.DataFrame({\"Price\": s[1].loc[s[1][\"Signal\"] ==-1, \"Close\"],\r\n                         \"Regime\": s[1].loc[s[1][\"Signal\"] ==-1, \"Regime\"],\r\n                         \"Signal\": \"Sell\"}),\r\n        ])\r\n        signals.index =pd.MultiIndex.from_product([signals.index, [s[0]]], names =[\"Date\", \"Symbol\"])\r\n        trades =trades.append(signals)\r\n \r\n    trades.sort_index(inplace =True)\r\n    trades.index =pd.MultiIndex.from_tuples(trades.index, names =[\"Date\", \"Symbol\"])\r\n \r\n    returntrades\r\n \r\n \r\ndefbacktest(signals, cash, port_value =.1, batch =100):\r\n    \"\"\"\r\n    :param signals: pandas DataFrame containing buy and sell signals with stock prices and symbols, like that returned by ma_crossover_orders\r\n    :param cash: integer for starting cash value\r\n    :param port_value: maximum proportion of portfolio to risk on any single trade\r\n    :param batch: Trading batch sizes\r\n \r\n    :return: pandas DataFrame with backtesting results\r\n \r\n    This function backtests strategies, with the signals generated by the strategies being passed in the signals DataFrame. A fictitious portfolio is simulated and the returns generated by this portfolio are reported.\r\n    \"\"\"\r\n \r\n    SYMBOL =1# Constant for which element in index represents symbol\r\n    portfolio =dict()    # Will contain how many stocks are in the portfolio for a given symbol\r\n    port_prices =dict()  # Tracks old trade prices for determining profits\r\n    # Dataframe that will contain backtesting report\r\n    results =pd.DataFrame({\"Start Cash\": [],\r\n                            \"End Cash\": [],\r\n                            \"Portfolio Value\": [],\r\n                            \"Type\": [],\r\n                            \"Shares\": [],\r\n                            \"Share Price\": [],\r\n                            \"Trade Value\": [],\r\n                            \"Profit per Share\": [],\r\n                            \"Total Profit\": []})\r\n \r\n    forindex, row insignals.iterrows():\r\n        # These first few lines are done for any trade\r\n        shares =portfolio.setdefault(index[SYMBOL], 0)\r\n        trade_val =0\r\n        batches =0\r\n        cash_change =row[\"Price\"] *shares   # Shares could potentially be a positive or negative number (cash_change will be added in the end; negative shares indicate a short)\r\n        portfolio[index[SYMBOL]] =0# For a given symbol, a position is effectively cleared\r\n \r\n        old_price =port_prices.setdefault(index[SYMBOL], row[\"Price\"])\r\n        portfolio_val =0\r\n        forkey, val inportfolio.items():\r\n            portfolio_val +=val *port_prices[key]\r\n \r\n        ifrow[\"Signal\"] ==\"Buy\"androw[\"Regime\"] ==1:  # Entering a long position\r\n            batches =np.floor((portfolio_val +cash) *port_value) //np.ceil(batch *row[\"Price\"]) # Maximum number of batches of stocks invested in\r\n            trade_val =batches *batch *row[\"Price\"] # How much money is put on the line with each trade\r\n            cash_change -=trade_val  # We are buying shares so cash will go down\r\n            portfolio[index[SYMBOL]] =batches *batch  # Recording how many shares are currently invested in the stock\r\n            port_prices[index[SYMBOL]] =row[\"Price\"]   # Record price\r\n            old_price =row[\"Price\"]\r\n        elifrow[\"Signal\"] ==\"Sell\"androw[\"Regime\"] ==-1: # Entering a short\r\n            pass\r\n            # Do nothing; can we provide a method for shorting the market?\r\n        #else:\r\n            #raise ValueError(\"I don't know what to do with signal \" + row[\"Signal\"])\r\n \r\n        pprofit =row[\"Price\"] -old_price   # Compute profit per share; old_price is set in such a way that entering a position results in a profit of zero\r\n \r\n        # Update report\r\n        results =results.append(pd.DataFrame({\r\n                \"Start Cash\": cash,\r\n                \"End Cash\": cash +cash_change,\r\n                \"Portfolio Value\": cash +cash_change +portfolio_val +trade_val,\r\n                \"Type\": row[\"Signal\"],\r\n                \"Shares\": batch *batches,\r\n                \"Share Price\": row[\"Price\"],\r\n                \"Trade Value\": abs(cash_change),\r\n                \"Profit per Share\": pprofit,\r\n                \"Total Profit\": batches *batch *pprofit\r\n            }, index =[index]))\r\n        cash +=cash_change  # Final change to cash balance\r\n \r\n    results.sort_index(inplace =True)\r\n    results.index =pd.MultiIndex.from_tuples(results.index, names =[\"Date\", \"Symbol\"])\r\n \r\n    returnresults\r\n \r\n# Get more stocks\r\nmicrosoft =web.DataReader(\"MSFT\", \"yahoo\", start, end)\r\ngoogle =web.DataReader(\"GOOG\", \"yahoo\", start, end)\r\nfacebook =web.DataReader(\"FB\", \"yahoo\", start, end)\r\ntwitter =web.DataReader(\"TWTR\", \"yahoo\", start, end)\r\nnetflix =web.DataReader(\"NFLX\", \"yahoo\", start, end)\r\namazon =web.DataReader(\"AMZN\", \"yahoo\", start, end)\r\nyahoo =web.DataReader(\"YHOO\", \"yahoo\", start, end)\r\nsony =web.DataReader(\"SNY\", \"yahoo\", start, end)\r\nnintendo =web.DataReader(\"NTDOY\", \"yahoo\", start, end)\r\nibm =web.DataReader(\"IBM\", \"yahoo\", start, end)\r\nhp =web.DataReader(\"HPQ\", \"yahoo\", start, end)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f79676088665-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f79676088665-135\">135</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-1\"><span class=\"crayon-e\">defma_crossover_orders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fast</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-3\"><span class=\"crayon-s\">    :param stocks: A list of tuples, the first argument in each tuple being a string containing the ticker symbol of each stock (or however you want the stock represented, so long as it's unique), and the second being a pandas DataFrame containing the stocks, with a \"Close\" column and indexing by date (like the data frames returned by the Yahoo! Finance API)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-4\"><span class=\"crayon-s\">    :param fast: Integer for the number of days used in the fast moving average</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-5\"><span class=\"crayon-s\">    :param slow: Integer for the number of days used in the slow moving average</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-6\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-7\"><span class=\"crayon-s\">    :return: pandas DataFrame containing stock orders</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-8\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-9\"><span class=\"crayon-s\">    This function takes a list of stocks and determines when each stock would be bought or sold depending on a moving average crossover strategy, returning a data frame with information about when the stocks in the portfolio are bought or sold according to the strategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-10\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fast_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fast</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'d'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">slow_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'d'</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ma_diff_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">fast_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'-'</span><span class=\"crayon-o\">+</span><span class=\"crayon-e\">slow_str</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-14\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">trades</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fors </span><span class=\"crayon-v\">instocks</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Get the moving averages, both fast and slow, along with the difference in the moving averages</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">fast_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rolling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">fast</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">slow_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rolling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ma_diff_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">fast_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">slow_str</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-21\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># np.where() is a vectorized if-else function, where a condition is checked for each component of a vector, and the first argument passed is used when the condition holds, and the other passed if it does not</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ma_diff_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># We have 1's for bullish regimes and 0's for everything else. Below I replace bearish regimes's values with -1, and to maintain the rest of the vector, the second argument is apple[\"Regime\"]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ma_diff_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># To ensure that all trades close out, I temporarily change the regime of the last row to 0</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">regime_orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Restore original regime data</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">regime_orig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-32\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Get signals</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">signals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">concat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-36\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-37\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-39\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-40\"><span class=\"crayon-h\">                         </span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sell\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MultiIndex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_product</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Date\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Symbol\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">trades</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">trades</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-44\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">trades</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">trades</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MultiIndex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_tuples</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trades</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Date\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Symbol\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-47\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">returntrades</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-49\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-50\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-51\"><span class=\"crayon-e\">defbacktest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-53\"><span class=\"crayon-s\">    :param signals: pandas DataFrame containing buy and sell signals with stock prices and symbols, like that returned by ma_crossover_orders</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-54\"><span class=\"crayon-s\">    :param cash: integer for starting cash value</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-55\"><span class=\"crayon-s\">    :param port_value: maximum proportion of portfolio to risk on any single trade</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-56\"><span class=\"crayon-s\">    :param batch: Trading batch sizes</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-57\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-58\"><span class=\"crayon-s\">    :return: pandas DataFrame with backtesting results</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-59\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-60\"><span class=\"crayon-s\">    This function backtests strategies, with the signals generated by the strategies being passed in the signals DataFrame. A fictitious portfolio is simulated and the returns generated by this portfolio are reported.</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-61\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-62\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-c\"># Constant for which element in index represents symbol</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">portfolio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Will contain how many stocks are in the portfolio for a given symbol</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">port_prices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># Tracks old trade prices for determining profits</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Dataframe that will contain backtesting report</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"Start Cash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-68\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"End Cash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-69\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Portfolio Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-70\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-71\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Shares\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-72\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Share Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-73\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Trade Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-74\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Profit per Share\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-75\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">\"Total Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-76\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">forindex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-v\">insignals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iterrows</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># These first few lines are done for any trade</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">shares</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">portfolio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">shares</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># Shares could potentially be a positive or negative number (cash_change will be added in the end; negative shares indicate a short)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">portfolio</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-c\"># For a given symbol, a position is effectively cleared</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-84\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">old_price</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">port_prices</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">portfolio_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">forkey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-v\">inportfolio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">portfolio_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">port_prices</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-89\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ifrow</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"Buy\"</span><span class=\"crayon-v\">androw</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># Entering a long position</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-91\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">portfolio_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">cash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">port_value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ceil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Maximum number of batches of stocks invested in</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-92\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># How much money is put on the line with each trade</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># We are buying shares so cash will go down</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-94\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">portfolio</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># Recording how many shares are currently invested in the stock</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-95\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">port_prices</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">SYMBOL</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># Record price</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-96\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">old_price</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">elifrow</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"Sell\"</span><span class=\"crayon-v\">androw</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Regime\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Entering a short</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-99\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># Do nothing; can we provide a method for shorting the market?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-100\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#else:</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-101\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">#raise ValueError(\"I don't know what to do with signal \" + row[\"Signal\"])</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-102\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-103\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pprofit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">old_price</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># Compute profit per share; old_price is set in such a way that entering a position results in a profit of zero</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-104\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-105\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Update report</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-106\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-107\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Start Cash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-108\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"End Cash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-109\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Portfolio Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">portfolio_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-110\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Signal\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-111\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Shares\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batches</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-112\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Share Price\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Price\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-113\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Trade Value\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">abs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-114\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Profit per Share\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pprofit</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-115\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"Total Profit\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-i\">pprofit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-116\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-117\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-v\">cash_change</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># Final change to cash balance</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-118\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-119\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-120\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MultiIndex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_tuples</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Date\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Symbol\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-121\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-122\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">returnresults</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-123\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-124\"><span class=\"crayon-c\"># Get more stocks</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-125\"><span class=\"crayon-v\">microsoft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MSFT\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-126\"><span class=\"crayon-v\">google</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"GOOG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-127\"><span class=\"crayon-v\">facebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"FB\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-128\"><span class=\"crayon-v\">twitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"TWTR\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-129\"><span class=\"crayon-v\">netflix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"NFLX\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-130\"><span class=\"crayon-v\">amazon</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"AMZN\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-131\"><span class=\"crayon-v\">yahoo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"YHOO\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-132\"><span class=\"crayon-v\">sony</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SNY\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-133\"><span class=\"crayon-v\">nintendo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"NTDOY\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f79676088665-134\"><span class=\"crayon-v\">ibm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"IBM\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f79676088665-135\"><span class=\"crayon-v\">hp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HPQ\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0308 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f88747889954\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsignals =ma_crossover_orders([(\"AAPL\", ohlc_adj(apple)),\r\n                              (\"MSFT\",  ohlc_adj(microsoft)),\r\n                              (\"GOOG\",  ohlc_adj(google)),\r\n                              (\"FB\",    ohlc_adj(facebook)),\r\n                              (\"TWTR\",  ohlc_adj(twitter)),\r\n                              (\"NFLX\",  ohlc_adj(netflix)),\r\n                              (\"AMZN\",  ohlc_adj(amazon)),\r\n                              (\"YHOO\",  ohlc_adj(yahoo)),\r\n                              (\"SNY\",   ohlc_adj(yahoo)),\r\n                              (\"NTDOY\", ohlc_adj(nintendo)),\r\n                              (\"IBM\",   ohlc_adj(ibm)),\r\n                              (\"HPQ\",   ohlc_adj(hp))],\r\n                            fast =20, slow =50)\r\nsignals</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d766131f88747889954-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f88747889954-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-1\"><span class=\"crayon-v\">signals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">ma_crossover_orders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"AAPL\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-2\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MSFT\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">microsoft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-3\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"GOOG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-4\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"FB\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">facebook</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-5\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"TWTR\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">twitter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-6\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"NFLX\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">netflix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-7\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"AMZN\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amazon</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-8\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"YHOO\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yahoo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-9\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SNY\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yahoo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-10\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"NTDOY\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nintendo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-11\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"IBM\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ibm</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-12\"><span class=\"crayon-h\">                              </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HPQ\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">ohlc_adj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d766131f88747889954-13\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">fast</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f88747889954-14\"><span class=\"crayon-v\">signals</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>\n</p></div>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>Price</th>\n<th>Regime</th>\n<th>Signal</th>\n</tr>\n<tr>\n<th>Date</th>\n<th>Symbol</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th rowspan=\"10\" valign=\"top\">2010-03-16</th>\n<th>AAPL</th>\n<td>29.355667</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>AMZN</th>\n<td>131.789993</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>GOOG</th>\n<td>282.318173</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>HPQ</th>\n<td>20.722316</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>IBM</th>\n<td>110.563240</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>24.677580</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>10.090000</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>37.099998</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>16.360001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>16.360001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-03-17</th>\n<th>SNY</th>\n<td>16.500000</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>16.500000</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-03-22</th>\n<th>GOOG</th>\n<td>278.472004</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-03-23</th>\n<th>MSFT</th>\n<td>25.106096</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-05-03</th>\n<th>GOOG</th>\n<td>265.035411</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-10</th>\n<th>HPQ</th>\n<td>19.435830</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-14</th>\n<th>NTDOY</th>\n<td>35.799999</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-05-17</th>\n<th>SNY</th>\n<td>16.270000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>16.270000</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-05-19</th>\n<th>AMZN</th>\n<td>124.589996</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>23.835187</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-21</th>\n<th>IBM</th>\n<td>108.322991</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-10</th>\n<th>AAPL</th>\n<td>32.764038</td>\n<td>0.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-11</th>\n<th>AAPL</th>\n<td>33.156405</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<th>AAPL</th>\n<td>35.845436</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-06-28</th>\n<th>IBM</th>\n<td>111.397697</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-01</th>\n<th>IBM</th>\n<td>105.861499</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-07-06</th>\n<th>IBM</th>\n<td>106.630175</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-09</th>\n<th>NTDOY</th>\n<td>36.950001</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-20</th>\n<th>IBM</th>\n<td>109.298956</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>…</th>\n<th>…</th>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-23</th>\n<th>AAPL</th>\n<td>95.582210</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>TWTR</th>\n<td>17.040001</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-27</th>\n<th>AAPL</th>\n<td>91.544087</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>108.970001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-28</th>\n<th>SNY</th>\n<td>36.040001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>36.040001</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-30</th>\n<th>AAPL</th>\n<td>95.084904</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>91.480003</td>\n<td>0.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"3\" valign=\"top\">2016-07-01</th>\n<th>NFLX</th>\n<td>96.669998</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>37.990002</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>37.990002</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-07-11</th>\n<th>AAPL</th>\n<td>96.457473</td>\n<td>-1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>27.700001</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-07-14</th>\n<th>MSFT</th>\n<td>53.407133</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-07-25</th>\n<th>AAPL</th>\n<td>96.815526</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>121.629997</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-07-26</th>\n<th>GOOG</th>\n<td>738.419983</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-08-18</th>\n<th>NFLX</th>\n<td>96.160004</td>\n<td>1.0</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<th>AAPL</th>\n<td>106.730003</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"11\" valign=\"top\">2016-09-02</th>\n<th>AMZN</th>\n<td>772.440002</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>126.510002</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>GOOG</th>\n<td>771.460022</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>HPQ</th>\n<td>14.490000</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>IBM</th>\n<td>159.550003</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>57.669998</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>97.379997</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>28.840000</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>43.279999</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>TWTR</th>\n<td>19.549999</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>43.279999</td>\n<td>1.0</td>\n<td>Sell</td>\n</tr>\n</tbody>\n</table>\n<p>475 rows × 3 columns</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f90895495541\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbk =backtest(signals, 1000000)\r\nbk</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f90895495541-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131f90895495541-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f90895495541-1\"><span class=\"crayon-v\">bk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">backtest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131f90895495541-2\"><span class=\"crayon-v\">bk</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>\n</p></div>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>End Cash</th>\n<th>Portfolio Value</th>\n<th>Profit per Share</th>\n<th>Share Price</th>\n<th>Shares</th>\n<th>Start Cash</th>\n<th>Total Profit</th>\n<th>Trade Value</th>\n<th>Type</th>\n</tr>\n<tr>\n<th>Date</th>\n<th>Symbol</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th rowspan=\"10\" valign=\"top\">2010-03-16</th>\n<th>AAPL</th>\n<td>9.001907e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>29.355667</td>\n<td>3400.0</td>\n<td>1.000000e+06</td>\n<td>0.0</td>\n<td>99809.2678</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>AMZN</th>\n<td>8.079377e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>131.789993</td>\n<td>700.0</td>\n<td>9.001907e+05</td>\n<td>0.0</td>\n<td>92252.9951</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>GOOG</th>\n<td>8.079377e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>282.318173</td>\n<td>0.0</td>\n<td>8.079377e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>HPQ</th>\n<td>7.084706e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>20.722316</td>\n<td>4800.0</td>\n<td>8.079377e+05</td>\n<td>0.0</td>\n<td>99467.1168</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>IBM</th>\n<td>6.089637e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>110.563240</td>\n<td>900.0</td>\n<td>7.084706e+05</td>\n<td>0.0</td>\n<td>99506.9160</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>6.089637e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>24.677580</td>\n<td>0.0</td>\n<td>6.089637e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>5.090727e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>10.090000</td>\n<td>9900.0</td>\n<td>6.089637e+05</td>\n<td>0.0</td>\n<td>99891.0000</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>4.126127e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>37.099998</td>\n<td>2600.0</td>\n<td>5.090727e+05</td>\n<td>0.0</td>\n<td>96459.9948</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>4.126127e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>16.360001</td>\n<td>0.0</td>\n<td>4.126127e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>4.126127e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>16.360001</td>\n<td>0.0</td>\n<td>4.126127e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-03-17</th>\n<th>SNY</th>\n<td>3.136127e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>16.500000</td>\n<td>6000.0</td>\n<td>4.126127e+05</td>\n<td>0.0</td>\n<td>99000.0000</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>2.146127e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>16.500000</td>\n<td>6000.0</td>\n<td>3.136127e+05</td>\n<td>0.0</td>\n<td>99000.0000</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-03-22</th>\n<th>GOOG</th>\n<td>1.310711e+05</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>278.472004</td>\n<td>300.0</td>\n<td>2.146127e+05</td>\n<td>0.0</td>\n<td>83541.6012</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-03-23</th>\n<th>MSFT</th>\n<td>3.315733e+04</td>\n<td>1.000000e+06</td>\n<td>0.000000</td>\n<td>25.106096</td>\n<td>3900.0</td>\n<td>1.310711e+05</td>\n<td>0.0</td>\n<td>97913.7744</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-05-03</th>\n<th>GOOG</th>\n<td>1.126680e+05</td>\n<td>9.959690e+05</td>\n<td>-13.436593</td>\n<td>265.035411</td>\n<td>0.0</td>\n<td>3.315733e+04</td>\n<td>-0.0</td>\n<td>79510.6233</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-10</th>\n<th>HPQ</th>\n<td>2.059599e+05</td>\n<td>9.897939e+05</td>\n<td>-1.286486</td>\n<td>19.435830</td>\n<td>0.0</td>\n<td>1.126680e+05</td>\n<td>-0.0</td>\n<td>93291.9840</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-14</th>\n<th>NTDOY</th>\n<td>2.990399e+05</td>\n<td>9.864139e+05</td>\n<td>-1.299999</td>\n<td>35.799999</td>\n<td>0.0</td>\n<td>2.059599e+05</td>\n<td>-0.0</td>\n<td>93079.9974</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-05-17</th>\n<th>SNY</th>\n<td>3.966599e+05</td>\n<td>9.850339e+05</td>\n<td>-0.230000</td>\n<td>16.270000</td>\n<td>0.0</td>\n<td>2.990399e+05</td>\n<td>-0.0</td>\n<td>97620.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>4.942799e+05</td>\n<td>9.836539e+05</td>\n<td>-0.230000</td>\n<td>16.270000</td>\n<td>0.0</td>\n<td>3.966599e+05</td>\n<td>-0.0</td>\n<td>97620.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2010-05-19</th>\n<th>AMZN</th>\n<td>5.814929e+05</td>\n<td>9.786139e+05</td>\n<td>-7.199997</td>\n<td>124.589996</td>\n<td>0.0</td>\n<td>4.942799e+05</td>\n<td>-0.0</td>\n<td>87212.9972</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>6.744502e+05</td>\n<td>9.736573e+05</td>\n<td>-1.270909</td>\n<td>23.835187</td>\n<td>0.0</td>\n<td>5.814929e+05</td>\n<td>-0.0</td>\n<td>92957.2293</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-05-21</th>\n<th>IBM</th>\n<td>7.719409e+05</td>\n<td>9.716411e+05</td>\n<td>-2.240249</td>\n<td>108.322991</td>\n<td>0.0</td>\n<td>6.744502e+05</td>\n<td>-0.0</td>\n<td>97490.6919</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-10</th>\n<th>AAPL</th>\n<td>8.833386e+05</td>\n<td>9.832296e+05</td>\n<td>3.408371</td>\n<td>32.764038</td>\n<td>0.0</td>\n<td>7.719409e+05</td>\n<td>0.0</td>\n<td>111397.7292</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-11</th>\n<th>AAPL</th>\n<td>8.833386e+05</td>\n<td>9.832296e+05</td>\n<td>3.800738</td>\n<td>33.156405</td>\n<td>0.0</td>\n<td>8.833386e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-06-18</th>\n<th>AAPL</th>\n<td>7.865559e+05</td>\n<td>9.832296e+05</td>\n<td>0.000000</td>\n<td>35.845436</td>\n<td>2700.0</td>\n<td>8.833386e+05</td>\n<td>0.0</td>\n<td>96782.6772</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-06-28</th>\n<th>IBM</th>\n<td>6.974378e+05</td>\n<td>9.832296e+05</td>\n<td>0.000000</td>\n<td>111.397697</td>\n<td>800.0</td>\n<td>7.865559e+05</td>\n<td>0.0</td>\n<td>89118.1576</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-01</th>\n<th>IBM</th>\n<td>7.821270e+05</td>\n<td>9.788006e+05</td>\n<td>-5.536198</td>\n<td>105.861499</td>\n<td>0.0</td>\n<td>6.974378e+05</td>\n<td>-0.0</td>\n<td>84689.1992</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>2010-07-06</th>\n<th>IBM</th>\n<td>6.861598e+05</td>\n<td>9.788006e+05</td>\n<td>0.000000</td>\n<td>106.630175</td>\n<td>900.0</td>\n<td>7.821270e+05</td>\n<td>0.0</td>\n<td>95967.1575</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-09</th>\n<th>NTDOY</th>\n<td>5.900898e+05</td>\n<td>9.788006e+05</td>\n<td>0.000000</td>\n<td>36.950001</td>\n<td>2600.0</td>\n<td>6.861598e+05</td>\n<td>0.0</td>\n<td>96070.0026</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2010-07-20</th>\n<th>IBM</th>\n<td>6.884589e+05</td>\n<td>9.812025e+05</td>\n<td>2.668781</td>\n<td>109.298956</td>\n<td>0.0</td>\n<td>5.900898e+05</td>\n<td>0.0</td>\n<td>98369.0604</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>…</th>\n<th>…</th>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-23</th>\n<th>AAPL</th>\n<td>3.951693e+05</td>\n<td>1.863808e+06</td>\n<td>0.000000</td>\n<td>95.582210</td>\n<td>1900.0</td>\n<td>5.767755e+05</td>\n<td>0.0</td>\n<td>181606.1990</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>TWTR</th>\n<td>2.094333e+05</td>\n<td>1.863808e+06</td>\n<td>0.000000</td>\n<td>17.040001</td>\n<td>10900.0</td>\n<td>3.951693e+05</td>\n<td>0.0</td>\n<td>185736.0109</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-27</th>\n<th>AAPL</th>\n<td>3.833670e+05</td>\n<td>1.856135e+06</td>\n<td>-4.038123</td>\n<td>91.544087</td>\n<td>0.0</td>\n<td>2.094333e+05</td>\n<td>-0.0</td>\n<td>173933.7653</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>5.795130e+05</td>\n<td>1.862921e+06</td>\n<td>3.770004</td>\n<td>108.970001</td>\n<td>0.0</td>\n<td>3.833670e+05</td>\n<td>0.0</td>\n<td>196146.0018</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-28</th>\n<th>SNY</th>\n<td>7.885450e+05</td>\n<td>1.880959e+06</td>\n<td>3.110001</td>\n<td>36.040001</td>\n<td>0.0</td>\n<td>5.795130e+05</td>\n<td>0.0</td>\n<td>209032.0058</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>9.975770e+05</td>\n<td>1.898997e+06</td>\n<td>3.110001</td>\n<td>36.040001</td>\n<td>0.0</td>\n<td>7.885450e+05</td>\n<td>0.0</td>\n<td>209032.0058</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-06-30</th>\n<th>AAPL</th>\n<td>8.169157e+05</td>\n<td>1.898997e+06</td>\n<td>0.000000</td>\n<td>95.084904</td>\n<td>1900.0</td>\n<td>9.975770e+05</td>\n<td>0.0</td>\n<td>180661.3176</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>9.907277e+05</td>\n<td>1.893981e+06</td>\n<td>-2.640000</td>\n<td>91.480003</td>\n<td>0.0</td>\n<td>8.169157e+05</td>\n<td>-0.0</td>\n<td>173812.0057</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"3\" valign=\"top\">2016-07-01</th>\n<th>NFLX</th>\n<td>9.907277e+05</td>\n<td>1.893981e+06</td>\n<td>2.549995</td>\n<td>96.669998</td>\n<td>0.0</td>\n<td>9.907277e+05</td>\n<td>0.0</td>\n<td>0.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>8.045767e+05</td>\n<td>1.893981e+06</td>\n<td>0.000000</td>\n<td>37.990002</td>\n<td>4900.0</td>\n<td>9.907277e+05</td>\n<td>0.0</td>\n<td>186151.0098</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>6.184257e+05</td>\n<td>1.893981e+06</td>\n<td>0.000000</td>\n<td>37.990002</td>\n<td>4900.0</td>\n<td>8.045767e+05</td>\n<td>0.0</td>\n<td>186151.0098</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-07-11</th>\n<th>AAPL</th>\n<td>8.016949e+05</td>\n<td>1.896589e+06</td>\n<td>1.372569</td>\n<td>96.457473</td>\n<td>0.0</td>\n<td>6.184257e+05</td>\n<td>0.0</td>\n<td>183269.1987</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>6.133349e+05</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>27.700001</td>\n<td>6800.0</td>\n<td>8.016949e+05</td>\n<td>0.0</td>\n<td>188360.0068</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-07-14</th>\n<th>MSFT</th>\n<td>4.264099e+05</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>53.407133</td>\n<td>3500.0</td>\n<td>6.133349e+05</td>\n<td>0.0</td>\n<td>186924.9655</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th rowspan=\"2\" valign=\"top\">2016-07-25</th>\n<th>AAPL</th>\n<td>2.424604e+05</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>96.815526</td>\n<td>1900.0</td>\n<td>4.264099e+05</td>\n<td>0.0</td>\n<td>183949.4994</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>6.001543e+04</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>121.629997</td>\n<td>1500.0</td>\n<td>2.424604e+05</td>\n<td>0.0</td>\n<td>182444.9955</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-07-26</th>\n<th>GOOG</th>\n<td>-8.766857e+04</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>738.419983</td>\n<td>200.0</td>\n<td>6.001543e+04</td>\n<td>0.0</td>\n<td>147683.9966</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-08-18</th>\n<th>NFLX</th>\n<td>-2.703726e+05</td>\n<td>1.896589e+06</td>\n<td>0.000000</td>\n<td>96.160004</td>\n<td>1900.0</td>\n<td>-8.766857e+04</td>\n<td>0.0</td>\n<td>182704.0076</td>\n<td>Buy</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<th>AAPL</th>\n<td>-6.758557e+04</td>\n<td>1.915427e+06</td>\n<td>9.914477</td>\n<td>106.730003</td>\n<td>0.0</td>\n<td>-2.703726e+05</td>\n<td>0.0</td>\n<td>202787.0057</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th rowspan=\"11\" valign=\"top\">2016-09-02</th>\n<th>AMZN</th>\n<td>1.641464e+05</td>\n<td>1.979327e+06</td>\n<td>213.000000</td>\n<td>772.440002</td>\n<td>0.0</td>\n<td>-6.758557e+04</td>\n<td>0.0</td>\n<td>231732.0006</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>FB</th>\n<td>3.539114e+05</td>\n<td>1.986647e+06</td>\n<td>4.880005</td>\n<td>126.510002</td>\n<td>0.0</td>\n<td>1.641464e+05</td>\n<td>0.0</td>\n<td>189765.0030</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>GOOG</th>\n<td>5.082034e+05</td>\n<td>1.993255e+06</td>\n<td>33.040039</td>\n<td>771.460022</td>\n<td>0.0</td>\n<td>3.539114e+05</td>\n<td>0.0</td>\n<td>154292.0044</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>HPQ</th>\n<td>7.081654e+05</td>\n<td>2.006030e+06</td>\n<td>0.925746</td>\n<td>14.490000</td>\n<td>0.0</td>\n<td>5.082034e+05</td>\n<td>0.0</td>\n<td>199962.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>IBM</th>\n<td>8.996254e+05</td>\n<td>2.015652e+06</td>\n<td>8.018727</td>\n<td>159.550003</td>\n<td>0.0</td>\n<td>7.081654e+05</td>\n<td>0.0</td>\n<td>191460.0036</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>MSFT</th>\n<td>1.101470e+06</td>\n<td>2.030572e+06</td>\n<td>4.262865</td>\n<td>57.669998</td>\n<td>0.0</td>\n<td>8.996254e+05</td>\n<td>0.0</td>\n<td>201844.9930</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NFLX</th>\n<td>1.286492e+06</td>\n<td>2.032890e+06</td>\n<td>1.219993</td>\n<td>97.379997</td>\n<td>0.0</td>\n<td>1.101470e+06</td>\n<td>0.0</td>\n<td>185021.9943</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>NTDOY</th>\n<td>1.482604e+06</td>\n<td>2.040642e+06</td>\n<td>1.139999</td>\n<td>28.840000</td>\n<td>0.0</td>\n<td>1.286492e+06</td>\n<td>0.0</td>\n<td>196112.0000</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>SNY</th>\n<td>1.694676e+06</td>\n<td>2.066563e+06</td>\n<td>5.289997</td>\n<td>43.279999</td>\n<td>0.0</td>\n<td>1.482604e+06</td>\n<td>0.0</td>\n<td>212071.9951</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>TWTR</th>\n<td>1.907771e+06</td>\n<td>2.093922e+06</td>\n<td>2.509998</td>\n<td>19.549999</td>\n<td>0.0</td>\n<td>1.694676e+06</td>\n<td>0.0</td>\n<td>213094.9891</td>\n<td>Sell</td>\n</tr>\n<tr>\n<th>YHOO</th>\n<td>2.119843e+06</td>\n<td>2.119843e+06</td>\n<td>5.289997</td>\n<td>43.279999</td>\n<td>0.0</td>\n<td>1.907771e+06</td>\n<td>0.0</td>\n<td>212071.9951</td>\n<td>Sell</td>\n</tr>\n</tbody>\n</table>\n<p>475 rows × 9 columns</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131f9c392315771\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbk[\"Portfolio Value\"].groupby(level =0).apply(lambdax: x[-1]).plot()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131f9c392315771-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131f9c392315771-1\"><span class=\"crayon-v\">bk</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Portfolio Value\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambdax</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>\n</p></div>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1firhybrkbfj20iw0asdg3.jpg\"></p>\n<p>更为现实的投资组合可以投资任何12支股票而达到100%的收益。这个看上去不错，但是我们可以做得更好。</p>\n<h2>基准分析法</h2>\n<p>基准分析法可以分析交易策略效率的好坏。所谓<strong>基准分析</strong>，就是将策略和其他（著名）策略进行比较从而评价该策略的表现好坏。</p>\n<div class=\"entry-content\">\n<p>每次你评价交易系统的时候，都要跟<a href=\"https://finance.yahoo.com/quote/SPY\">买入持有策略（SPY）</a>进行比较。除了一些信托基金和少数投资经理没有使用它，该策略在大多时候都是无敌的。<strong>有效市场假说</strong>强调没有人能战胜股票市场，所以每个人都应该购入指数基金，因为它能反应整个市场的构成。SPY是一个<strong>交易型开放式指数基金</strong>（一种可以像股票一样交易的信托基金），它的价格有效反映了S&amp;P 500中的股票价格。买入并持有SPY，说明你可以有效地匹配市场回报率而不是战胜它。</p>\n<p>下面是SPY的数据，让我们看看简单买入持有SPY能得到的回报：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131fa2983383018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspyder =web.DataReader(\"SPY\", \"yahoo\", start, end)\r\nspyder.iloc[[0,-1],:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131fa2983383018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131fa2983383018-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131fa2983383018-1\"><span class=\"crayon-v\">spyder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SPY\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yahoo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131fa2983383018-2\"><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">iloc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<div>\n<table class=\"dataframe\" border=\"1\">\n<thead>\n<tr>\n<th>Open</th>\n<th>High</th>\n<th>Low</th>\n<th>Close</th>\n<th>Volume</th>\n<th>Adj Close</th>\n</tr>\n<tr>\n<th>Date</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>2010-01-04</th>\n<td>112.370003</td>\n<td>113.389999</td>\n<td>111.510002</td>\n<td>113.330002</td>\n<td>118944600</td>\n<td>99.292299</td>\n</tr>\n<tr>\n<th>2016-09-01</th>\n<td>217.369995</td>\n<td>217.729996</td>\n<td>216.029999</td>\n<td>217.389999</td>\n<td>93859000</td>\n<td>217.389999</td>\n</tr>\n</tbody>\n</table>\n</div>\n<div>\n<div id=\"highlighter_13803\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131fa6449318065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbatches =1000000//np.ceil(100*spyder.ix[0,\"Adj Close\"]) # Maximum number of batches of stocks invested in\r\ntrade_val =batches *batch *spyder.ix[0,\"Adj Close\"] # How much money is used to buy SPY\r\nfinal_val =batches *batch *spyder.ix[-1,\"Adj Close\"] +(1000000-trade_val) # Final value of the portfolio\r\nfinal_val</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131fa6449318065-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131fa6449318065-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131fa6449318065-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131fa6449318065-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131fa6449318065-1\"><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ceil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Maximum number of batches of stocks invested in</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131fa6449318065-2\"><span class=\"crayon-v\">trade_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># How much money is used to buy SPY</span></div><div class=\"crayon-line\" id=\"crayon-599d766131fa6449318065-3\"><span class=\"crayon-v\">final_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">trade_val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Final value of the portfolio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131fa6449318065-4\"><span class=\"crayon-v\">final_val</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131faa187068736\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n2180977.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131faa187068736-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131faa187068736-1\"><span class=\"crayon-cn\">2180977.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<div>\n<div id=\"highlighter_431623\" class=\"syntaxhighlighter python\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d766131fad489043869\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# We see that the buy-and-hold strategy beats the strategy we developed earlier. I would also like to see a plot.\r\nax_bench =(spyder[\"Adj Close\"] /spyder.ix[0, \"Adj Close\"]).plot(label =\"SPY\")\r\nax_bench =(bk[\"Portfolio Value\"].groupby(level =0).apply(lambdax: x[-1]) /1000000).plot(ax =ax_bench, label =\"Portfolio\")\r\nax_bench.legend(ax_bench.get_lines(), [l.get_label() forl inax_bench.get_lines()], loc ='best')\r\nax_bench</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d766131fad489043869-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131fad489043869-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d766131fad489043869-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d766131fad489043869-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d766131fad489043869-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d766131fad489043869-1\"><span class=\"crayon-c\"># We see that the buy-and-hold strategy beats the strategy we developed earlier. I would also like to see a plot.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131fad489043869-2\"><span class=\"crayon-v\">ax_bench</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spyder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Adj Close\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"SPY\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131fad489043869-3\"><span class=\"crayon-v\">ax_bench</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bk</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"Portfolio Value\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambdax</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ax</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">ax_bench</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Portfolio\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d766131fad489043869-4\"><span class=\"crayon-v\">ax_bench</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">legend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ax_bench</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_lines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_label</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">forl </span><span class=\"crayon-v\">inax_bench</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_lines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'best'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d766131fad489043869-5\"><span class=\"crayon-v\">ax_bench</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</div>\n</div>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1firhybetgsj20iw0b5dgo.jpg\"></p>\n<p>买入持有SPY比我们当前的交易系统好——我们的系统还没有考虑不菲的交易费用。考虑到机会成本和该策略的消耗，我们不应该用它。</p>\n<p>怎样才能改进我们的系统呢？对于初学者来尽量多样化是一个选择。目前我们所有的股票都来自技术公司，这意味着技术型公司的不景气会反映在我们的投资组合上。我们应该设计一个可以利用空头头寸和熊市的系统，这样不管市场如何变动，我们都可以盈利。我们也可以寻求更好的方法预测股票的最高期望价格。但是不论如何我们都需要做得比SPY更好，不然由于我们的系统会自带机会成本，是没用的。</p>\n<p>其他的基准策略也是存在的。如果我们的系统比“买入持有SPY”更好，我们可以进一步跟其他的系统比较，例如：</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1firhtst158j20i101s3yg.jpg\"></p>\n<p>（我最初在<a href=\"https://www.r-bloggers.com/are-r2s-useful-in-finance-hypothesis-driven-development-in-reverse/?utm_source=feedburner&amp;utm_medium=email&amp;utm_campaign=Feed%3A+RBloggers+%28R+bloggers%29\">这里</a>接触到这些策略）基本准则仍然是：不要使用一个复杂的，包含大量交易的系统如果它赢不了一个简单的交易不频繁的指数基金模型。（<a href=\"http://www.nytimes.com/2015/03/15/your-money/how-many-mutual-funds-routinely-rout-the-market-zero.html?_r=0\">事实上这个标准挺难实现的</a>）</p>\n<p>最后要强调的是，假设你的交易系统在回溯测试中打败了所有的基准系统，也不意味着它能够准确地预测未来。因为回溯测试容易过拟合，它不能用于预测未来。</p>\n<h2>结论</h2>\n<p>虽然讲座最后的结论不是那么乐观，但记住有效市场理论也有缺陷。我个人的观点是当交易更多依赖于算法的时候，就更难战胜市场。有一个说法是：信托基金都不太可能战胜市场，你的系统能战胜市场仅仅是一个可能性而已。（当然信托基金表现很差的原因是收费太高，而指数基金不存在这个问题。）</p>\n<p>本讲座只简单地说明了一种基于移动平均的交易策略。还有许多别的交易策略这里并没有提到。而且我们也没有深入探讨空头股票和货币交易。特别是股票期权有很多东西可以讲，它也提供了不同的方法来预测股票的走向。你可以在<em>Derivatives Analytics with Python: Data Analysis, Models, Simulation, Calibration and Hedging</em>书中读到更多的相关内容。（犹他大学的图书馆有这本书）</p>\n<p>另一个资源是O’Reilly出的<em>Python for Finance，</em>犹他大学的图书馆里也有<em>。</em></p>\n<p>记住在股票里面亏钱是很正常的，同样股市也能提供其他方法无法提供的高回报，每一个投资策略都应该是经过深思熟虑的。这个讲座旨在抛砖引玉，希望同学们自己进一步探讨这个话题。</p>\n<h2>作业</h2>\n<h3>问题1</h3>\n<p>建立一个基于移动平均的交易系统（不需要止损条件）。选择15支2010年1月1日之前上市的股票，利用回溯测试检验你的 系统，并且SPY基准作比较，你的系统能战胜市场吗？</p>\n<h3>问题2</h3>\n<p>在现实中每一笔交易都要支付一笔佣金。弄明白如何计算佣金，然后修改你的backtes()函数，使之能够计算不同的佣金模式（固定费用，按比例收费等等）。</p>\n<p> </p>\n<p>我们现在的移动平均交汇点分析系统在两条平均线交叉的时候触发交易。修改系统令其更准确：</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1firhv5jcvzj20k402q749.jpg\"></p>\n<p><img src=\"http://wx2.sinaimg.cn/large/6941baebly1firialcfvyj20q502j74i.jpg\"></p>\n<p>当你完成修改之后，重复问题1，使用一个真实的佣金策略（从交易所查）来模拟你的系统，同时要求移动平均差异达到一定的移动标准差再激发交易。</p>\n<h3>问题3</h3>\n<p>我们的交易系统无法处理空头股票。空头买卖的复杂性在于损失是没有下限的（多头头寸的最大损失等于购入股票的总价格）。学习如何处理空头头寸，然后修改backtest()使其能够处理空头交易。思考要如何实现空头交易，包括允许多少空头交易？在进行其他交易的时候如何处理空头交易？提示：空头交易的量在函数中可以用一个负数来表示。</p>\n<p>完成之后重复问题1，也可以同时考虑问题2中提到的因素。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/2ec965670e006b5d53c221a7cdcf0108.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/a5e36df34a1aea088f06fb503c7ce93d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88256\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88256votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88256\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/5bfa690c5bc8a2dc2344cffdebf5f50b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据科学进修中，Python小码农。不用QQ，有事站内信联系。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/buntamarui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/buntamarui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 29</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ammie/\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bchen4\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://www.linkedin.com/\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "实践项目,数据分析,股市",
    "article_url": "http://python.jobbole.com/88256/",
    "url_object_id": "cc11470f13bfd71a431b4412f68579e7",
    "front_image_url": [
        "http://wx1.sinaimg.cn/mw690/6941baebly1firhyecbjvj20iw0bawen.jpg"
    ]
}
{
    "title": "Python 编码为什么那么蛋疼？",
    "create_date": "2017/08/05",
    "agree_num": 4,
    "comment_num": 4,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://foofish.net/why-python-encoding-is-tricky.html\">liuzhijun</a>   </div><p>据说，每个做 Python 开发的都被字符编码的问题搞晕过，最常见的错误就是 UnicodeEncodeError、UnicodeDecodeError，你好像知道怎么解决，遗憾的是，错误又出现在其它地方，问题总是重蹈覆辙，str 到 unicode 之间的转换用 decode 还是 encode 方法还特不好记，老是混淆，问题究竟出在哪里？</p>\n<p>为了弄清楚这个问题，我决定从 python 字符串的构成以及字符编码的细节上进行深入浅出的分析。</p>\n<h1>字节与字符</h1>\n<p>计算机存储的一切数据，文本字符、图片、视频、音频、软件都是由一串01的字节序列构成的，一个字节等于8个比特位。</p>\n<p>而字符就是一个符号，比如一个汉字、一个英文字母、一个数字、一个标点都可以称为一个字符。</p>\n<p>字节方便存储和网络传输，而字符用于显示，方便阅读。例如字符 “p” 存储到硬盘是一串二进制数据 <code>01110000</code>，占用一个字节的长度。</p>\n<h1>编码与解码</h1>\n<p>我们用编辑器打开的文本，看到的一个个字符，最终保存在磁盘的时候都是以二进制字节序列形式存起来的。那么从字符到字节的转换过程就叫做编码（encode），反过来叫做解码（decode），两者是一个可逆的过程。编码是为了存储传输，解码是为了方便显示阅读。</p>\n<p>例如字符 “p” 经过编码处理保存到硬盘是一串二进制字节序列 01110000 ，占用一个字节的长度。字符 “禅” 有可能是以 “11100111 10100110 10000101” 占用3个字节的长度存储，为什么说是有可能呢？这个放到后面再说。</p>\n<p>Python 的编码为什么那么蛋疼？当然，这不能怪开发者。</p>\n<p>这是因为 Python2 使用 ASCII 字符编码作为默认编码方式，而 ASCII 不能处理中文，那么为什么不用 UTf-8 呢？因为 Guido 老爹为 Python 编写第一行代码是在1989年的冬天，1991年2月正式开源发布了第一个版本，而 Unicode 是1991年10月发布的，也就是说 Python 这门语言创立的时候 UTF-8 还没诞生，这是其一。</p>\n<p>Python 把字符串的类型还搞成两种，unicode 和 str ，以至于把开发者都弄糊涂了，这是其二。python3 彻底把 字符串重新改造了，只保留一种类型，这是后话，以后再说。</p>\n<h1>str与unicode</h1>\n<p>Python2 把字符串分为 unicode 和 str 两种类型。本质上 str 是一串二进制字节序列，下面的示例代码可以看出 str 类型的 “禅” 打印出来是十六进制的 \\xec\\xf8 ，对应的二进制字节序列就是‘11101100 11111000’。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b4f159404868\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; s = '禅'\r\n&gt;&gt;&gt; s\r\n'\\xec\\xf8'\r\n&gt;&gt;&gt; type(s)\r\n&lt;type 'str'&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b4f159404868-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b4f159404868-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b4f159404868-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b4f159404868-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b4f159404868-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b4f159404868-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'禅'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b4f159404868-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b4f159404868-3\"><span class=\"crayon-s\">'\\xec\\xf8'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b4f159404868-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b4f159404868-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'str'</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>而 unicode 类型的 u “禅” 对应的 unicode 符号是 u ‘\\u7985’</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b58743806698\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; u = u\"禅\"\r\n&gt;&gt;&gt; u\r\nu'\\u7985'\r\n&gt;&gt;&gt; type(u)\r\n&lt;type 'unicode'&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b58743806698-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b58743806698-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b58743806698-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b58743806698-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b58743806698-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b58743806698-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b58743806698-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b58743806698-3\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u7985'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b58743806698-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b58743806698-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unicode'</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>我们要把 unicode 符号保存到文件或者传输到网络就需要经过编码处理转换成 str 类型，于是 python 提供了 encode 方法，从 unicode 转换到 str，反之亦然。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5064220563ade2952ece4d810c00f8f.jpg\"><img class=\"aligncenter wp-image-88265 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5064220563ade2952ece4d810c00f8f.jpg\" alt=\"python2-str21\" width=\"390\" height=\"255\"></a></p>\n<p>encode</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b5d841451983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; u = u\"禅\"\r\n&gt;&gt;&gt; u\r\nu'\\u7985'\r\n&gt;&gt;&gt; u.encode(\"utf-8\")\r\n'\\xe7\\xa6\\x85'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b5d841451983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b5d841451983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b5d841451983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b5d841451983-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b5d841451983-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b5d841451983-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b5d841451983-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b5d841451983-3\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u7985'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b5d841451983-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b5d841451983-5\"><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>decode</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b62742071523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; s = \"禅\"\r\n&gt;&gt;&gt; s.decode(\"utf-8\")\r\nu'\\u7985'\r\n&gt;&gt;&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b62742071523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b62742071523-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b62742071523-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b62742071523-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b62742071523-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b62742071523-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b62742071523-3\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u7985'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b62742071523-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>不少初学者怎么也记不住 str 与 unicode 之间的转换用 encode 还是 decode，如果你记住了 str 本质上其实是一串二进制数据，而 unicode 是字符（符号），编码（encode）就是把字符（符号）转换为 二进制数据的过程，因此 unicode 到 str 的转换要用 encode 方法，反过来就是用 decode 方法。</p>\n<blockquote><p>encoding always takes a Unicode string and returns a bytes sequence, and decoding always takes a bytes sequence and returns a Unicode string”.</p></blockquote>\n<p>清楚了 str 与 unicode 之间的转换关系之后，我们来看看什么时候会出现 UnicodeEncodeError、UnicodeDecodeError 错误。</p>\n<h1>UnicodeEncodeError</h1>\n<p>UnicodeEncodeError 发生在 unicode 字符串转换成 str 字节序列的时候，来看一个例子，把一串 unicode 字符串保存到文件</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b66765598731\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# -*- coding:utf-8 -*-\r\ndef main():\r\n    name = u'Python之禅'\r\n    f = open(\"output.txt\", \"w\")\r\n    f.write(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b66765598731-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b66765598731-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b66765598731-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b66765598731-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b66765598731-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b66765598731-1\"><span class=\"crayon-p\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b66765598731-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b66765598731-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'Python之禅'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b66765598731-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"output.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"w\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b66765598731-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>错误日志</p>\n<blockquote><p>UnicodeEncodeError: ‘ascii’ codec can’t encode characters in position 6-7: ordinal not in range(128)</p></blockquote>\n<p>为什么会出现 UnicodeEncodeError？</p>\n<p>因为调用 write 方法时，Python 会先判断字符串是什么类型，如果是 str，就直接写入文件，不需要编码，因为 str 类型的字符串本身就是一串二进制的字节序列了。</p>\n<p>如果字符串是 unicode 类型，那么它会先调用 encode 方法把 unicode 字符串转换成二进制形式的 str 类型，才保存到文件，而 encode 方法会使用 python 默认的 ascii 码来编码。</p>\n<p>相当于：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b6a489747618\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; u\"Python之禅\".encode(\"ascii\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b6a489747618-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b6a489747618-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"Python之禅\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ascii\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但是，我们知道 ASCII 字符集中只包含了128个拉丁字母，不包括中文字符，因此 出现了 ‘ascii’ codec can’t encode characters 的错误。要正确地使用 encode ，就必须指定一个包含了中文字符的字符集，比如：UTF-8、GBK。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b6d240292800\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; u\"Python之禅\".encode(\"utf-8\")\r\n'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'\r\n\r\n&gt;&gt;&gt; u\"Python之禅\".encode(\"gbk\")\r\n'Python\\xd6\\xae\\xec\\xf8'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b6d240292800-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b6d240292800-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b6d240292800-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b6d240292800-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b6d240292800-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b6d240292800-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"Python之禅\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b6d240292800-2\"><span class=\"crayon-s\">'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b6d240292800-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b6d240292800-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"Python之禅\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"gbk\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b6d240292800-5\"><span class=\"crayon-s\">'Python\\xd6\\xae\\xec\\xf8'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>所以要把 unicode 字符串正确地写入文件，就应该预先把字符串进行 UTF-8 或 GBK 编码转换。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b71247480925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef main():\r\n    name = u'Python之禅'\r\n    name = name.encode('utf-8')\r\n    with open(\"output.txt\", \"w\") as f:\r\n        f.write(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b71247480925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b71247480925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b71247480925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b71247480925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b71247480925-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b71247480925-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b71247480925-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'Python之禅'</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b71247480925-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b71247480925-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"output.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"w\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b71247480925-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>当然，把 unicode 字符串正确地写入文件不止一种方式，但原理是一样的，这里不再介绍，把字符串写入数据库，传输到网络都是同样的原理</p>\n<h1>UnicodeDecodeError</h1>\n<p>UnicodeDecodeError 发生在 str 类型的字节序列解码成 unicode 类型的字符串时</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b74239095076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; a = u\"禅\"\r\n&gt;&gt;&gt; a\r\nu'\\u7985'\r\n&gt;&gt;&gt; b = a.encode(\"utf-8\")\r\n&gt;&gt;&gt; b\r\n'\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; b.decode(\"gbk\")\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\nUnicodeDecodeError: 'gbk' codec can't decode byte 0x85 in position 2: incomplete multibyte sequence</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b74239095076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b74239095076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b74239095076-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b74239095076-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b74239095076-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b74239095076-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b74239095076-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b74239095076-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b74239095076-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b74239095076-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b74239095076-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b74239095076-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b74239095076-3\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u7985'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b74239095076-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b74239095076-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b74239095076-6\"><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b74239095076-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"gbk\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b74239095076-8\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b74239095076-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b74239095076-10\"><span class=\"crayon-v\">UnicodeDecodeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'gbk'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">codec </span><span class=\"crayon-i\">can</span>'<span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decode </span><span class=\"crayon-t\">byte</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x85</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incomplete </span><span class=\"crayon-e\">multibyte </span><span class=\"crayon-v\">sequence</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>把一个经过 UTF-8 编码后生成的字节序列 ‘\\xe7\\xa6\\x85’ 再用 GBK 解码转换成 unicode 字符串时，出现 UnicodeDecodeError，因为 （对于中文字符）GBK 编码只占用两个字节，而 UTF-8 占用3个字节，用 GBK 转换时，还多出一个字节，因此它没法解析。避免 UnicodeDecodeError 的关键是保持 编码和解码时用的编码类型一致。</p>\n<p>这也回答了文章开头说的字符 “禅”，保存到文件中有可能占3个字节，有可能占2个字节，具体处决于 encode 的时候指定的编码格式是什么。</p>\n<p>再举一个 UnicodeDecodeError 的例子</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b7a554605072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; x = u\"Python\"\r\n&gt;&gt;&gt; y = \"之禅\"\r\n&gt;&gt;&gt; x + y\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe4 in position 0: ordinal not in range(128)\r\n&gt;&gt;&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b7a554605072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b7a554605072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b7a554605072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b7a554605072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b7a554605072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b7a554605072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b7a554605072-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b7a554605072-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"Python\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b7a554605072-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"之禅\"</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b7a554605072-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b7a554605072-4\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b7a554605072-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b7a554605072-6\"><span class=\"crayon-v\">UnicodeDecodeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ascii'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">codec </span><span class=\"crayon-i\">can</span>'<span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decode </span><span class=\"crayon-t\">byte</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xe4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ordinal </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b7a554605072-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>str 与 unicode 字符串 执行 + 操作时，Python 会把 str 类型的字节序列隐式地转换成（解码）成 和 x 一样的 unicode 类型，但Python是使用默认的 ascii 编码来转换的，而 ASCII字符集中不包含有中文，所以报错了。相当于：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b7e246242283\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; y.decode('ascii')\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe4 in position 0: ordinal not in range(128)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b7e246242283-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b7e246242283-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b7e246242283-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b7e246242283-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b7e246242283-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ascii'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b7e246242283-2\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b7e246242283-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b7e246242283-4\"><span class=\"crayon-v\">UnicodeDecodeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ascii'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">codec </span><span class=\"crayon-i\">can</span>'<span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decode </span><span class=\"crayon-t\">byte</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xe4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ordinal </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>正确地方式应该是找到一种包含有中文字符的字符编码，比如 UTF-8或者 GBK 显示地把 y 进行解码转换成 unicode 类型</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759957b81153576185\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; x = u\"Python\"\r\n&gt;&gt;&gt; y = \"之禅\"\r\n&gt;&gt;&gt; y = y.decode(\"utf-8\")\r\n&gt;&gt;&gt; x + y\r\nu'Python\\u4e4b\\u7985'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759957b81153576185-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b81153576185-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b81153576185-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759957b81153576185-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759957b81153576185-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759957b81153576185-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"Python\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b81153576185-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"之禅\"</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b81153576185-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759957b81153576185-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line\" id=\"crayon-599d759957b81153576185-5\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'Python\\u4e4b\\u7985'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>以上内容都是基于 Python2 来讲的，关于 Python3 的字符和编码将会另开一篇文章来写，保持关注。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88264\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88264votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88264\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 10 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,字符编码",
    "article_url": "http://python.jobbole.com/88264/",
    "url_object_id": "0aaa307cd5bc283478bd4a59bc3404a1",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/c5064220563ade2952ece4d810c00f8f.jpg"
    ]
}
{
    "title": "Python 入门最容易犯的错误",
    "create_date": "2017/08/04",
    "agree_num": 2,
    "comment_num": 0,
    "fav_num": 2,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://foofish.net/python-newbie-made-mistake-usually.html\">liuzhijun</a>   </div><p>Python 以其简单易懂的语法格式与其它语言形成鲜明对比，初学者遇到最多的问题就是不按照 Python 的规则来写，即便是有编程经验的程序员，也容易按照固有的思维和语法格式来写 Python 代码，有一个外国小伙总结了一些大家常犯的错误，<a href=\"https://inventwithpython.com/blog/2012/07/09/16-common-python-runtime-errors-beginners-find/\">16 Common Python Runtime Errors Beginners Find</a>，我把他翻译过来并在原来的基础补充了我的一些理解，希望可以让你避开这些坑。</p>\n<h1>0、忘记写冒号</h1>\n<p>在 if、elif、else、for、while、class、def 语句后面忘记添加 “:”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db18814819246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif spam == 42\r\n    print('Hello!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db18814819246-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db18814819246-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db18814819246-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db18814819246-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>导致：SyntaxError: invalid syntax</p>\n<h1>1、误用 “=” 做等值比较</h1>\n<p>“=” 是赋值操作，而判断两个值是否相等是 “==”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db29786982223\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif spam = 42:\r\n    print('Hello!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db29786982223-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db29786982223-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db29786982223-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db29786982223-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>导致：SyntaxError: invalid syntax</p>\n<h1>2、使用错误的缩进</h1>\n<p>Python用缩进区分代码块，常见的错误用法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db2e734225857\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint('Hello!')\r\n    print('Howdy!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db2e734225857-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db2e734225857-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db2e734225857-1\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db2e734225857-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Howdy!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>导致：IndentationError: unexpected indent。同一个代码块中的每行代码都必须保持一致的缩进量</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db31392091026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif spam == 42:\r\n    print('Hello!')\r\n  print('Howdy!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db31392091026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db31392091026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db31392091026-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db31392091026-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db31392091026-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db31392091026-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Howdy!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>导致：IndentationError: unindent does not match any outer indentation level。代码块结束之后缩进恢复到原来的位置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db35869288037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif spam == 42:\r\nprint('Hello!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db35869288037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db35869288037-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db35869288037-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db35869288037-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>导致：IndentationError: expected an indented block，“:” 后面要使用缩进</p>\n<h1>3、变量没有定义</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db39821699542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif spam == 42:\r\n    print('Hello!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db39821699542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db39821699542-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db39821699542-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db39821699542-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>导致：NameError: name ‘spam’ is not defined</p>\n<h1>4、获取列表元素索引位置忘记调用 len 方法</h1>\n<p>通过索引位置获取元素的时候，忘记使用 len 函数获取列表的长度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db3c093858363\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = ['cat', 'dog', 'mouse']\r\nfor i in range(spam):\r\n    print(spam[i])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db3c093858363-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db3c093858363-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db3c093858363-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db3c093858363-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db3c093858363-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db3c093858363-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>导致：TypeError: range() integer end argument expected, got list. 正确的做法是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db40332011347\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = ['cat', 'dog', 'mouse']\r\nfor i in range(len(spam)):\r\n    print(spam[i])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db40332011347-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db40332011347-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db40332011347-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db40332011347-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db40332011347-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db40332011347-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>当然，更 Pythonic 的写法是用 enumerate</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db44878121516\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = ['cat', 'dog', 'mouse']\r\nfor i, item in enumerate(spam):\r\n    print(i, item)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db44878121516-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db44878121516-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db44878121516-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db44878121516-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db44878121516-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db44878121516-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h1>5、修改字符串</h1>\n<p>字符串一个序列对象，支持用索引获取元素，但它和列表对象不同，字符串是不可变对象，不支持修改。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db47824651738\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = 'I have a pet cat.'\r\nspam[13] = 'r'\r\nprint(spam)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db47824651738-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db47824651738-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db47824651738-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db47824651738-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I have a pet cat.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db47824651738-2\"><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'r'</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db47824651738-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>导致：TypeError: ‘str’ object does not support item assignment 正确地做法应该是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db4b147661146\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = 'I have a pet cat.'\r\nspam = spam[:13] + 'r' + spam[14:]\r\nprint(spam)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db4b147661146-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db4b147661146-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db4b147661146-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db4b147661146-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I have a pet cat.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db4b147661146-2\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'r'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db4b147661146-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h1>6、字符串与非字符串连接</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db4f417729365\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnum_eggs = 12\r\nprint('I have ' + num_eggs + ' eggs.')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db4f417729365-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db4f417729365-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db4f417729365-1\"><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db4f417729365-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'I have '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' eggs.'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>导致：TypeError: cannot concatenate ‘str’ and ‘int’ objects</p>\n<p>字符串与非字符串连接时，必须把非字符串对象强制转换为字符串类型</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db52099464757\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnum_eggs = 12\r\nprint('I have ' + str(num_eggs) + ' eggs.')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db52099464757-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db52099464757-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db52099464757-1\"><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db52099464757-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'I have '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' eggs.'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>或者使用字符串的格式化形式</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db55664422171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnum_eggs = 12\r\nprint('I have %s eggs.' % (num_eggs))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db55664422171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db55664422171-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db55664422171-1\"><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db55664422171-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'I have %s eggs.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_eggs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h1>7、使用错误的索引位置</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db59783384376\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = ['cat', 'dog', 'mouse']\r\nprint(spam[3])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db59783384376-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db59783384376-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db59783384376-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db59783384376-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>导致：IndexError: list index out of range</p>\n<p>列表对象的索引是从0开始的，第3个元素应该是使用 spam[2] 访问</p>\n<h1>8、字典中使用不存在的键</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db5c865015295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = {'cat': 'Zophie', 'dog': 'Basil', 'mouse': 'Whiskers'}\r\nprint('The name of my pet zebra is ' + spam['zebra'])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db5c865015295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db5c865015295-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db5c865015295-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Zophie'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Basil'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Whiskers'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db5c865015295-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'The name of my pet zebra is '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'zebra'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在字典对象中访问 key 可以使用 <code>[]</code>，但是如果该 key 不存在，就会导致：KeyError: ‘zebra’</p>\n<p>正确的方式应该使用 get 方法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db60715009469\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = {'cat': 'Zophie', 'dog': 'Basil', 'mouse': 'Whiskers'}\r\nprint('The name of my pet zebra is ' + spam.get('zebra'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db60715009469-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db60715009469-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db60715009469-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cat'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Zophie'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dog'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Basil'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mouse'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Whiskers'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db60715009469-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'The name of my pet zebra is '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spam</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'zebra'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>key 不存在时，get 默认返回 None</p>\n<h1>9、用关键字做变量名</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db64578065965\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass = 'algebra'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db64578065965-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db64578065965-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'algebra'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>导致：SyntaxError: invalid syntax</p>\n<p>在 Python 中不允许使用关键字作为变量名。Python3 一共有33个关键字。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db67522754513\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; import keyword\r\n&gt;&gt;&gt; print(keyword.kwlist)\r\n['False', 'None', 'True', 'and', 'as', 'assert', 'break', 'class', 'continue', 'def', 'del', 'elif', 'else', 'except', 'finally', 'for', 'from', 'global', 'if', 'import', 'in', 'is', 'lambda', 'nonlocal', 'not', 'or', 'pass', 'raise', 'return', 'try', 'while', 'with', 'yield']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db67522754513-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db67522754513-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db67522754513-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db67522754513-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">keyword</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db67522754513-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">kwlist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db67522754513-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'False'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'None'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'True'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'and'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'as'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'assert'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'break'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'continue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'def'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'del'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'elif'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'else'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'except'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finally'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'for'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'from'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'global'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'if'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'import'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'in'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'is'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lambda'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nonlocal'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'or'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'pass'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'raise'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'return'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'try'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'while'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'with'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yield'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h1>10、函数中局部变量赋值前被使用</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db6b947934632\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsomeVar = 42\r\n\r\ndef myFunction():\r\n    print(someVar)\r\n    someVar = 100\r\n\r\nmyFunction()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db6b947934632-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db6b947934632-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db6b947934632-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db6b947934632-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db6b947934632-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db6b947934632-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db6b947934632-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db6b947934632-1\"><span class=\"crayon-v\">someVar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db6b947934632-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d771e7db6b947934632-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">myFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db6b947934632-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">someVar</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db6b947934632-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">someVar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db6b947934632-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d771e7db6b947934632-7\"><span class=\"crayon-e\">myFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>导致：UnboundLocalError: local variable ‘someVar’ referenced before assignment</p>\n<p>当函数中有一个与全局作用域中同名的变量时，它会按照 LEGB 的顺序查找该变量，如果在函数内部的局部作用域中也定义了一个同名的变量，那么就不再到外部作用域查找了。因此，在 myFunction 函数中 someVar 被定义了，所以 print(someVar) 就不再外面查找了，但是 print 的时候该变量还没赋值，所以出现了 UnboundLocalError</p>\n<h1>11、使用自增 “++” 自减 “–”</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db6e356635990\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = 0\r\nspam++</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db6e356635990-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db6e356635990-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db6e356635990-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db6e356635990-2\"><span class=\"crayon-v\">spam</span><span class=\"crayon-o\">++</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>哈哈，Python 中没有自增自减操作符，如果你是从C、Java转过来的话，你可要注意了。你可以使用 “+=” 来替代 “++”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db72351773303\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspam = 0\r\nspam += 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db72351773303-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db72351773303-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db72351773303-1\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db72351773303-2\"><span class=\"crayon-v\">spam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>12、错误地调用类中的方法</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d771e7db75881489793\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Foo:\r\n    def method1():\r\n        print('m1')\r\n    def method2(self):\r\n        print(\"m2\")\r\n\r\na = Foo()\r\na.method1()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d771e7db75881489793-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db75881489793-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db75881489793-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db75881489793-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db75881489793-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db75881489793-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d771e7db75881489793-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d771e7db75881489793-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d771e7db75881489793-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db75881489793-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">method1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db75881489793-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'m1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db75881489793-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">method2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d771e7db75881489793-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"m2\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db75881489793-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d771e7db75881489793-7\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d771e7db75881489793-8\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">method1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>导致：TypeError: method1() takes 0 positional arguments but 1 was given</p>\n<p>method1 是 Foo 类的一个成员方法，该方法不接受任何参数，调用 a.method1() 相当于调用 Foo.method1(a)，但 method1 不接受任何参数，所以报错了。正确的调用方式应该是 Foo.method1()。</p>\n<p>需要注意的是，以上代码都是基于 Python3 的，在 Python2 中即使是同样的代码出现的错误也不尽一样，尤其是最后一个例子。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88262\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88262votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88262\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,基础知识",
    "article_url": "http://python.jobbole.com/88262/",
    "url_object_id": "0a875793b65bfdbbb2f6b6425748c7df",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e6345801.png"
    ]
}
{
    "title": "Tyrion 中文文档（含示例源码）",
    "create_date": "2017/08/03",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 2,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/wupeiqi/p/5938916.html\">Mr.Seven</a>   </div><p>Tyrion是一个基于Python实现的支持多个WEB框架的<span style=\"color: #ff0000\"><strong>Form表单验证</strong></span>组件，其完美的支持Tornado、Django、Flask、Bottle Web框架。Tyrion主要有两大重要动能：</p>\n<ul>\n<li>表单验证</li>\n<li>生成HTML标签</li>\n<li>保留上次提交内容</li>\n</ul>\n<p>对于表单验证，告别书写重复的正则表达式对用户提交的数据进行验证的工作，从此解放双手，跟着我左手右手一个慢动作…</p>\n<p>对于生成HTML标签，不在人工书写html标签，让Tyrion帮你自动创建…</p>\n<p>对于保留上次提交内容，由于默认表单提交后页面刷新，原来输入的内容会清空，Tyrion可以保留上次提交内容。</p>\n<p>github：<a href=\"https://github.com/WuPeiqi/Tyrion\" target=\"_blank\">https://github.com/WuPeiqi/Tyrion</a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4edaa1e8a68118b3c66933e14c564fda.gif\"><img class=\"aligncenter wp-image-88253 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4edaa1e8a68118b3c66933e14c564fda.gif\" alt=\"425762-20161009185237561-173732312\" width=\"640\" height=\"400\"></a></p>\n<h1>使用文档</h1>\n<h2><strong>1、下载安装</strong></h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1a9986835757\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install PyTyrion</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1a9986835757-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1a9986835757-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">PyTyrion</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>github: <a href=\"https://github.com/WuPeiqi/Tyrion\" target=\"_blank\">https://github.com/WuPeiqi/Tyrion</a></p>\n<h2><strong>2、配置WEB框架种类</strong></h2>\n<p>由于Tyrion同时支持Tornado、Django、Flask、Bottle多个WEB框架，所有在使用前需要进行指定。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1b4658190524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport Tyrion\r\nTyrion.setup('tornado')\r\n# setup的参数有：tornado（默认）、django、bottle、flask</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b4658190524-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1b4658190524-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b4658190524-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1b4658190524-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Tyrion</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1b4658190524-2\"><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'tornado'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1b4658190524-3\"><span class=\"crayon-p\"># setup的参数有：tornado（默认）、django、bottle、flask</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2><strong>3、创建Form类</strong></h2>\n<p>Form类用于提供验证规则、插件属性、错误信息等</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1b8347109303\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom Tyrion.Forms import Form\r\nfrom Tyrion.Fields import StringField\r\nfrom Tyrion.Fields import EmailField\r\n \r\nclass LoginForm(Form):\r\n    username = StringField(error={'required': '用户名不能为空'})\r\n    password = StringField(error={'required': '密码不能为空'})\r\n    email = EmailField(error={'required': '邮箱不能为空', 'invalid': '邮箱格式错误'})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b8347109303-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1b8347109303-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b8347109303-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1b8347109303-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b8347109303-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1b8347109303-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1b8347109303-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1b8347109303-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1b8347109303-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Forms </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Form</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1b8347109303-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">StringField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1b8347109303-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">EmailField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1b8347109303-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1b8347109303-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1b8347109303-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1b8347109303-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'密码不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1b8347109303-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EmailField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h2><strong>4、验证用户请求</strong></h2>\n<p>前端HTML代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1bb590320986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;form method=\"POST\" action=\"/login.html\"&gt;\r\n    &lt;div&gt;\r\n        &lt;input type=\"text\" name=\"username\"&gt;\r\n    &lt;/div&gt;\r\n    &lt;div&gt;\r\n        &lt;input type=\"text\" name=\"password\"&gt;\r\n    &lt;/div&gt;\r\n    &lt;div&gt;\r\n        &lt;input type=\"text\" name=\"email\"&gt;\r\n    &lt;/div&gt;\r\n \r\n    &lt;input type=\"submit\" value=\"提交\"&gt;\r\n&lt;/form&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bb590320986-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bb590320986-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/login.html\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bb590320986-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"提交\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bb590320986-13\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<form action=\"http://top.jobbole.com/login.html\" method=\"POST\"></form>\n<p>用户提交数据时，在后台书写如下代码即可实现用户请求数据验证(Tornado示例)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1bf767746290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass LoginHandler(tornado.web.RequestHandler):\r\n    def get(self, *args, **kwargs):\r\n        self.render('login.html')\r\n \r\n    def post(self, *args, **kwargs):\r\n        form = LoginForm(self)\r\n \r\n        ###### 检查用户输入是否合法 ######\r\n        if form.is_valid():\r\n \r\n            ###### 如果不合法，则输出错误信息 ######\r\n            print(form.error_dict)\r\n        else:\r\n            ###### 如果合法，则输出用户输入的内容 ######\r\n            print(form.value_dict)\r\n        self.render('login.html')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1bf767746290-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1bf767746290-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tornado</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RequestHandler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'login.html'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-4\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">###### 检查用户输入是否合法 ######</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-10\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\">###### 如果不合法，则输出错误信息 ######</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\">###### 如果合法，则输出用户输入的内容 ######</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1bf767746290-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1bf767746290-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'login.html'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p><span style=\"color: #ff0000\"><strong>示例01</strong></span>：<a href=\"http://files.cnblogs.com/files/wupeiqi/Demo01.zip\" target=\"_blank\">源码下载（含Tornado、Django、Flask、Bottle）</a></p>\n<h2><strong>5、验证用户请求 &amp;&amp; 生成HTML标签 &amp;&amp; 保留上次输入内容 &amp;&amp; 错误提示</strong></h2>\n<p>Tyrion不仅可以验证用户请求，还可以生成自动创建HTML标签并且可以保留用户上次输入的内容。在HTML模板中调用Form类对象的字段即可，如（Tornado示例）：</p>\n<div id=\"cnblogs_code_open_cae82d37-a89d-43eb-9ff9-a5cff7cff736\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1c3823017045\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom Tyrion.Forms import Form\r\n        from Tyrion.Fields import StringField\r\n        from Tyrion.Fields import EmailField\r\n\r\n        class LoginForm(Form):\r\n            username = StringField(error={'required': '用户名不能为空'})\r\n            password = StringField(error={'required': '密码不能为空'})\r\n            email = EmailField(error={'required': '邮箱不能为空', 'invalid': '邮箱格式错误'})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c3823017045-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c3823017045-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c3823017045-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c3823017045-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c3823017045-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c3823017045-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c3823017045-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c3823017045-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1c3823017045-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Forms </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Form</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c3823017045-2\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">StringField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c3823017045-3\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">EmailField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c3823017045-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c3823017045-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c3823017045-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c3823017045-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'密码不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c3823017045-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EmailField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<div id=\"cnblogs_code_open_cd3839d8-f9ba-4f87-87aa-992d3ca2ee74\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1c6893269296\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass LoginHandler(tornado.web.RequestHandler):\r\n            def get(self, *args, **kwargs):\r\n                form = LoginForm(self)\r\n                self.render('login.html', form=form)\r\n\r\n            def post(self, *args, **kwargs):\r\n                form = LoginForm(self)\r\n\r\n                print(form.is_valid())\r\n                print(form.error_dict)\r\n                print(form.value_dict)\r\n\r\n                self.render('login.html', form=form)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1c6893269296-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1c6893269296-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tornado</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RequestHandler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'login.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1c6893269296-12\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1c6893269296-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'login.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<div id=\"cnblogs_code_open_e84b2cb3-4b1b-4f22-8da8-b8c51a18f18c\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1d8984506429\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;form method=\"post\" action=\"/login.html\"&gt;\r\n            &lt;div&gt;\r\n                &lt;!-- Form创建的标签 --&gt;\r\n                {% raw form.username %}\r\n\r\n                &lt;!-- 错误信息 --&gt;\r\n                &lt;span&gt;{{form.error_dict.get('username',\"\")}}&lt;/span&gt;\r\n            &lt;/div&gt;\r\n            &lt;div&gt;\r\n                {% raw form.password %}\r\n                &lt;span&gt;{{form.error_dict.get('password',\"\")}}&lt;/span&gt;\r\n            &lt;/div&gt;\r\n            &lt;div&gt;\r\n                {% raw form.email %}\r\n                &lt;span&gt;{{form.error_dict.get('email',\"\")}}&lt;/span&gt;\r\n            &lt;/div&gt;\r\n            &lt;input type=\"submit\" value=\"提交\"/&gt;\r\n        &lt;/form&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1d8984506429-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1d8984506429-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/login.html\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Form</span>创建的标签<span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">raw </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-6\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>错误信息<span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_dict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'username'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">raw </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_dict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'password'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">raw </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_dict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'email'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1d8984506429-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"提交\"</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1d8984506429-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n\n<form method=\"&lt;span\"></form>\n</div>\n<p><em>注意： HTML模板中的转义</em></p>\n<p><span style=\"color: #ff0000\"><strong>示例02</strong></span>：<a href=\"http://files.cnblogs.com/files/wupeiqi/Demo02.zip\" target=\"_blank\">源码下载（含有Tornado、Django、Flask、Bottle）</a></p>\n<h2><strong>6、Form字段类型</strong></h2>\n<p>Form的字段用于指定从请求中获取的数据类型以及格式，以此来验证用户输入的内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1dc757614833\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom Tyrion.Forms import Form\r\nfrom Tyrion.Fields import StringField\r\nfrom Tyrion.Fields import EmailField\r\n \r\nclass LoginForm(Form):\r\n    username = StringField(error={'required': '用户名不能为空'})\r\n    password = StringField(error={'required': '密码不能为空'})\r\n    email = EmailField(error={'required': '邮箱不能为空', 'invalid': '邮箱格式错误'})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1dc757614833-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1dc757614833-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1dc757614833-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1dc757614833-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1dc757614833-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1dc757614833-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1dc757614833-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1dc757614833-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1dc757614833-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Forms </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Form</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1dc757614833-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">StringField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1dc757614833-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">EmailField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1dc757614833-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1dc757614833-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1dc757614833-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1dc757614833-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'密码不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1dc757614833-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EmailField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>以上代码表示此Form类可以用于验证用户输入的内容，并且 username和password必须不能为空，email必须不能为空并且必须是邮箱格式。</p>\n<p>目前支持所有字段：</p>\n<div id=\"cnblogs_code_open_2b9ab8f9-44c3-4c79-a2e2-f48ba259d8f6\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1df586515172\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nStringField\r\n    \"\"\"\r\n    要求必须是字符串，即：正则^.*$\r\n \r\n    参数：\r\n        required    布尔值，是否允许为空\r\n        max_length  整数，限制用户输入内容最大长度\r\n        min_length  整数，限制用户输入内容最小长度\r\n        error       字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'invalid': '格式错误时的错误提示',\r\n                                            'max_length': '最大长度为10',\r\n                                            'min_length': '最小长度为1',\r\n                                          }\r\n        widget      定制生成的HTML插件（默认InputText）\r\n    \"\"\"\r\n \r\nEmailField\r\n    \"\"\"\r\n    要求必须是邮箱格式的字符串\r\n \r\n    参数：\r\n        required    布尔值，是否允许为空\r\n        max_length  整数，限制用户输入内容最大长度\r\n        min_length  整数，限制用户输入内容最小长度\r\n        error       字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'invalid': '格式错误时的错误提示',\r\n                                            'max_length': '最大长度为10',\r\n                                            'min_length': '最小长度为1',\r\n                                          }\r\n        widget      定制生成的HTML插件（默认InputText）\r\n    \"\"\"\r\n \r\nIPField\r\n    \"\"\"\r\n    要求必须是IP格式\r\n \r\n    参数：\r\n        required    布尔值，是否允许为空\r\n        max_length  整数，限制用户输入内容最大长度\r\n        min_length  整数，限制用户输入内容最小长度\r\n        error       字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'invalid': '格式错误时的错误提示',\r\n                                            'max_length': '最大长度为10',\r\n                                            'min_length': '最小长度为1',\r\n                                          }\r\n        widget      定制生成的HTML插件（默认InputText）\r\n \r\n    \"\"\"\r\n \r\nIntegerField\r\n    \"\"\"\r\n    要求必须整数格式\r\n \r\n    参数：\r\n        required    布尔值，是否允许为空\r\n        max_value   整数，限制用户输入数字最大值\r\n        min_value   整数，限制用户输入数字最小值\r\n        error       字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'invalid': '格式错误时的错误提示',\r\n                                            'max_value': '最大值为10',\r\n                                            'max_value': '最小值度为1',\r\n                                          }\r\n        widget      定制生成的HTML插件（默认InputText）\r\n \r\n    \"\"\"\r\n \r\nFloatField\r\n    \"\"\"\r\n    要求必须小数格式\r\n \r\n    参数：\r\n        required    布尔值，是否允许为空\r\n        max_value   整数，限制用户输入数字最大值\r\n        min_value   整数，限制用户输入数字最小值\r\n        error       字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'invalid': '格式错误时的错误提示',\r\n                                            'max_value': '最大值为10',\r\n                                            'max_value': '最小值度为1',\r\n                                          }\r\n        widget      定制生成的HTML插件（默认InputText）\r\n    \"\"\"\r\n \r\nStringListField\r\n    \"\"\"\r\n    用于获取请求中的多个值，且保证每一个元素是字符串，即：正则^.*$\r\n    如：checkbox或selct多选时，会提交多个值，用此字段可以将用户提交的值保存至列表\r\n \r\n    参数：\r\n        required         布尔值，是否允许为空\r\n        ele_max_length   整数，限制用户输入的每个元素内容最大长度\r\n        ele_min_length   整数，限制用户输入的每个元素内容最小长度\r\n        error            字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'element': '列表中的元素必须是字符串',\r\n                                            'ele_max_length': '最大长度为10',\r\n                                            'ele_min_length': '最小长度为1',\r\n                                          }\r\n        widget           定制生成的HTML插件（默认InputMultiCheckBox，即：checkbox）\r\n    \"\"\"\r\n \r\nIntegerListField\r\n    \"\"\"\r\n    用于获取请求中的多个值，且保证每一个元素是整数\r\n    如：checkbox或selct多选时，会提交多个值，用此字段可以将用户提交的值保存至列表\r\n \r\n    参数：\r\n        required         布尔值，是否允许为空\r\n        ele_max_value   整数，限制用户输入的每个元素内容最大长度\r\n        ele_min_value   整数，限制用户输入的每个元素内容最小长度\r\n        error            字典，自定义错误提示，如：{\r\n                                            'required': '值为空时的错误提示',\r\n                                            'element': '列表中的元素必须是数字',\r\n                                            'ele_max_value': '最大值为x',\r\n                                            'ele_min_value': '最小值为x',\r\n                                          }\r\n        widget           定制生成的HTML插件（默认InputMultiCheckBox，即：checkbox）\r\n    \"\"\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1df586515172-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1df586515172-122\">122</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-1\"><span class=\"crayon-i\">StringField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-3\"><span class=\"crayon-s\">    要求必须是字符串，即：正则^.*$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-4\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-5\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-6\"><span class=\"crayon-s\">        required    布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-7\"><span class=\"crayon-s\">        max_length  整数，限制用户输入内容最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-8\"><span class=\"crayon-s\">        min_length  整数，限制用户输入内容最小长度</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-9\"><span class=\"crayon-s\">        error       字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-10\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-11\"><span class=\"crayon-s\">                                            'invalid': '格式错误时的错误提示',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-12\"><span class=\"crayon-s\">                                            'max_length': '最大长度为10',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-13\"><span class=\"crayon-s\">                                            'min_length': '最小长度为1',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-14\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-15\"><span class=\"crayon-s\">        widget      定制生成的HTML插件（默认InputText）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-16\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-18\"><span class=\"crayon-i\">EmailField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-20\"><span class=\"crayon-s\">    要求必须是邮箱格式的字符串</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-21\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-22\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-23\"><span class=\"crayon-s\">        required    布尔值，是否允许为空</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-24\"><span class=\"crayon-s\">        max_length  整数，限制用户输入内容最大长度</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-25\"><span class=\"crayon-s\">        min_length  整数，限制用户输入内容最小长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-26\"><span class=\"crayon-s\">        error       字典，自定义错误提示，如：{</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-27\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-28\"><span class=\"crayon-s\">                                            'invalid': '格式错误时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-29\"><span class=\"crayon-s\">                                            'max_length': '最大长度为10',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-30\"><span class=\"crayon-s\">                                            'min_length': '最小长度为1',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-31\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-32\"><span class=\"crayon-s\">        widget      定制生成的HTML插件（默认InputText）</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-33\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-34\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-35\"><span class=\"crayon-i\">IPField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-37\"><span class=\"crayon-s\">    要求必须是IP格式</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-38\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-39\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-40\"><span class=\"crayon-s\">        required    布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-41\"><span class=\"crayon-s\">        max_length  整数，限制用户输入内容最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-42\"><span class=\"crayon-s\">        min_length  整数，限制用户输入内容最小长度</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-43\"><span class=\"crayon-s\">        error       字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-44\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-45\"><span class=\"crayon-s\">                                            'invalid': '格式错误时的错误提示',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-46\"><span class=\"crayon-s\">                                            'max_length': '最大长度为10',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-47\"><span class=\"crayon-s\">                                            'min_length': '最小长度为1',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-48\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-49\"><span class=\"crayon-s\">        widget      定制生成的HTML插件（默认InputText）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-50\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-51\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-52\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-53\"><span class=\"crayon-i\">IntegerField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-55\"><span class=\"crayon-s\">    要求必须整数格式</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-56\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-57\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-58\"><span class=\"crayon-s\">        required    布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-59\"><span class=\"crayon-s\">        max_value   整数，限制用户输入数字最大值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-60\"><span class=\"crayon-s\">        min_value   整数，限制用户输入数字最小值</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-61\"><span class=\"crayon-s\">        error       字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-62\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-63\"><span class=\"crayon-s\">                                            'invalid': '格式错误时的错误提示',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-64\"><span class=\"crayon-s\">                                            'max_value': '最大值为10',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-65\"><span class=\"crayon-s\">                                            'max_value': '最小值度为1',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-66\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-67\"><span class=\"crayon-s\">        widget      定制生成的HTML插件（默认InputText）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-68\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-69\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-70\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-71\"><span class=\"crayon-i\">FloatField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-73\"><span class=\"crayon-s\">    要求必须小数格式</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-74\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-75\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-76\"><span class=\"crayon-s\">        required    布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-77\"><span class=\"crayon-s\">        max_value   整数，限制用户输入数字最大值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-78\"><span class=\"crayon-s\">        min_value   整数，限制用户输入数字最小值</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-79\"><span class=\"crayon-s\">        error       字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-80\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-81\"><span class=\"crayon-s\">                                            'invalid': '格式错误时的错误提示',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-82\"><span class=\"crayon-s\">                                            'max_value': '最大值为10',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-83\"><span class=\"crayon-s\">                                            'max_value': '最小值度为1',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-84\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-85\"><span class=\"crayon-s\">        widget      定制生成的HTML插件（默认InputText）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-86\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-87\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-88\"><span class=\"crayon-i\">StringListField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-90\"><span class=\"crayon-s\">    用于获取请求中的多个值，且保证每一个元素是字符串，即：正则^.*$</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-91\"><span class=\"crayon-s\">    如：checkbox或selct多选时，会提交多个值，用此字段可以将用户提交的值保存至列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-92\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-93\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-94\"><span class=\"crayon-s\">        required         布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-95\"><span class=\"crayon-s\">        ele_max_length   整数，限制用户输入的每个元素内容最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-96\"><span class=\"crayon-s\">        ele_min_length   整数，限制用户输入的每个元素内容最小长度</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-97\"><span class=\"crayon-s\">        error            字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-98\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-99\"><span class=\"crayon-s\">                                            'element': '列表中的元素必须是字符串',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-100\"><span class=\"crayon-s\">                                            'ele_max_length': '最大长度为10',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-101\"><span class=\"crayon-s\">                                            'ele_min_length': '最小长度为1',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-102\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-103\"><span class=\"crayon-s\">        widget           定制生成的HTML插件（默认InputMultiCheckBox，即：checkbox）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-104\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-105\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-106\"><span class=\"crayon-i\">IntegerListField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-108\"><span class=\"crayon-s\">    用于获取请求中的多个值，且保证每一个元素是整数</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-109\"><span class=\"crayon-s\">    如：checkbox或selct多选时，会提交多个值，用此字段可以将用户提交的值保存至列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-110\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-111\"><span class=\"crayon-s\">    参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-112\"><span class=\"crayon-s\">        required         布尔值，是否允许为空</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-113\"><span class=\"crayon-s\">        ele_max_value   整数，限制用户输入的每个元素内容最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-114\"><span class=\"crayon-s\">        ele_min_value   整数，限制用户输入的每个元素内容最小长度</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-115\"><span class=\"crayon-s\">        error            字典，自定义错误提示，如：{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-116\"><span class=\"crayon-s\">                                            'required': '值为空时的错误提示',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-117\"><span class=\"crayon-s\">                                            'element': '列表中的元素必须是数字',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-118\"><span class=\"crayon-s\">                                            'ele_max_value': '最大值为x',</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-119\"><span class=\"crayon-s\">                                            'ele_min_value': '最小值为x',</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-120\"><span class=\"crayon-s\">                                          }</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1df586515172-121\"><span class=\"crayon-s\">        widget           定制生成的HTML插件（默认InputMultiCheckBox，即：checkbox）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1df586515172-122\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n\n</div>\n<h2><strong>7、Form字段widget参数：HTML插件</strong></h2>\n<p>HTML插件用于指定当前字段在生成HTML时表现的种类和属性，通过指定此参数从而实现定制页面上生成的HTML标签</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1e6896366322\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom Tyrion.Forms import Form\r\nfrom Tyrion.Fields import StringField\r\nfrom Tyrion.Fields import EmailField\r\n \r\nfrom Tyrion.Widget import InputPassword\r\n \r\nclass LoginForm(Form):\r\n    password = StringField(error={'required': '密码不能为空'},widget=InputPassword())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1e6896366322-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1e6896366322-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1e6896366322-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1e6896366322-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1e6896366322-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1e6896366322-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1e6896366322-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1e6896366322-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1e6896366322-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Forms </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Form</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1e6896366322-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">StringField</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1e6896366322-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fields </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">EmailField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1e6896366322-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1e6896366322-5\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Tyrion</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Widget </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">InputPassword</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1e6896366322-6\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1e6896366322-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoginForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1e6896366322-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'密码不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputPassword</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>上述LoginForm的password字段要求用户输入必须是字符串类型，并且指定生成HTML标签时会创建为&lt;input type=’password’ &gt; 标签</p>\n<p>目前支持所有插件：</p>\n<div id=\"cnblogs_code_open_3f6e6d72-5ffd-46d3-9f58-4b3ae2cfacf8\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1ea850865617\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nInputText\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成input type='text' 标签\r\n\r\n        参数：\r\n            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}\r\n        \"\"\"\r\n    InputEmail\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成input type='email' 标签\r\n\r\n        参数：\r\n            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}\r\n        \"\"\"\r\n    InputPassword\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成input type='password' 标签\r\n\r\n        参数：\r\n            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}\r\n        \"\"\"\r\n    TextArea\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成 textarea 标签\r\n\r\n        参数：\r\n            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1'}\r\n            value   字符串，用于设置textarea标签中默认显示的内容\r\n        \"\"\"\r\n\r\n    InputRadio\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成一系列 input type='radio' 标签（选择时互斥）\r\n\r\n        参数：\r\n            attr                字典，生成的HTML属性，如：{'class': 'c1'}\r\n            text_value_list     列表，生成的多个radio标签的内容和值，如：[\r\n                                                                {'value':1, 'text': '男'},\r\n                                                                {'value':2, 'text': '女'},\r\n                                                            ]\r\n            checked_value       整数或字符串，默认被选中的标签的value的值\r\n\r\n        示例：\r\n                from Tyrion.Forms import Form\r\n                from Tyrion.Fields import IntegerField\r\n\r\n                from Tyrion.Widget import InputRadio\r\n\r\n\r\n                class LoginForm(Form):\r\n                    favor = IntegerField(error={'required': '爱好不能为空'},\r\n                                         widget=InputRadio(attr={'class': 'c1'},\r\n                                                           text_value_list=[\r\n                                                               {'value': 1, 'text': '男'},\r\n                                                               {'value': 2, 'text': '女'}, ],\r\n                                                           checked_value=2\r\n                                                           )\r\n                                         )\r\n                上述favor字段生成的HTML标签为：\r\n                    &lt;div&gt;\r\n                        &lt;span&gt;\r\n                            &lt;input class='c1' type=\"radio\" name=\"gender\" value=\"1\"&gt;\r\n                        &lt;/span&gt;\r\n                        &lt;span&gt;男&lt;/span&gt;\r\n                    &lt;/div&gt;\r\n                    &lt;div&gt;\r\n                        &lt;span&gt;\r\n                            &lt;input class='c1' type=\"radio\" name=\"gender\" value=\"2\" checked='checked'&gt;\r\n                        &lt;/span&gt;\r\n                        &lt;span&gt;女&lt;/span&gt;\r\n                    &lt;/div&gt;\r\n        \"\"\"\r\n\r\n    InputSingleCheckBox\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成 input type='checkbox' 标签\r\n        参数：\r\n            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1'}\r\n        \"\"\"\r\n\r\n    InputMultiCheckBox\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成一系列 input type='checkbox' 标签\r\n\r\n        参数：\r\n            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}\r\n            text_value_list     列表，生成的多个checkbox标签的内容和值，如：[\r\n                                                                        {'value':1, 'text': '篮球'},\r\n                                                                        {'value':2, 'text': '足球'},\r\n                                                                        {'value':3, 'text': '乒乓球'},\r\n                                                                        {'value':4, 'text': '羽毛球'},\r\n                                                                    ]\r\n            checked_value_list  列表，默认选中的标签对应的value， 如：[1,3]\r\n        \"\"\"\r\n    SingleSelect\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成 单选select 标签\r\n\r\n        参数：\r\n            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}\r\n            text_value_list     列表，用于指定select标签中的option，如：[\r\n                                                                        {'value':1, 'text': '北京'},\r\n                                                                        {'value':2, 'text': '上海'},\r\n                                                                        {'value':3, 'text': '广州'},\r\n                                                                        {'value':4, 'text': '重庆'},\r\n                                                                    ]\r\n            selected_value      数字或字符串，默认被选中选项对应的值，如： 3\r\n        \"\"\"\r\n\r\n    MultiSelect\r\n        \"\"\"\r\n        设置Form对应字段在HTML中生成 多选select 标签\r\n\r\n        参数：\r\n            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}\r\n            text_value_list     列表，用于指定select标签中的option，如：[\r\n                                                                        {'value':1, 'text': '篮球'},\r\n                                                                        {'value':2, 'text': '足球'},\r\n                                                                        {'value':3, 'text': '乒乓球'},\r\n                                                                        {'value':4, 'text': '羽毛球'},\r\n                                                                    ]\r\n            selected_value_list 列表，默认被选中选项对应的值，如：[2,3,4]\r\n        \"\"\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1ea850865617-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1ea850865617-123\">123</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-1\"><span class=\"crayon-i\">InputText</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-3\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成input type='text' 标签</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-5\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-6\"><span class=\"crayon-s\">            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-7\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">InputEmail</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-10\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成input type='email' 标签</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-12\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-13\"><span class=\"crayon-s\">            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-14\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">InputPassword</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-17\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成input type='password' 标签</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-18\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-19\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-20\"><span class=\"crayon-s\">            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1', 'placeholder': 'username'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-21\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TextArea</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-24\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成 textarea 标签</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-26\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-27\"><span class=\"crayon-s\">            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1'}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-28\"><span class=\"crayon-s\">            value   字符串，用于设置textarea标签中默认显示的内容</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-29\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-30\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">InputRadio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-33\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成一系列 input type='radio' 标签（选择时互斥）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-34\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-35\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-36\"><span class=\"crayon-s\">            attr                字典，生成的HTML属性，如：{'class': 'c1'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-37\"><span class=\"crayon-s\">            text_value_list     列表，生成的多个radio标签的内容和值，如：[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-38\"><span class=\"crayon-s\">                                                                {'value':1, 'text': '男'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-39\"><span class=\"crayon-s\">                                                                {'value':2, 'text': '女'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-40\"><span class=\"crayon-s\">                                                            ]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-41\"><span class=\"crayon-s\">            checked_value       整数或字符串，默认被选中的标签的value的值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-42\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-43\"><span class=\"crayon-s\">        示例：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-44\"><span class=\"crayon-s\">                from Tyrion.Forms import Form</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-45\"><span class=\"crayon-s\">                from Tyrion.Fields import IntegerField</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-46\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-47\"><span class=\"crayon-s\">                from Tyrion.Widget import InputRadio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-48\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-50\"><span class=\"crayon-s\">                class LoginForm(Form):</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-51\"><span class=\"crayon-s\">                    favor = IntegerField(error={'required': '爱好不能为空'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-52\"><span class=\"crayon-s\">                                         widget=InputRadio(attr={'class': 'c1'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-53\"><span class=\"crayon-s\">                                                           text_value_list=[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-54\"><span class=\"crayon-s\">                                                               {'value': 1, 'text': '男'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-55\"><span class=\"crayon-s\">                                                               {'value': 2, 'text': '女'}, ],</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-56\"><span class=\"crayon-s\">                                                           checked_value=2</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-57\"><span class=\"crayon-s\">                                                           )</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-58\"><span class=\"crayon-s\">                                         )</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-59\"><span class=\"crayon-s\">                上述favor字段生成的HTML标签为：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-60\"><span class=\"crayon-s\">                    &lt;div&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-61\"><span class=\"crayon-s\">                        &lt;span&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-62\"><span class=\"crayon-s\">                            &lt;input class='c1' type=\"</span><span class=\"crayon-i\">radio</span><span class=\"crayon-s\">\" name=\"</span><span class=\"crayon-i\">gender</span><span class=\"crayon-s\">\" value=\"</span><span class=\"crayon-cn\">1</span><span class=\"crayon-s\">\"&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-63\"><span class=\"crayon-s\">                        &lt;/span&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-64\"><span class=\"crayon-s\">                        &lt;span&gt;男&lt;/span&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-65\"><span class=\"crayon-s\">                    &lt;/div&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-66\"><span class=\"crayon-s\">                    &lt;div&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-67\"><span class=\"crayon-s\">                        &lt;span&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-68\"><span class=\"crayon-s\">                            &lt;input class='c1' type=\"</span><span class=\"crayon-i\">radio</span><span class=\"crayon-s\">\" name=\"</span><span class=\"crayon-i\">gender</span><span class=\"crayon-s\">\" value=\"</span><span class=\"crayon-cn\">2</span><span class=\"crayon-s\">\" checked='checked'&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-69\"><span class=\"crayon-s\">                        &lt;/span&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-70\"><span class=\"crayon-s\">                        &lt;span&gt;女&lt;/span&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-71\"><span class=\"crayon-s\">                    &lt;/div&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-72\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">InputSingleCheckBox</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-76\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成 input type='checkbox' 标签</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-77\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-78\"><span class=\"crayon-s\">            attr    字典，指定生成标签的属性，如： attr = {'class': 'c1'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-79\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-80\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">InputMultiCheckBox</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-83\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成一系列 input type='checkbox' 标签</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-84\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-85\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-86\"><span class=\"crayon-s\">            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-87\"><span class=\"crayon-s\">            text_value_list     列表，生成的多个checkbox标签的内容和值，如：[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-88\"><span class=\"crayon-s\">                                                                        {'value':1, 'text': '篮球'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-89\"><span class=\"crayon-s\">                                                                        {'value':2, 'text': '足球'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-90\"><span class=\"crayon-s\">                                                                        {'value':3, 'text': '乒乓球'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-91\"><span class=\"crayon-s\">                                                                        {'value':4, 'text': '羽毛球'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-92\"><span class=\"crayon-s\">                                                                    ]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-93\"><span class=\"crayon-s\">            checked_value_list  列表，默认选中的标签对应的value， 如：[1,3]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-94\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">SingleSelect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-97\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成 单选select 标签</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-98\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-99\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-100\"><span class=\"crayon-s\">            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-101\"><span class=\"crayon-s\">            text_value_list     列表，用于指定select标签中的option，如：[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-102\"><span class=\"crayon-s\">                                                                        {'value':1, 'text': '北京'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-103\"><span class=\"crayon-s\">                                                                        {'value':2, 'text': '上海'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-104\"><span class=\"crayon-s\">                                                                        {'value':3, 'text': '广州'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-105\"><span class=\"crayon-s\">                                                                        {'value':4, 'text': '重庆'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-106\"><span class=\"crayon-s\">                                                                    ]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-107\"><span class=\"crayon-s\">            selected_value      数字或字符串，默认被选中选项对应的值，如： 3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-108\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-109\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">MultiSelect</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-112\"><span class=\"crayon-s\">        设置Form对应字段在HTML中生成 多选select 标签</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-113\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-114\"><span class=\"crayon-s\">        参数：</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-115\"><span class=\"crayon-s\">            attr                字典，指定生成标签的属性，如： attr = {'class': 'c1'}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-116\"><span class=\"crayon-s\">            text_value_list     列表，用于指定select标签中的option，如：[</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-117\"><span class=\"crayon-s\">                                                                        {'value':1, 'text': '篮球'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-118\"><span class=\"crayon-s\">                                                                        {'value':2, 'text': '足球'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-119\"><span class=\"crayon-s\">                                                                        {'value':3, 'text': '乒乓球'},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-120\"><span class=\"crayon-s\">                                                                        {'value':4, 'text': '羽毛球'},</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-121\"><span class=\"crayon-s\">                                                                    ]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1ea850865617-122\"><span class=\"crayon-s\">            selected_value_list 列表，默认被选中选项对应的值，如：[2,3,4]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1ea850865617-123\"><span class=\"crayon-s\">        \"</span><span class=\"crayon-s\">\"\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n\n</div>\n<h2><strong>8、动态初始化默认值</strong></h2>\n<p>由于Form可以用于生成HTML标签，如果想要在创建标签的同时再为其设置默认值有两种方式：</p>\n<ul>\n<li>静态，在插件参数中指定</li>\n<li>动态，调用Form对象的 init_field_value 方法来指定</li>\n</ul>\n<div id=\"cnblogs_code_open_52b9043d-4f8c-4926-93e7-d603f08ffc31\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1f2802372313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass InitValueForm(Form):\r\n        username = StringField(error={'required': '用户名不能为空'})\r\n        age = IntegerField(max_value=500,\r\n                           min_value=0,\r\n                           error={'required': '年龄不能为空',\r\n                                  'invalid': '年龄必须为数字',\r\n                                  'min_value': '年龄不能小于0',\r\n                                  'max_value': '年龄不能大于500'})\r\n\r\n        city = IntegerField(error={'required': '年龄不能为空', 'invalid': '年龄必须为数字'},\r\n                            widget=SingleSelect(text_value_list=[{'value': 1, 'text': '上海'},\r\n                                                                 {'value': 2, 'text': '北京'},\r\n                                                                 {'value': 3, 'text': '广州'}])\r\n                            )\r\n\r\n        gender = IntegerField(error={'required': '请选择性别',\r\n                                     'invalid': '性别必须为数字'},\r\n                              widget=InputRadio(text_value_list=[{'value': 1, 'text': '男', },\r\n                                                                 {'value': 2, 'text': '女', }],\r\n                                                checked_value=2))\r\n\r\n        protocol = IntegerField(error={'required': '请选择协议', 'invalid': '协议格式错误'},\r\n                                widget=InputSingleCheckBox(attr={'value': 1}))\r\n\r\n        favor_int_val = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                         widget=InputMultiCheckBox(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                                    {'value': 2, 'text': '足球', },\r\n                                                                                    {'value': 3, 'text': '乒乓球', },\r\n                                                                                    {'value': 4, 'text': '羽毛球'}, ]))\r\n\r\n        favor_str_val = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                        widget=InputMultiCheckBox(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                                   {'value': '2', 'text': '足球', },\r\n                                                                                   {'value': '3', 'text': '乒乓球', },\r\n                                                                                   {'value': '4', 'text': '羽毛球'}, ]))\r\n\r\n        select_str_val = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                         widget=MultiSelect(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                             {'value': '2', 'text': '足球', },\r\n                                                                             {'value': '3', 'text': '乒乓球', },\r\n                                                                             {'value': '4', 'text': '羽毛球'}, ]))\r\n\r\n        select_int_val = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                          widget=MultiSelect(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                              {'value': 2, 'text': '足球', },\r\n                                                                              {'value': 3, 'text': '乒乓球', },\r\n                                                                              {'value': 4, 'text': '羽毛球'}, ]))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f2802372313-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f2802372313-47\">47</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InitValueForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-4\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">min_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-5\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能为空'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-6\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄必须为数字'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-7\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'min_value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能小于0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-8\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'max_value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能大于500'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄必须为数字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-11\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">SingleSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'上海'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-12\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'北京'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-13\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'广州'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-14\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">gender</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择性别'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-17\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'性别必须为数字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-18\"><span class=\"crayon-h\">                              </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputRadio</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'男'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-19\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'女'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-20\"><span class=\"crayon-h\">                                                </span><span class=\"crayon-v\">checked_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择协议'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'协议格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-23\"><span class=\"crayon-h\">                                </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputSingleCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attr</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-24\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">favor_int_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-26\"><span class=\"crayon-h\">                                         </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-27\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-28\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-29\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-30\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">favor_str_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-32\"><span class=\"crayon-h\">                                        </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-33\"><span class=\"crayon-h\">                                                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-34\"><span class=\"crayon-h\">                                                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-35\"><span class=\"crayon-h\">                                                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-36\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_str_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-38\"><span class=\"crayon-h\">                                         </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-39\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-40\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-41\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-42\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_int_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-44\"><span class=\"crayon-h\">                                          </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-45\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f2802372313-46\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f2802372313-47\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0122 seconds] -->\r\n\n</div>\n<div id=\"cnblogs_code_open_1dd03bd5-67d5-4de8-872a-154452620c47\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1f8417151979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass InitValueHandler(tornado.web.RequestHandler):\r\n\r\n            def get(self, *args, **kwargs):\r\n                form = InitValueForm(self)\r\n\r\n                init_dict = {\r\n                    'username': 'seven',\r\n                    'age': 18,\r\n                    'city': 2,\r\n                    'gender': 2,\r\n                    'protocol': 1,\r\n                    'favor_int_val': [1, 3],\r\n                    'favor_str_val': ['1', '3'],\r\n                    'select_int_val': [1, 3],\r\n                    'select_str_val': ['1', '3']\r\n\r\n                }\r\n\r\n                # 初始化操作，设置Form类中默认值以及默认选项\r\n                form.init_field_value(init_dict)\r\n\r\n                self.render('init_value.html', form=form)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1f8417151979-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1f8417151979-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InitValueHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tornado</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">web</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RequestHandler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InitValueForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-6\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">init_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-7\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'username'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'seven'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-8\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-9\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'city'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-10\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'gender'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-11\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-12\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'favor_int_val'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-13\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'favor_str_val'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-14\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'select_int_val'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-15\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">'select_str_val'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-16\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-18\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-p\"># 初始化操作，设置Form类中默认值以及默认选项</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init_field_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">init_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1f8417151979-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1f8417151979-22\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'init_value.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n\n</div>\n<p>动态初始值 – 处理请求的Handler（Tornado）</p>\n<h2><strong>9、更多示例</strong></h2>\n<p>示例源码下载：<a href=\"http://files.cnblogs.com/files/wupeiqi/Tyrion%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81.zip\" target=\"_blank\">猛击这里</a></p>\n<p>a. 基本使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e1fc829558742\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RegisterForm(Form):\r\n        username = StringField(max_length=32,\r\n                               min_length=6,\r\n                               error={'required': '用户名不能为空',\r\n                                      'min_length': '用户名不能少于6位',\r\n                                      'max_length': '用户名不能超过32位'})\r\n \r\n        password = StringField(max_length=32,\r\n                               min_length=6,\r\n                               error={'required': '密码不能为空'},\r\n                               widget=InputPassword())\r\n \r\n        gender = IntegerField(error={'required': '请选择性别',\r\n                                     'invalid': '性别必须为数字'},\r\n                              widget=InputRadio(text_value_list=[{'value': 1, 'text': '男', },\r\n                                                                 {'value': 2, 'text': '女', }],\r\n                                                checked_value=2))\r\n \r\n        age = IntegerField(max_value=500,\r\n                           min_value=0,\r\n                           error={'required': '年龄不能为空',\r\n                                  'invalid': '年龄必须为数字',\r\n                                  'min_value': '年龄不能小于0',\r\n                                  'max_value': '年龄不能大于500'})\r\n \r\n        email = EmailField(error={'required': '邮箱不能为空',\r\n                                  'invalid': '邮箱格式错误'})\r\n \r\n        city = IntegerField(error={'required': '城市选项不能为空', 'invalid': '城市选项必须为数字'},\r\n                            widget=SingleSelect(text_value_list=[{'value': 1, 'text': '上海'},\r\n                                                                 {'value': 2, 'text': '北京'},\r\n                                                                 {'value': 3, 'text': '广州'}])\r\n                            )\r\n        protocol = IntegerField(error={'required': '请选择协议', 'invalid': '协议格式错误'},\r\n                                widget=InputSingleCheckBox(attr={'value': 1}))\r\n \r\n        memo = StringField(required=False,\r\n                           max_length=150,\r\n                           error={'invalid': '备注格式错误', 'max_length': '备注最大长度为150字'},\r\n                           widget=TextArea())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e1fc829558742-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e1fc829558742-40\">40</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RegisterForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-3\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">min_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-4\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能为空'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-5\"><span class=\"crayon-h\">                                      </span><span class=\"crayon-s\">'min_length'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能少于6位'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-6\"><span class=\"crayon-h\">                                      </span><span class=\"crayon-s\">'max_length'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'用户名不能超过32位'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-9\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">min_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-10\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'密码不能为空'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-11\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputPassword</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-12\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">gender</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择性别'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-14\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'性别必须为数字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-15\"><span class=\"crayon-h\">                              </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputRadio</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'男'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-16\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'女'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-17\"><span class=\"crayon-h\">                                                </span><span class=\"crayon-v\">checked_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-18\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-20\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">min_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-21\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能为空'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-22\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄必须为数字'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-23\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'min_value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能小于0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-24\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'max_value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能大于500'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-25\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EmailField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱不能为空'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-27\"><span class=\"crayon-h\">                                  </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'邮箱格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-28\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'城市选项不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'城市选项必须为数字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-30\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">SingleSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'上海'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-31\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'北京'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-32\"><span class=\"crayon-h\">                                                                 </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'广州'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-33\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择协议'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'协议格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-35\"><span class=\"crayon-h\">                                </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputSingleCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attr</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-36\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">memo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">required</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-38\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">150</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e1fc829558742-39\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'备注格式错误'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'max_length'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'备注最大长度为150字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e1fc829558742-40\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">TextArea</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p>b. 多选checkbox</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e201339399475\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass MultiCheckBoxForm(Form):\r\n         favor_str_val = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                         widget=InputMultiCheckBox(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                                    {'value': '2', 'text': '足球', },\r\n                                                                                    {'value': '3', 'text': '乒乓球', },\r\n                                                                                    {'value': '4', 'text': '羽毛球'}, ]))\r\n \r\n         favor_str_val_default = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                                 widget=InputMultiCheckBox(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                                            {'value': '2', 'text': '足球', },\r\n                                                                                            {'value': '3', 'text': '乒乓球', },\r\n                                                                                            {'value': '4', 'text': '羽毛球'}, ],\r\n                                                                           checked_value_list=['1', '4']))\r\n \r\n         favor_int_val = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                          widget=InputMultiCheckBox(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                                     {'value': 2, 'text': '足球', },\r\n                                                                                     {'value': 3, 'text': '乒乓球', },\r\n                                                                                     {'value': 4, 'text': '羽毛球'}, ]))\r\n \r\n         favor_int_val_default = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                                  widget=InputMultiCheckBox(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                                             {'value': 2, 'text': '足球', },\r\n                                                                                             {'value': 3, 'text': '乒乓球', },\r\n                                                                                             {'value': 4, 'text': '羽毛球'}, ],\r\n                                                                            checked_value_list=[2, ]))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e201339399475-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e201339399475-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MultiCheckBoxForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">favor_str_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-3\"><span class=\"crayon-h\">                                         </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-4\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-5\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-6\"><span class=\"crayon-h\">                                                                                    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">favor_str_val_default</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-9\"><span class=\"crayon-h\">                                                 </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-10\"><span class=\"crayon-h\">                                                                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-11\"><span class=\"crayon-h\">                                                                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-12\"><span class=\"crayon-h\">                                                                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-13\"><span class=\"crayon-h\">                                                                           </span><span class=\"crayon-v\">checked_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-14\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">favor_int_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-16\"><span class=\"crayon-h\">                                          </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-17\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-18\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-19\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-21\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">favor_int_val_default</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-22\"><span class=\"crayon-h\">                                                  </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InputMultiCheckBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-23\"><span class=\"crayon-h\">                                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-24\"><span class=\"crayon-h\">                                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e201339399475-25\"><span class=\"crayon-h\">                                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e201339399475-26\"><span class=\"crayon-h\">                                                                            </span><span class=\"crayon-v\">checked_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0082 seconds] -->\r\n<p>c、多选select</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e206991804404\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass MultiSelectForm(Form):\r\n        select_str_val = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                         widget=MultiSelect(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                             {'value': '2', 'text': '足球', },\r\n                                                                             {'value': '3', 'text': '乒乓球', },\r\n                                                                             {'value': '4', 'text': '羽毛球'}, ]))\r\n \r\n        select_str_val_default = StringListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                                 widget=MultiSelect(text_value_list=[{'value': '1', 'text': '篮球', },\r\n                                                                                     {'value': '2', 'text': '足球', },\r\n                                                                                     {'value': '3', 'text': '乒乓球', },\r\n                                                                                     {'value': '4', 'text': '羽毛球'}, ],\r\n                                                                    selected_value_list=['1', '3']))\r\n \r\n        select_int_val = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                          widget=MultiSelect(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                              {'value': 2, 'text': '足球', },\r\n                                                                              {'value': 3, 'text': '乒乓球', },\r\n                                                                              {'value': 4, 'text': '羽毛球'}, ]))\r\n \r\n        select_int_val_default = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                                  widget=MultiSelect(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                                      {'value': 2, 'text': '足球', },\r\n                                                                                      {'value': 3, 'text': '乒乓球', },\r\n                                                                                      {'value': 4, 'text': '羽毛球'}, ],\r\n                                                                     selected_value_list=[2]))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e206991804404-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e206991804404-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MultiSelectForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_str_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-3\"><span class=\"crayon-h\">                                         </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-4\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-5\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-6\"><span class=\"crayon-h\">                                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_str_val_default</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-9\"><span class=\"crayon-h\">                                                 </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-10\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-11\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-12\"><span class=\"crayon-h\">                                                                                     </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-13\"><span class=\"crayon-h\">                                                                    </span><span class=\"crayon-v\">selected_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-14\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_int_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-16\"><span class=\"crayon-h\">                                          </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-17\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-18\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-19\"><span class=\"crayon-h\">                                                                              </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">select_int_val_default</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-22\"><span class=\"crayon-h\">                                                  </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-23\"><span class=\"crayon-h\">                                                                                      </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-24\"><span class=\"crayon-h\">                                                                                      </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e206991804404-25\"><span class=\"crayon-h\">                                                                                      </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e206991804404-26\"><span class=\"crayon-h\">                                                                     </span><span class=\"crayon-v\">selected_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0081 seconds] -->\r\n<p>d. 动态select选项</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f91e20b403920174\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DynamicSelectForm(Form):\r\n    city = IntegerField(error={'required': '年龄不能为空', 'invalid': '年龄必须为数字'},\r\n                        widget=SingleSelect(text_value_list=[{'value': 1, 'text': '上海'},\r\n                                                             {'value': 2, 'text': '北京'},\r\n                                                             {'value': 3, 'text': '广州'}])\r\n                        )\r\n \r\n    multi_favor = IntegerListField(error={'required': '请选择爱好', 'invalid': '选择爱好格式错误'},\r\n                                   widget=MultiSelect(text_value_list=[{'value': 1, 'text': '篮球', },\r\n                                                                       {'value': 2, 'text': '足球', },\r\n                                                                       {'value': 3, 'text': '乒乓球', },\r\n                                                                       {'value': 4, 'text': '羽毛球'}, ]))\r\n \r\n    def __init__(self, *args, **kwargs):\r\n        super(DynamicSelectForm, self).__init__(*args, **kwargs)\r\n \r\n        # 获取数据库中的最新数据并显示在页面上（每次创建对象都执行一次数据库操作来获取最新数据）\r\n        self.city.widget.text_value_list = [{'value': 1, 'text': '上海'},\r\n                                            {'value': 2, 'text': '北京'},\r\n                                            {'value': 3, 'text': '南京'},\r\n                                            {'value': 4, 'text': '广州'}]\r\n \r\n        self.multi_favor.widget.text_value_list = [{'value': 1, 'text': '篮球'},\r\n                                                   {'value': 2, 'text': '足球'},\r\n                                                   {'value': 3, 'text': '乒乓球'},\r\n                                                   {'value': 4, 'text': '羽毛球'},\r\n                                                   {'value': 5, 'text': '玻璃球'}]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f91e20b403920174-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f91e20b403920174-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DynamicSelectForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄不能为空'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'年龄必须为数字'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-3\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">SingleSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'上海'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-4\"><span class=\"crayon-h\">                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'北京'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-5\"><span class=\"crayon-h\">                                                             </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'广州'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-6\"><span class=\"crayon-h\">                        </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">multi_favor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IntegerListField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'required'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'请选择爱好'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'invalid'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'选择爱好格式错误'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-9\"><span class=\"crayon-h\">                                   </span><span class=\"crayon-v\">widget</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">MultiSelect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-10\"><span class=\"crayon-h\">                                                                       </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-11\"><span class=\"crayon-h\">                                                                       </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-12\"><span class=\"crayon-h\">                                                                       </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-13\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">DynamicSelectForm</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># 获取数据库中的最新数据并显示在页面上（每次创建对象都执行一次数据库操作来获取最新数据）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">city</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">widget</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'上海'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-19\"><span class=\"crayon-h\">                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'北京'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-20\"><span class=\"crayon-h\">                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'南京'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-21\"><span class=\"crayon-h\">                                            </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'广州'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-22\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">multi_favor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">widget</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text_value_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'篮球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-24\"><span class=\"crayon-h\">                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'足球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-25\"><span class=\"crayon-h\">                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'乒乓球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f91e20b403920174-26\"><span class=\"crayon-h\">                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'羽毛球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d71f91e20b403920174-27\"><span class=\"crayon-h\">                                                   </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'玻璃球'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0082 seconds] -->\r\n<p></p>\n<h1>写在最后</h1>\n<p>开源组件持续更新中，如您在使用过程中遇到任何问题，请留言，我将尽快回复！！！</p>\n<ul>\n<li>Tyrion技术交流QQ群：564068039</li>\n<li>Tyrion技术交流QQ群：564068039</li>\n<li>Tyrion技术交流QQ群：564068039</li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88252\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88252votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88252\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "工具与框架,表单验证",
    "article_url": "http://python.jobbole.com/88252/",
    "url_object_id": "fbaf6660327addd60c9399a1da7540f5",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"
    ]
}
{
    "title": "Python: 受限制的 \"函数调用\"",
    "create_date": "2017/08/07",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000009878322\">Lin_R</a>   </div><h1>需求背景</h1>\n<p>最近在工作上, 遇到了一个比较特殊的需求:</p>\n<p><strong><span style=\"color: #ff0000\"> 为了安全, 设计一个函数或者装饰器, 然后用户在 “定义/调用” 函数时, 只能访问到我们允许的内置变量和全局变量。</span></strong></p>\n<p>通过例子来这解释下上面的需求:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f35fe465430393\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\na = 123\r\ndef func():\r\n    print  a\r\n    print id(a)\r\n\r\nfunc()   \r\n\r\n# 输出\r\n123\r\n32081168</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f35fe465430393-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f35fe465430393-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f35fe465430393-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f35fe465430393-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f35fe465430393-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f35fe465430393-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f35fe465430393-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f35fe465430393-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f35fe465430393-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f35fe465430393-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f35fe465430393-1\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f35fe465430393-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f35fe465430393-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f35fe465430393-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f35fe465430393-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f35fe465430393-6\"><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f35fe465430393-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f35fe465430393-8\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f35fe465430393-9\"><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f35fe465430393-10\"><span class=\"crayon-cn\">32081168</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>函数功能简单明了, 对于结果, 大家应该也不会有太大的异议:<span style=\"color: #ff0000\"><strong>func</strong></span>分别是取得<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>中a的值和使用<span style=\"color: #ff0000\"><strong>内置命名空间</strong></span>中的函数<strong><span style=\"color: #ff0000\">id</span></strong>获取了a的地址. 熟悉Python的童鞋, 对于<strong><span style=\"color: #ff0000\">LEGB</span></strong>肯定也是不陌生的,也正是因为<strong><span style=\"color: #ff0000\">LEGB</span></strong>才让函数<strong><span style=\"color: #ff0000\">func</span></strong>输出正确的结果. 但是这个只是一个常规例子, 只是用来抛砖引玉而已. 我们真正想要讨论的是下面的例子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f360d966930588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 装饰函数\r\ndef wrap(f):\r\n    # 调用用户传入的函数\r\n    f()\r\n\r\na = 123\r\n\r\n# 用户自定义函数\r\ndef func():\r\n    import os\r\n    print os.listdir('.')\r\n\r\nwrap(func)\r\n# 输出\r\n['1.yml', '2.py', '2.txt', '2.yml', 'ftp', 'ftp.rar', 'test', 'tmp', '__init__.py']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f360d966930588-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f360d966930588-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-1\"><span class=\"crayon-c\"># 装饰函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 调用用户传入的函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-6\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-8\"><span class=\"crayon-c\"># 用户自定义函数</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-9\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-12\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-13\"><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f360d966930588-14\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f360d966930588-15\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'1.yml'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2.yml'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ftp'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ftp.rar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tmp'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__init__.py'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h1>潜在危险因素</h1>\n<p>在上面的例子可以看出, 如果在<strong><span style=\"color: #ff0000\">func</span></strong>中, 引入别的模块, 然后再执行模块中的方法, 也是可行的! 而且这还是一个非常方便的功能! 但是除了方便, 更多的是一种潜在的危险.在日常使用, 或许我们不会考虑这些, 但是如果在<strong><span style=\"color: #ff0000\">模块</span></strong>与<strong><span style=\"color: #ff0000\">模块</span></strong>之间的协同作用时, 特别是多人参与的情况下, 这种危险的因素, 就不得不让我们认真对待!</p>\n<p>或许有很多同学会觉得这些担忧是过多的, 是没必要的, 但是请思考一种场景: 我们有个主模块, 暂时称为<strong><span style=\"color: #ff0000\">main.py</span></strong>, 它允许用户动态加载模块, 也就是说只要用户将对应的模块放到对应的目录, 然后利用消息机制去通知<strong><span style=\"color: #ff0000\">main.py</span></strong>, 告诉它应该加载新模块了, 并且执行<strong><span style=\"color: #ff0000\">新模块里面的b函数,</span></strong> 那在这种情况下, <strong><span style=\"color: #ff0000\">main.py</span></strong>肯定不能直接傻傻的就去执行, 因为我们不能相信每个用户都是诚实善良的, 也不能相信每个用户编写的模块或者函数是符合我们的<strong><span style=\"color: #ff0000\">行为标准规范</span></strong>. 所以我们得有些措施去防范这些事情, 我们能做的大概也就下面几种方式:</p>\n<ol>\n<li>在用户通知<code>main.py</code>时有新模块加入并且要求执行函数时, 先对模块的代码做检查, 不符合标准或者带有危险代码的拒绝加载.</li>\n<li>控制好<span style=\"color: #ff0000\"><strong><code>内置<span style=\"color: #ff0000\">命</span>名空间</code></strong></span>和<strong><span style=\"color: #ff0000\"><code>全局命名空间</code></span></strong>, 使其只能用允许使用的内容</li>\n</ol>\n<p>在方案1, 其实也是我们最容易想到的方法, 但是这个方法的成本还是比较高, 因为我们需要将可能出现的错误代码或者关键词,全部写成一套规则, 而且这套规则还很大可能会误伤, 不过也可能业界已经有类似的成熟的方案, 只是我还没接触到而已.</p>\n<p>所以我们只能用方案2的方法, 这种方法在我们看来, 是成本比较低的, 也比较容易控制的, 因为这就和防火墙一样, 我们只放行我们允许的事物.</p>\n<h1>具体实现</h1>\n<p>实现方案2最大的问题就是, 如何控制<strong><span style=\"color: #ff0000\">内置命名空间 </span></strong>和<strong><span style=\"color: #ff0000\">全局命名空间</span></strong><br>\n我们第一个想法肯定就是覆盖它们, 因为我们都知道不管是<strong><span style=\"color: #ff0000\">内置命名空间</span></strong>还是<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>, 都是通过字典的形式在维护:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3617245426605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint globals()\r\nprint globals()['__builtins__'].__dict__\r\n\r\n# 输出\r\n# 全局命名空间\r\n{'__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__name__': '__main__', '__file__': 'D:/Python_project/ftp/2.py', '__doc__': None, '__package__': None}\r\n\r\n#内置命名空间\r\n{'bytearray': &lt;type 'bytearray'&gt;, 'IndexError': &lt;type 'excep.....(省略过多部分)..}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3617245426605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3617245426605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3617245426605-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3617245426605-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3617245426605-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3617245426605-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3617245426605-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3617245426605-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3617245426605-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3617245426605-1\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3617245426605-2\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3617245426605-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3617245426605-4\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3617245426605-5\"><span class=\"crayon-c\"># 全局命名空间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3617245426605-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/Python_project/ftp/2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3617245426605-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3617245426605-8\"><span class=\"crayon-c\">#内置命名空间</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3617245426605-9\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'bytearray'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytearray'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IndexError'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span>'<span class=\"crayon-v\">excep</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span>省略过多部分<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>注: <strong><span style=\"color: #ff0000\">globals函数 </span></strong>是用来打印当前<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>的函数, 同样, 也能通过修改这个函数返回的字典对应的key, 实现<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>的修改.例如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f361e385126727\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = globals()\r\nprint s\r\ns['a'] = 3\r\nprint s\r\nprint a\r\n\r\n# 输出\r\n{'__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__file__': 'D:/Python_project/ftp/2.py', '__package__': None, 's': {...}, '__name__': '__main__', '__doc__': None}\r\n{'a': 3, '__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__file__': 'D:/Python_project/ftp/2.py', '__package__': None, 's': {...}, '__name__': '__main__', '__doc__': None}\r\n3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f361e385126727-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f361e385126727-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f361e385126727-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f361e385126727-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f361e385126727-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f361e385126727-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f361e385126727-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f361e385126727-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f361e385126727-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f361e385126727-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f361e385126727-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f361e385126727-2\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f361e385126727-3\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f361e385126727-4\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">s</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f361e385126727-5\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f361e385126727-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f361e385126727-7\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f361e385126727-8\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/Python_project/ftp/2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f361e385126727-9\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/Python_project/ftp/2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f361e385126727-10\"><span class=\"crayon-cn\">3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>可以看出, 我们并没有定义<strong><span style=\"color: #ff0000\">变量a</span></strong>, 只是在globals的返回值上面增加了<strong><span style=\"color: #ff0000\">key-value</span></strong>, 就变相实现了我们定义的操作, 这其实也能用于很多希望能够动态赋值的需求场景! 比如说, 我不确定有多少个变量, 希望通过一个变量名列表, 动态生成这些变量, 在这种情况下, 就能参考这种方法, 不过还是希望谨慎使用, 因为修改了这个, 就是就修改了<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>.</p>\n<p>好了, 回归到本文, 我们已经知道通过<strong><span style=\"color: #ff0000\">globals函数</span></strong>能够代表全局命名空间, 但是为什么<strong><span style=\"color: #ff0000\">内置命名空间</span></strong>要用<strong><span style=\"color: #ff0000\">globals()[‘__builtins__’].__dict__</span></strong>来表示? 其实这个和python自身的机制有关, 因为模块在编译和初始化的过程中, <strong><span style=\"color: #ff0000\">内置命名空间</span></strong>就是以这种形式,寄放在<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3626055176084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic void\r\ninitmain(void)\r\n{\r\n    PyObject *m, *d;\r\n    m = PyImport_AddModule(\"__main__\");\r\n    if (m == NULL)\r\n        Py_FatalError(\"can't create __main__ module\");\r\n    d = PyModule_GetDict(m);\r\n    if (PyDict_GetItemString(d, \"__builtins__\") == NULL) {\r\n        PyObject *bimod = PyImport_ImportModule(\"__builtin__\");\r\n        if (bimod == NULL ||\r\n            PyDict_SetItemString(d, \"__builtins__\", bimod) != 0)\r\n            Py_FatalError(\"can't add __builtins__ to __main__\");\r\n        Py_XDECREF(bimod);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3626055176084-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3626055176084-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-1\"><span class=\"crayon-e\">static </span><span class=\"crayon-e\">void</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-2\"><span class=\"crayon-e\">initmain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">void</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyImport_AddModule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Py_FatalError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"can't create __main__ module\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyModule_GetDict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PyDict_GetItemString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__builtins__\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">bimod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyImport_ImportModule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"__builtin__\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bimod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">PyDict_SetItemString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__builtins__\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bimod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Py_FatalError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"can't add __builtins__ to __main__\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Py_XDECREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bimod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3626055176084-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3626055176084-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>从上面代码可以看出, 在初始化<strong><span style=\"color: #ff0000\">__main__</span></strong>时, 会有一个获取<strong><span style=\"color: #ff0000\">__builtins__</span></strong>的动作, 如果这个结果是<strong><span style=\"color: #ff0000\">NULL</span></strong>, 那么就会用之前初始化好的<strong><span style=\"color: #ff0000\">__builtin__</span></strong>去存进去, 这些代码具体可以看<strong><span style=\"color: #ff0000\">Pythonrun.c</span></strong>, 在这不详细展开了.</p>\n<p>既然<strong><span style=\"color: #ff0000\">内置命名空间(__builtins__)</span></strong>和<strong><span style=\"color: #ff0000\">全局命名空间(globals())</span></strong>都已经找到对应对象了, 那我们下一步就应该是想法将这两个空间替换成我们想要的.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f362c416815284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# coding: utf8\r\n# 修改全局命名空间\r\ntest_var = 123  # 测试变量\r\n\r\ntmp = globals().keys()\r\nprint globals()\r\nprint test_var\r\nfor i in tmp:\r\n    del globals()[i]\r\nprint globals()\r\nprint test_var\r\nprint id(2)\r\n\r\n# 输出\r\n\r\n{'tmp': ['__builtins__', '__file__', '__package__', 'test_var', '__name__', '__doc__'], '__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__file__': 'D:/Python_project/ftp/2.py', '__package__': None, 'test_var': 123, '__name__': '__main__', '__doc__': None}\r\n123\r\n{'tmp': ['__builtins__', '__file__', '__package__', 'test_var', '__name__', '__doc__'], 'i': '__doc__'}\r\nTraceback (most recent call last):\r\n  File \"D:/Python_project/ftp/2.py\", line 10, in &lt;module&gt;\r\n    print test_var\r\nNameError: name 'test_var' is not defined</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f362c416815284-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f362c416815284-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-1\"><span class=\"crayon-c\"># coding: utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-2\"><span class=\"crayon-c\"># 修改全局命名空间</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-3\"><span class=\"crayon-v\">test_var</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 测试变量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-5\"><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">keys</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-6\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-7\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test_var</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">del</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-10\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-11\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test_var</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-12\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-14\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-16\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'tmp'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test_var'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/Python_project/ftp/2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test_var'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-17\"><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-18\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'tmp'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test_var'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'i'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-19\"><span class=\"crayon-k \">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"D:/Python_project/ftp/2.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f362c416815284-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test_var</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f362c416815284-22\"><span class=\"crayon-k \">NameError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test_var'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">defined</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>在上面的输出可以看到, 在删除前后, 通过<strong><span style=\"color: #ff0000\">print globals()</span></strong>可以看到全局命名空间确实已经被修改了, 因为<strong><span style=\"color: #ff0000\">test_var</span></strong>已经无法打印了, 触发了<strong><span style=\"color: #ff0000\">NameError</span></strong>, 这样的话, 就有办法能够限制全局命令空间了:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3630535909427\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 伪代码\r\n\r\n# 装饰函数\r\ndef wrap(f):\r\n    # 调用用户传入的函数\r\n    .... 修改全局命名空间\r\n    f()\r\n    .... 还原全局命名空间\r\n\r\na = 123\r\n\r\n# 用户自定义函数\r\ndef func():\r\n    import os\r\n    print os.listdir('.')\r\n\r\nwrap(func)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3630535909427-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3630535909427-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-1\"><span class=\"crayon-c\"># 伪代码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-3\"><span class=\"crayon-c\"># 装饰函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 调用用户传入的函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span>修改全局命名空间</div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span>还原全局命名空间</div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-10\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-12\"><span class=\"crayon-c\"># 用户自定义函数</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-13\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3630535909427-16\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3630535909427-17\"><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>为什么我只写伪代码, 因为我发现这个功能实现起来是非常蛋疼! 原因就是, 在实现之前, 我们必须要解决几个问题:</p>\n<ol>\n<li>全局命名空间对应了一个字典, 所以如果我们想要修改, 只能从修改这个字典本身, 于是先清空再定义成我们约束的, 调用完之后, 又得反过来恢复, 这些操作是十分之蛋疼.</li>\n<li>涉及到共享的问题, 如果这个用户函数处理很久, 而且是多线程的, 那么整个模块都会变得很不稳定, 甚至称为”污染”</li>\n</ol>\n<p>那就先撇开不讲, 讲讲<span style=\"color: #ff0000\"><strong>内置命名空间</strong></span>, 刚才我们已经找到了能代表<span style=\"color: #ff0000\"><strong>内置命名空间</strong></span>的对象, 很幸运的是, 这个是”真的能够摸得到”的, 那我们试下直接就赋值个空字典, 看会怎样:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3634739108744\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = globals()\r\nprint s['__builtins__']  # __builtins__检查是否存在\r\ns['__builtins__'] = {}\r\nprint s['__builtins__']  # __builtins__检查是否存在\r\nprint id(3)              # 试下内置函数能否使用\r\nprint globals()\r\n\r\n# 输出\r\n&lt;module '__builtin__' (built-in)&gt;\r\n{}\r\n32602360\r\n{'__builtins__': {}, '__file__': 'D:/Python_project/ftp/2.py', '__package__': None, 's': {...}, '__name__': '__main__', '__doc__': None}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3634739108744-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3634739108744-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-2\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># __builtins__检查是否存在</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-3\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-4\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># __builtins__检查是否存在</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-5\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\"># 试下内置函数能否使用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-6\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-8\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-10\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3634739108744-11\"><span class=\"crayon-cn\">32602360</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3634739108744-12\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__file__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/Python_project/ftp/2.py'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>结果有点尴尬, 似乎没啥用, 但是其实这个<strong><span style=\"color: #ff0000\">__builtins__</span></strong>只是一个表现, 真正的<strong><span style=\"color: #ff0000\">内置命名空间</span></strong>是在它所指向的字典对象, 也就是: <strong><span style=\"color: #ff0000\">globals()[‘__builtins__’].__dict__!</span></strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3638018824349\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint globals()['__builtins__'].__dict__\r\n\r\n# 输出\r\n{'bytearray': &lt;type 'bytearray'&gt;, 'IndexError': &lt;type 'exceptions.IndexError'&gt;....} # 省略</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3638018824349-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3638018824349-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3638018824349-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3638018824349-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3638018824349-1\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3638018824349-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3638018824349-3\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3638018824349-4\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'bytearray'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytearray'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IndexError'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'exceptions.IndexError'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 省略</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>所以我们真正要覆盖的, 是这个字典才对, 所以上面的代码要改成:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f363e809092600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = globals()\r\ns['__builtins__'].__dict__ = {}   # 覆盖真正的内置命名空间\r\nprint s['__builtins__'].__dict__  # __builtins__检查是否存在\r\n\r\n# 输出\r\nTraceback (most recent call last):\r\n  File \"D:/Python_project/ftp/2.py\", line 3, in &lt;module&gt;\r\n    s['__builtins__'].__dict__ = {}\r\nTypeError: readonly attribute</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f363e809092600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f363e809092600-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f363e809092600-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f363e809092600-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f363e809092600-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f363e809092600-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f363e809092600-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f363e809092600-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f363e809092600-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f363e809092600-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f363e809092600-2\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 覆盖真正的内置命名空间</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f363e809092600-3\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># __builtins__检查是否存在</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f363e809092600-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f363e809092600-5\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f363e809092600-6\"><span class=\"crayon-k \">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f363e809092600-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"D:/Python_project/ftp/2.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f363e809092600-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f363e809092600-9\"><span class=\"crayon-k \">TypeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readonly </span><span class=\"crayon-v\">attribute</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>失败了…原来这个内置命名空间是只读的, 所以我们上面的方法都失败了..那难道真的没法解决了吗? 一般这样问, 通常都有解决方案滴~</p>\n<h1>完美方案</h1>\n<p>这个解决方法, 需要一个库的帮忙~, 那就是inspect库, 这个库是干嘛呢? 简单来说就是用来自省. 它提供四种用处:</p>\n<ol>\n<li>对是否是模块，框架，函数等进行类型检查。</li>\n<li>获取源码</li>\n<li>获取类或函数的参数的信息</li>\n<li>解析堆栈</li>\n</ol>\n<p>在这里, 我们需要用到第二个功能, 其余的功能, 感兴趣的童鞋可以去谷歌学习哦, 也可以参考: <a href=\"https://my.oschina.net/taisha/blog/55597\">https://my.oschina.net/taisha…</a></p>\n<p>除了<span style=\"color: #ff0000\"><strong>inspect</strong></span>, 我们还需要用到<strong><span style=\"color: #ff0000\">exec</span></strong>, 这也是一大杀器, 可以先参考这个学习下: <a href=\"http://www.mojidong.com/python/2013/05/10/python-exec-eval/\">http://www.mojidong.com/pytho…</a></p>\n<p>方法大致的过程就是以下几步:</p>\n<ol>\n<li>根据用户传入的func对象, 利用inspect取出对应的源码</li>\n<li>通过exec利用源码并且传入全局命名空间, 重新编译</li>\n</ol>\n<p>代码:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a69f3646600290861\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# coding: utf8\r\nimport inspect\r\n\r\n# 装饰函数\r\ndef wrap(f):\r\n    # 调用用户传入的函数\r\n    source = inspect.getsource(f)   # 获取源码\r\n    exec('%s \\n%s()' % (source,  f.func_name), {'a': 'this is inspect', '__builtins__': {}})  # 重新编译, 并且重新构造全局命名空间\r\n\r\n\r\na = 123\r\n\r\n# 用户自定义函数\r\ndef func():\r\n    print a\r\n    import os\r\n    print os.listdir('.')\r\n\r\nwrap(func)\r\n\r\n# 输出\r\nthis is inspect\r\nTraceback (most recent call last):\r\n  File \"D:/Python_project/ftp/2.py\", line 19, in &lt;module&gt;\r\n    wrap(func)\r\n  File \"D:/Python_project/ftp/2.py\", line 8, in wrap\r\n    exec('%s \\nfunc()' % source, {'a': 'this is inspect', '__builtins__': {}})\r\n  File \"&lt;string&gt;\", line 6, in &lt;module&gt;\r\n  File \"&lt;string&gt;\", line 3, in func\r\nImportError: __import__ not found</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d7a69f3646600290861-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a69f3646600290861-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-1\"><span class=\"crayon-c\"># coding: utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">inspect</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-4\"><span class=\"crayon-c\"># 装饰函数</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 调用用户传入的函数</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">inspect</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getsource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 获取源码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%s \\n%s()'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'this is inspect'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 重新编译, 并且重新构造全局命名空间</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-10\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-11\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-12\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-13\"><span class=\"crayon-c\"># 用户自定义函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-14\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-18\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-19\"><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-20\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-21\"><span class=\"crayon-c\"># 输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-22\"><span class=\"crayon-e\">this </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">inspect</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-23\"><span class=\"crayon-k \">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"D:/Python_project/ftp/2.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">wrap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-26\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"D:/Python_project/ftp/2.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrap</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-27\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%s \\nfunc()'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'this is inspect'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-28\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;string&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a69f3646600290861-29\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;string&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a69f3646600290861-30\"><span class=\"crayon-k \">ImportError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">__import__</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p>虽然上面报错了, 但那不就我们求之不得结果吗? 我们可以正确的输出a的值<strong><span style=\"color: #ff0000\">this is inspe</span></strong>, 而且当<strong><span style=\"color: #ff0000\">func</span></strong>想<strong><span style=\"color: #ff0000\">import</span></strong>时, 直接报错! 这样就能满足我们的<strong><span style=\"color: #ff0000\">变态欲望</span></strong>了~ 嘿嘿!,</p>\n<p>关于代码运行原理, 其实在关键部位的代码, 都已经加了注释, 可能在exec那部分会比较迷惑, 但其实大家将对应的变量代入字符串就能懂了, 替换之后, 其实也就是<strong><span style=\"color: #ff0000\">函数的定义+执行</span></strong>, 可以通过<strong><span style=\"color: #ff0000\">print ‘%s \\n%s()’ % (source, f.func_name)</span></strong>帮助理解.而后面的字典, 也就是我们一直很纠结的<strong><span style=\"color: #ff0000\">全局命名空间</span></strong>, 其中<strong><span style=\"color: #ff0000\">内置命名空间</span></strong>也被人为定义了, 所以能够达到我们想要的效果了!</p>\n<p>这种只是一种抛砖引玉, 让有类似场景需求的童鞋, 有个参考的方向, 也欢迎分享你们实现的方案, 嘿嘿!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88286\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88286votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88286\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,限制",
    "article_url": "http://python.jobbole.com/88286/",
    "url_object_id": "9d708520674f6d9249ab65136457803d",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e6345801.png"
    ]
}
{
    "title": "深入理解 Python 异步编程(上)",
    "create_date": "2017/08/08",
    "agree_num": 1,
    "comment_num": 3,
    "fav_num": 7,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMjY5NTE0MA==&amp;mid=2247483720&amp;idx=1&amp;sn=f016c06ddd17765fd50b705fed64429c\">阿驹</a>   </div><h1>前言</h1>\n<p>很多朋友对异步编程都处于“听说很强大”的认知状态。鲜有在生产项目中使用它。而使用它的同学，则大多数都停留在知道如何使用 Tornado、Twisted、Gevent 这类异步框架上，出现各种古怪的问题难以解决。而且使用了异步框架的部分同学，由于用法不对，感觉它并没牛逼到哪里去，所以很多同学做 Web 后端服务时还是采用 Flask、Django等传统的非异步框架。</p>\n<p>从上两届 PyCon 技术大会看来，异步编程已经成了 Python 生态下一阶段的主旋律。如新兴的 Go、Rust、Elixir 等编程语言都将其支持异步和高并发作为主要“卖点”，技术变化趋势如此。Python 生态为不落人后，从2013年起由 Python 之父 Guido 亲自操刀主持了Tulip(asyncio)项目的开发。</p>\n<p>本系列教程分为上中下篇，让读者深入理解Python异步编程，解决在使用异步编程中的疑惑，深入学习Python3中新增的<strong><span style=\"color: #ff0000\">asyncio</span></strong>库和<span style=\"color: #ff0000\"><strong>async/await</strong></span>语法，尽情享受 Python 带来的简洁优雅和高效率。</p>\n<h2>内容安排</h2>\n<h3>上篇</h3>\n<ul>\n<li>了解 异步编程及其紧密相关的概念，如阻塞/非阻塞、同步/异步、并发/并行等</li>\n<li>理解 异步编程是什么，以及异步编程的困难之处</li>\n<li>理解 为什么需要异步编程</li>\n<li>熟悉 如何从同步阻塞发展到异步非阻塞的</li>\n<li>掌握<strong><span style=\"color: #ff0000\">epoll + Callback + Event loop</span></strong>是如何工作的</li>\n<li>掌握 Python 是如何逐步从回调到生成器再到原生协程以支持异步编程的</li>\n<li>掌握<strong><span style=\"color: #ff0000\"> asyncio</span></strong> 的工作原理</li>\n</ul>\n<h3>中篇</h3>\n<ul>\n<li>掌握 asyncio 标准库基本使用</li>\n<li>掌握 asyncio 的事件循环</li>\n<li>掌握 协程与任务如何使用与管理（如调度与取消调度）</li>\n<li>掌握 同步原语的使用(Lock、Event、Condition、Queue)</li>\n<li>掌握 asyncio 和多进程、多线程结合使用</li>\n</ul>\n<h3>下篇</h3>\n<ul>\n<li>理解 GIL 对异步编程的影响</li>\n<li>理解 asyncio 踩坑经验</li>\n<li>理解 回调、协程、绿程(Green-Thread)、线程对比总结</li>\n<li>掌握 多进程、多线程、协程各自的适用场景</li>\n<li>了解 Gevent/libev、uvloop/libuv 与asyncio的区别和联系</li>\n<li>掌握 Python异步编程的一些指导细则</li>\n</ul>\n<h1>1 什么是异步编程</h1>\n<p>通过学习相关概念，我们逐步解释异步编程是什么。</p>\n<h2>1.1 阻塞</h2>\n<ul>\n<li>程序未得到所需计算资源时被挂起的状态。</li>\n<li><strong>程序在等待某个操作完成期间，自身无法继续干别的事情，则称该程序在该操作上是阻塞的。</strong></li>\n<li>常见的阻塞形式有：网络I/O阻塞、磁盘I/O阻塞、用户输入阻塞等。</li>\n</ul>\n<p>阻塞是无处不在的，包括CPU切换上下文时，所有的进程都无法真正干事情，它们也会被阻塞。（如果是多核CPU则正在执行上下文切换操作的核不可被利用。）</p>\n<h2>1.2 非阻塞</h2>\n<ul>\n<li><strong>程序在等待某操作过程中，自身不被阻塞，可以继续运行干别的事情，则称该程序在该操作上是非阻塞的。</strong></li>\n<li>非阻塞并<strong>不是</strong>在任何程序级别、任何情况下都可以存在的。</li>\n<li>仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。</li>\n</ul>\n<p>非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，我们才要把它变成非阻塞的。</p>\n<h2>1.3 同步</h2>\n<ul>\n<li>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以<strong>协调一致</strong>，称这些程序单元是同步执行的。</li>\n<li>例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。</li>\n<li>简言之，<strong>同步意味着有序</strong>。</li>\n</ul>\n<h2>1.4 异步</h2>\n<ul>\n<li>为完成某个任务，不同程序单元之间<strong>过程中无需通信协调</strong>，也能完成任务的方式。</li>\n<li>不相关的程序单元之间可以是异步的。</li>\n<li>例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。</li>\n<li>简言之，<strong>异步意味着无序</strong>。</li>\n</ul>\n<p>上文提到的“通信方式”通常是指异步和并发编程提供的同步原语，如信号量、锁、同步队列等等。我们需知道，虽然这些通信方式是为了让多个程序在一定条件下同步执行，但正因为是异步的存在，才需要这些通信方式。如果所有程序都是按序执行，其本身就是同步的，又何需这些同步信号呢？</p>\n<h2>1.5 并发</h2>\n<ul>\n<li>并发描述的是程序的组织结构。指程序要被设计成多个可独立执行的子任务。</li>\n<li><strong>以利用有限的计算机资源使多个任务可以被实时或近实时执行为目的。</strong></li>\n</ul>\n<h2>1.6 并行</h2>\n<ul>\n<li>并行描述的是程序的执行状态。指多个任务同时被执行。</li>\n<li><strong>以利用富余计算资源（多核CPU）加速完成多个任务为目的。</strong></li>\n</ul>\n<p>并发提供了一种程序组织结构方式，让问题的解决方案可以并行执行，但并行执行不是必须的。</p>\n<h2>1.7 概念总结</h2>\n<ul>\n<li><strong>并行</strong>是为了利用多核加速多任务完成的进度</li>\n<li><strong>并发</strong>是为了让独立的子任务都有机会被尽快执行，但不一定能加速整体进度</li>\n<li><strong>非阻塞</strong>是为了提高程序整体执行效率</li>\n<li><strong>异步</strong>是高效地组织非阻塞任务的方式</li>\n</ul>\n<p>要支持并发，必须拆分为多任务，不同任务相对而言才有阻塞/非阻塞、同步/异步。所以，并发、异步、非阻塞三个词总是如影随形。</p>\n<h2>1.8 异步编程</h2>\n<ul>\n<li><strong>以进程、线程、协程、函数/方法作为执行任务程序的基本单位，结合回调、事件循环、信号量等机制，以提高程序整体执行效率和并发能力的编程方式。</strong></li>\n</ul>\n<p>如果在某程序的运行时，能根据已经执行的指令准确判断它接下来要进行哪个具体操作，那它是同步程序，反之则为异步程序。（无序与有序的区别）</p>\n<p>同步/异步、阻塞/非阻塞并非水火不容，要看讨论的程序所处的封装级别。例如购物程序在处理多个用户的浏览请求可以是异步的，而更新库存时必须是同步的。</p>\n<h2>1.9 异步之难(nán)</h2>\n<ul>\n<li>控制不住“计几”写的程序，因为其执行顺序不可预料，<strong>当下正要发生什么事件不可预料</strong>。在并行情况下更为复杂和艰难。</li>\n</ul>\n<p>所以，几乎所有的异步框架都将异步编程模型<strong>简化</strong>：<strong>一次只允许处理一个事件</strong>。故而有关异步的讨论几乎都集中在了单线程内。</p>\n<ul>\n<li>如果某事件处理程序需要长时间执行，所有其他部分都会被阻塞。</li>\n</ul>\n<p>所以，<strong>一旦采取异步编程，每个异步调用必须“足够小”</strong>，不能耗时太久。如何拆分异步任务成了难题。</p>\n<ul>\n<li>程序下一步行为往往依赖上一步执行结果，如何知晓上次异步调用已完成并获取结果？</li>\n<li><strong>回调（Callback）</strong>成了必然选择。那又需要面临“回调地狱”的折磨。</li>\n<li>同步代码改为异步代码，必然破坏代码结构。</li>\n<li>解决问题的逻辑也要转变，不再是一条路走到黑，需要精心安排异步任务。</li>\n</ul>\n<h1>2 苦心异步为哪般</h1>\n<p>如上文所述，异步编程面临诸多难点，Python 之父亲自上阵打磨4年才使 asyncio 模块在Python 3.6中“转正”，如此苦心为什么？答案只有一个：它值得！下面我们看看为何而值得。</p>\n<h2>2.1 CPU的时间观</h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c4d9d606f774db64be492d4acd8c2cf1.png\"><img class=\"aligncenter wp-image-88292 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c4d9d606f774db64be492d4acd8c2cf1.png\" alt=\"01_cpu_time\" width=\"2044\" height=\"1530\"></a></p>\n<p>我们将一个 2.6GHz 的 CPU 拟人化，假设它执行一条命令的时间，他它感觉上过了一秒钟。CPU是计算机的处理核心，也是最宝贵的资源，如果有浪费CPU的运行时间，导致其利用率不足，那程序效率必然低下（因为实际上有资源可以使效率更高）。</p>\n<p>如上图所示，在千兆网上传输2KB数据，CPU感觉过了14个小时，如果是在10M的公网上呢？那效率会低百倍！如果在这么长的一段时间内，CPU只是傻等结果而不能去干其他事情，是不是在浪费CPU的青春？</p>\n<p>鲁迅说，浪费“CPU”的时间等于谋财害命。而凶手就是程序猿。</p>\n<h2>2.2 面临的问题</h2>\n<ul>\n<li><strong>成本问题</strong></li>\n</ul>\n<p>如果一个程序不能有效利用一台计算机资源，那必然需要更多的计算机通过运行更多的程序实例来弥补需求缺口。例如我前不久主导重写的项目，使用Python异步编程，改版后由原来的7台服务器削减至3台，成本骤降57%。一台AWS m4.xlarge 型通用服务器按需付费实例一年价格约 1.2 万人民币。</p>\n<ul>\n<li><strong>效率问题</strong></li>\n</ul>\n<p>如果不在乎钱的消耗，那也会在意效率问题。当服务器数量堆叠到一定规模后，如果不改进软件架构和实现，加机器是徒劳，而且运维成本会骤然增加。比如别人家的电商平台支持6000单/秒支付，而自家在下单量才支撑2000单/秒，在双十一这种活动的时候，钱送上门也赚不到。</p>\n<ul>\n<li><strong>C10k/C10M挑战</strong></li>\n</ul>\n<p>C10k（concurrently handling 10k connections）是一个在1999年被提出来的技术挑战，如何在一颗1GHz CPU，2G内存，1gbps网络环境下，让单台服务器同时为1万个客户端提供FTP服务。而到了2010年后，随着硬件技术的发展，这个问题被延伸为C10M，即如何利用8核心CPU，64G内存，在10gbps的网络上保持1000万并发连接，或是每秒钟处理100万的连接。（两种类型的计算机资源在各自的时代都约为1200美元）</p>\n<p>成本和效率问题是从企业经营角度讲，C10k/C10M问题则是从技术角度出发挑战软硬件极限。C10k/C10M 问题得解，成本问题和效率问题迎刃而解。</p>\n<h2>2.3 解决方案</h2>\n<p>《约束理论与企业优化》中指出：“<strong>除了瓶颈之外，任何改进都是幻觉。</strong>”</p>\n<p>CPU告诉我们，它自己很快，而上下文切换慢、内存读数据慢、磁盘寻址与取数据慢、网络传输慢……总之，离开CPU 后的一切，除了一级高速缓存，都很慢。我们观察计算机的组成可以知道，主要由运算器、控制器、存储器、输入设备、输出设备五部分组成。运算器和控制器主要集成在CPU中，除此之外全是I/O，包括读写内存、读写磁盘、读写网卡全都是I/O。<strong>I/O成了最大的瓶颈</strong>。</p>\n<p>异步程序可以提高效率，而最大的瓶颈在I/O，业界诞生的解决方案没出意料：<strong>异步I/O吧，异步I/O吧，异步I/O吧吧！</strong></p>\n<h1>3 异步I/O进化之路</h1>\n<p>如今，地球上最发达、规模最庞大的计算机程序，莫过于因特网。而从CPU的时间观中可知，<strong>网络I/O是最大的I/O瓶颈</strong>，除了宕机没有比它更慢的。所以，诸多异步框架都对准的是网络I/O。</p>\n<p>我们从一个爬虫例子说起，从因特网上下载10篇网页。</p>\n<h2>3.1 同步阻塞方式</h2>\n<p>最容易想到的解决方案就是依次下载，从建立socket连接到发送网络请求再到读取响应数据，顺序进行。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/df5c9b2ea851e5be0af26a201adcc33c.png\"><img class=\"aligncenter wp-image-88293 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/df5c9b2ea851e5be0af26a201adcc33c.png\" alt=\"02_blocking\" width=\"1320\" height=\"830\"></a></p>\n<p>注：总体耗时约为4.5秒。（因网络波动每次测试结果有所变动，本文取多次平均值）</p>\n<p>如上图所示，<strong><span style=\"color: #ff0000\">blocking_way()</span> </strong>的作用是建立<span style=\"color: #800000\"> socket </span>连接，发送HTTP请求，然后从<span style=\"color: #000000\"> socket</span> 读取HTTP响应并返回数据。示例中我们请求了 example.com 的首页。在<strong><span style=\"color: #ff0000\">sync_way()</span></strong> 执行了10次，即下载 example.com 首页10次。</p>\n<p>在示例代码中有两个关键点。一是第10行的<strong><span style=\"color: #ff0000\"> sock.connect((‘example.com’, 80))</span></strong>，该调用的作用是向<span style=\"color: #ff0000\"><strong>example.com</strong></span>主机的<strong><span style=\"color: #ff0000\">80</span></strong>端口发起网络连接请求。 二是第14行、第18行的<strong><span style=\"color: #ff0000\">sock.recv(4096)</span></strong>，该调用的作用是从socket上读取4K字节数据。</p>\n<p>我们知道，创建网络连接，多久能创建完成不是客户端决定的，而是由网络状况和服务端处理能力共同决定。服务端什么时候返回了响应数据并被客户端接收到可供程序读取，也是不可预测的。<strong>所以<span style=\"color: #ff0000\">sock.connect()</span>和<span style=\"color: #ff0000\">sock.recv()</span>这两个调用在默认情况下是阻塞的。</strong></p>\n<blockquote><p>注：<strong><span style=\"color: #ff0000\">sock.send()</span></strong>函数并不会阻塞太久，它只负责将请求数据拷贝到TCP/IP协议栈的系统缓冲区中就返回，并不等待服务端返回的应答确认。</p></blockquote>\n<p>假设网络环境很差，创建网络连接需要1秒钟，那么<strong><span style=\"color: #ff0000\">sock.connect()</span></strong>就得阻塞1秒钟，等待网络连接成功。这1秒钟对一颗2.6GHz的CPU来讲，仿佛过去了83年，然而它不能干任何事情。<strong><span style=\"color: #ff0000\">sock.recv()</span></strong>也是一样的必须得等到服务端的响应数据已经被客户端接收。我们下载10篇网页，这个阻塞过程就得重复10次。如果一个爬虫系统每天要下载1000万篇网页呢？！</p>\n<p>上面说了很多，我们力图说明一件事：<strong>同步阻塞的网络交互方式，效率低十分低下。</strong>特别是在网络交互频繁的程序中。这种方式根本<strong>不可能</strong>挑战C10K/C10M。</p>\n<h2>3.2 改进方式：多进程</h2>\n<p>在一个程序内，依次执行10次太耗时，那开10个一样的程序同时执行不就行了。于是我们想到了多进程编程。<strong>为什么会先想到多进程呢</strong>？发展脉络如此。在更早的操作系统（Linux 2.4）及其以前，进程是 OS 调度任务的实体，是面向进程设计的OS。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e40124c2b29c297270e5c3cf83984cd6.png\"><img class=\"aligncenter wp-image-88294 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e40124c2b29c297270e5c3cf83984cd6.png\" alt=\"03_multiproc\" width=\"1322\" height=\"866\"></a></p>\n<p>注：总体耗时约为 0.6 秒。</p>\n<p>改善效果立竿见影。但仍然有问题。总体耗时并没有缩减到原来的十分之一，而是九分之一左右，还有一些时间耗到哪里去了？<strong>进程切换开销</strong>。</p>\n<p>进程切换开销不止像“CPU的时间观”所列的“上下文切换”那么低。CPU从一个进程切换到另一个进程，需要把旧进程运行时的寄存器状态、内存状态全部保存好，再将另一个进程之前保存的数据恢复。对CPU来讲，几个小时就干等着。<strong>当进程数量大于CPU核心数量时，进程切换是必然需要的。</strong></p>\n<p>除了切换开销，多进程还有另外的缺点。一般的服务器在能够稳定运行的前提下，可以同时处理的进程数在数十个到数百个规模。如果进程数量规模更大，系统运行将不稳定，而且可用内存资源往往也会不足。</p>\n<p>多进程解决方案在面临每天需要成百上千万次下载任务的爬虫系统，或者需要同时搞定数万并发的电商系统来说，并不适合。</p>\n<p>除了<strong>切换开销大</strong>，以及<strong>可支持的任务规模小</strong>之外，多进程还有其他缺点，如状态共享等问题，后文会有提及，此处不再细究。</p>\n<h2>3.3 继续改进：多线程</h2>\n<p>由于线程的数据结构比进程更轻量级，同一个进程可以容纳多个线程，从进程到线程的优化由此展开。后来的OS也把调度单位由进程转为线程，进程只作为线程的容器，用于管理进程所需的资源。而且OS级别的线程是可以被分配到不同的CPU核心同时运行的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e67c2998155f1830795139fbb202192d.png\"><img class=\"aligncenter wp-image-88295 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e67c2998155f1830795139fbb202192d.png\" alt=\"04_multithread\" width=\"1330\" height=\"870\"></a></p>\n<p>注：总体运行时间约0.43秒。</p>\n<p>结果符合预期，比多进程耗时要少些。从运行时间上看，多线程似乎已经解决了切换开销大的问题。而且可支持的任务数量规模，也变成了数百个到数千个。</p>\n<p>但是，多线程仍有问题，特别是Python里的多线程。首先，Python中的多线程因为GIL的存在，它们并不能利用CPU多核优势，<strong>一个Python进程中，只允许有一个线程处于运行状态</strong>。那为什么结果还是如预期，耗时缩减到了十分之一？</p>\n<p>因为在做阻塞的系统调用时，例如<strong><span style=\"color: #ff0000\">sock.connect(),sock.recv()</span></strong>时，当前线程会释放GIL，让别的线程有执行机会。但是单个线程内，在阻塞调用上还是阻塞的。</p>\n<blockquote><p>小提示：Python中 time.sleep 是阻塞的，都知道使用它要谨慎，但在多线程编程中，time.sleep 并不会阻塞其他线程。</p></blockquote>\n<p>除了GIL之外，所有的多线程还有通病。它们是被OS调度，调度策略是抢占式的，以保证同等优先级的线程都有均等的执行机会，那带来的问题是：并不知道下一时刻是哪个线程被运行，也不知道它正要执行的代码是什么。所以就可能存在<strong>竞态条件</strong>。</p>\n<p>例如爬虫工作线程从任务队列拿待抓取URL的时候，如果多个爬虫线程同时来取，那这个任务到底该给谁？那就需要用到“锁”或“同步队列”来保证下载任务不会被重复执行。</p>\n<p>而且线程支持的多任务规模，在数百到数千的数量规模。在大规模的高频网络交互系统中，仍然有些吃力。当然，<strong>多线程最主要的问题还是竞态条件</strong>。</p>\n<h2>3.4 非阻塞方式</h2>\n<p>终于，我们来到了非阻塞解决方案。先来看看最原始的非阻塞如何工作的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4cc1cce576902e1b7794d45c480dea74.png\"><img class=\"aligncenter wp-image-88296 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4cc1cce576902e1b7794d45c480dea74.png\" alt=\"05_nonblocking\" width=\"1334\" height=\"1450\"></a></p>\n<p>注：总体耗时约4.3秒。</p>\n<p>首先注意到两点，就感觉被骗了。一是耗时与同步阻塞相当，二是代码更复杂。要非阻塞何用？且慢。</p>\n<p>上图第9行代码<span style=\"color: #ff0000\"><strong>sock.setblocking(False)</strong></span>告诉OS，让socket上阻塞调用都改为非阻塞的方式。之前我们说到，非阻塞就是在做一件事的时候，不阻碍调用它的程序做别的事情。上述代码在执行完 <strong><span style=\"color: #ff0000\">sock.connect()</span> </strong>和 <strong><span style=\"color: #ff0000\">sock.recv()</span></strong> 后的确不再阻塞，可以继续往下执行请求准备的代码或者是执行下一次读取。</p>\n<p>代码变得更复杂也是上述原因所致。第11行要放在<strong><span style=\"color: #ff0000\">try</span></strong>语句内，是因为<strong><span style=\"color: #ff0000\">socket</span></strong>在发送非阻塞连接请求过程中，系统底层也会抛出异常。<strong><span style=\"color: #ff0000\">connect()</span></strong>被调用之后，立即可以往下执行第15和16行的代码。</p>\n<p>需要while循环不断尝试 <strong><span style=\"color: #ff0000\">send()</span></strong>，是因为<strong><span style=\"color: #ff0000\">connect()</span></strong>已经非阻塞，在<strong><span style=\"color: #ff0000\">send()</span></strong>之时并不知道 <strong><span style=\"color: #ff0000\">socket</span></strong> 的连接是否就绪，只有不断尝试，尝试成功为止，即发送数据成功了。<strong><span style=\"color: #ff0000\">recv()</span></strong>调用也是同理。</p>\n<p><strong>虽然 <span style=\"color: #ff0000\">connect()</span> 和 <span style=\"color: #ff0000\">recv()</span> 不再阻塞主程序，空出来的时间段CPU没有空闲着，但并没有利用好这空闲去做其他有意义的事情，而是在循环尝试读写 socket （不停判断非阻塞调用的状态是否就绪）。还得处理来自底层的可忽略的异常。也不能同时处理多个 socket 。</strong></p>\n<p>然后10次下载任务仍然按序进行。所以总体执行时间和同步阻塞相当。如果非得这样子，那还不如同步阻塞算了。</p>\n<h2>3.5 非阻塞改进</h2>\n<h3>3.5.1 epoll</h3>\n<p>判断非阻塞调用是否就绪如果 OS 能做，是不是应用程序就可以不用自己去等待和判断了，就可以利用这个空闲去做其他事情以提高效率。</p>\n<p>所以<strong>OS将I/O状态的变化都封装成了事件</strong>，如可读事件、可写事件。并且<strong>提供了专门的系统模块让应用程序可以接收事件通知</strong>。这个模块就是<strong><span style=\"color: #ff0000\">select</span></strong>。让应用程序可以通过<strong><span style=\"color: #ff0000\">select</span></strong>注册文件描述符和回调函数。当文件描述符的状态发生变化时，<strong><span style=\"color: #ff0000\">select</span></strong> 就调用事先注册的回调函数。</p>\n<p><strong><span style=\"color: #ff0000\">select</span></strong>因其算法效率比较低，后来改进成了<strong><span style=\"color: #ff0000\">poll</span></strong>，再后来又有进一步改进，BSD内核改进成了<strong><span style=\"color: #ff0000\">kqueue</span></strong>模块，而Linux内核改进成了<strong><span style=\"color: #ff0000\">epoll</span></strong>模块。这四个模块的作用都相同，暴露给程序员使用的API也几乎一致，区别在于<strong><span style=\"color: #ff0000\">kqueue</span></strong> 和 <strong><span style=\"color: #ff0000\">epoll</span></strong> 在处理大量文件描述符时效率更高。</p>\n<p>鉴于 Linux 服务器的普遍性，以及为了追求更高效率，所以我们常常听闻被探讨的模块都是 <strong><span style=\"color: #ff0000\">epoll</span></strong> 。</p>\n<h3>3.5.2 回调(Callback)</h3>\n<p>把I/O事件的等待和监听任务交给了 OS，那 OS 在知道I/O状态发生改变后（例如socket连接已建立成功可发送数据），它又怎么知道接下来该干嘛呢？<strong>只能回调</strong>。</p>\n<p>需要我们将发送数据与读取数据封装成独立的函数，让<strong><span style=\"color: #ff0000\">epoll</span></strong>代替应用程序监听<strong><span style=\"color: #ff0000\">socket</span></strong>状态时，得告诉<strong><span style=\"color: #ff0000\">epoll</span></strong>：“如果<strong><span style=\"color: #ff0000\">socket</span></strong>状态变为可以往里写数据（连接建立成功了），请调用HTTP请求发送函数。如果<strong><span style=\"color: #ff0000\">socket</span></strong> 变为可以读数据了（客户端已收到响应），请调用响应处理函数。”</p>\n<p>于是我们利用<strong><span style=\"color: #ff0000\">epoll</span></strong>结合回调机制重构爬虫代码：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa837bc7650e9cda6069b86f44b9cf2c.png\"><img class=\"aligncenter wp-image-88297 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa837bc7650e9cda6069b86f44b9cf2c.png\" alt=\"06_callback\" width=\"1326\" height=\"1442\"></a></p>\n<p>此处和前面稍有不同的是，我们将下载不同的10个页面，相对URL路径存放于urls_todo集合中。现在看看改进在哪。</p>\n<p>首先，不断尝试<strong><span style=\"color: #ff0000\">send()</span></strong> 和 <strong><span style=\"color: #ff0000\">recv()</span></strong> 的两个循环被消灭掉了。</p>\n<p>其次，导入了<strong><span style=\"color: #ff0000\">selectors</span></strong>模块，并创建了一个<strong><span style=\"color: #ff0000\">DefaultSelector</span> </strong>实例。Python标准库提供的<strong><span style=\"color: #ff0000\">selectors</span></strong>模块是对底层<strong><span style=\"color: #ff0000\">select/poll/epoll/kqueue</span></strong>的封装。<strong><span style=\"color: #ff0000\">DefaultSelector</span></strong>类会根据 OS 环境自动选择最佳的模块，那在 Linux 2.5.44 及更新的版本上都是<strong><span style=\"color: #ff0000\">epoll</span></strong>了。</p>\n<p>然后，在第25行和第31行分别注册了<strong><span style=\"color: #ff0000\">socket</span></strong>可写事件<strong><span style=\"color: #ff0000\">(EVENT_WRITE)</span></strong>和可读事件<strong><span style=\"color: #ff0000\">(EVENT_READ)</span></strong>发生后应该采取的回调函数。</p>\n<p>虽然代码结构清晰了，阻塞操作也交给OS去等待和通知了，但是，我们要抓取10个不同页面，就得创建10个<strong><span style=\"color: #ff0000\">Crawler</span></strong>实例，就有20个事件将要发生，那如何从<strong><span style=\"color: #ff0000\">selector</span></strong>里获取当前正发生的事件，并且得到对应的回调函数去执行呢？</p>\n<h3>3.5.3 事件循环（Event Loop）</h3>\n<p>为了解决上述问题，那我们只得采用老办法，写一个循环，去访问selector模块，等待它告诉我们当前是哪个事件发生了，应该对应哪个回调。<strong>这个等待事件通知的循环，称之为事件循环</strong>。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4d2984a2e636568b5265bbacdd6a71fd.png\"><img class=\"aligncenter wp-image-88298 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4d2984a2e636568b5265bbacdd6a71fd.png\" alt=\"07_ioloop\" width=\"1334\" height=\"264\"></a></p>\n<p>上述代码中，我们用<strong><span style=\"color: #ff0000\">stopped</span></strong>全局变量控制事件循环何时停止。当<strong><span style=\"color: #ff0000\">urls_todo</span></strong>消耗完毕后，会标记<strong><span style=\"color: #ff0000\">stopped</span></strong>为<strong><span style=\"color: #ff0000\">True</span></strong>。</p>\n<p>重要的是第49行代码，<strong><span style=\"color: #ff0000\">selector.select()</span> 是一个阻塞调用</strong>，因为如果事件不发生，那应用程序就没事件可处理，所以就干脆阻塞在这里等待事件发生。那可以推断，如果只下载一篇网页，一定要<strong><span style=\"color: #ff0000\">connect()</span></strong>之后才能<strong><span style=\"color: #ff0000\">send()</span></strong>继而<strong><span style=\"color: #ff0000\">recv()</span></strong>，那它的效率和阻塞的方式是一样的。因为不在<strong><span style=\"color: #ff0000\">connect()/recv()</span></strong>上阻塞，也得在<strong><span style=\"color: #ff0000\">select()</span></strong>上阻塞。</p>\n<p>所以，<strong><span style=\"color: #ff0000\">selector</span>机制(后文以此称呼代指<span style=\"color: #ff0000\">epoll/kqueue)</span>是设计用来解决大量并发连接的</strong>。当系统中有大量非阻塞调用，能随时产生事件的时候，<strong><span style=\"color: #ff0000\">selector</span></strong>机制才能发挥最大的威力。</p>\n<p>下面是如何启创建10个下载任务和启动事件循环的：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/b2bc8baa26ec664a0064de51fd58b27f.png\"><img class=\"aligncenter wp-image-88299 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/b2bc8baa26ec664a0064de51fd58b27f.png\" alt=\"08_useloop\" width=\"1328\" height=\"298\"></a></p>\n<p>注：总体耗时约0.45秒。</p>\n<p>上述执行结果令人振奋。在单线程内用 <strong>事件循环+回调</strong> 搞定了10篇网页同时下载的问题。这，已经是<strong>异步编程</strong>了。虽然有一个for 循环顺序地创建Crawler 实例并调用<strong><span style=\"color: #ff0000\"> fetch</span></strong> 方法，但是<strong><span style=\"color: #ff0000\">fetch</span></strong> 内仅有<strong><span style=\"color: #ff0000\">connect()</span></strong>和注册可写事件，而且从执行时间明显可以推断，多个下载任务确实在同时进行！</p>\n<p>上述代码异步执行的过程：</p>\n<ol>\n<li>创建<strong><span style=\"color: #ff0000\">Crawler</span></strong> 实例；</li>\n<li>调用<strong><span style=\"color: #ff0000\">fetch</span></strong>方法，会创建<strong><span style=\"color: #ff0000\">socket</span></strong>连接和在<strong><span style=\"color: #ff0000\">selector</span></strong>上注册可写事件；</li>\n<li>fetch内并无阻塞操作，该方法立即返回；</li>\n<li>重复上述3个步骤，将10个不同的下载任务都加入事件循环；</li>\n<li>启动事件循环，进入第1轮循环，阻塞在事件监听上；</li>\n<li>当某个下载任务<strong><span style=\"color: #ff0000\">EVENT_WRITE</span></strong>被触发，回调其<strong><span style=\"color: #ff0000\">connected</span></strong>方法，第一轮事件循环结束；</li>\n<li>进入第2轮事件循环，当某个下载任务有事件触发，执行其回调函数；此时已经不能推测是哪个事件发生，因为有可能是上次<strong><span style=\"color: #ff0000\">connected</span></strong>里的<strong><span style=\"color: #ff0000\">EVENT_READ</span></strong>先被触发，也可能是其他某个任务的<strong><span style=\"color: #ff0000\">EVENT_WRITE</span></strong>被触发；（<strong>此时，原来在一个下载任务上会阻塞的那段时间被利用起来执行另一个下载任务了</strong>）</li>\n<li>循环往复，直至所有下载任务被处理完成</li>\n<li>退出事件循环，结束整个下载程序</li>\n</ol>\n<h3>3.5.4 总结</h3>\n<p>目前为止，我们已经从同步阻塞学习到了异步非阻塞。掌握了在单线程内同时并发执行多个网络I/O阻塞型任务的黑魔法。而且与多线程相比，连线程切换都没有了，执行回调函数是函数调用开销，在线程的栈内完成，因此性能也更好，单机支持的任务规模也变成了数万到数十万个。（不过我们知道：没有免费午餐，也没有银弹。）</p>\n<p>部分编程语言中，对异步编程的支持就止步于此（不含语言官方之外的扩展）。需要程序猿直接使用epoll去注册事件和回调、维护一个事件循环，然后大多数时间都花在设计回调函数上。</p>\n<p>通过本节的学习，我们应该认识到，不论什么编程语言，但凡要做异步编程，上述的“事件循环+回调”这种模式是逃不掉的，尽管它可能用的不是<strong><span style=\"color: #ff0000\">epoll</span></strong>，也可能不是<strong><span style=\"color: #ff0000\">while</span></strong>循环。如果你找到了一种不属于 “<strong>等会儿告诉你</strong>” 模型的异步方式，请立即给我打电话（注意，打电话是Call）。</p>\n<p>为什么我们在某些异步编程中并没有看到 CallBack 模式呢？这就是我们接下来要探讨的问题。本节是学习异步编程的一个终点，也是另一个起点。毕竟咱们讲 Python 异步编程，还没提到其主角<strong>协程</strong>的用武之地。</p>\n<h1>4 Python 对异步I/O的优化之路</h1>\n<p>我们将在本节学习到 Python 生态对异步编程的支持是如何继承前文所述的“<strong>事件循环+回调</strong>”模式演变到asyncio的原生协程模式。</p>\n<h2>4.1 回调之痛，以终为始</h2>\n<p>在第3节中，我们已经学会了“<strong>事件循环+回调</strong>”的基本运行原理，可以基于这种方式在单线程内实现异步编程。也确实能够大大提高程序运行效率。但是，刚才所学的只是最基本的，然而在生产项目中，要应对的复杂度会大大增加。考虑如下问题：</p>\n<ul>\n<li>如果回调函数执行不正常该如何？</li>\n<li>如果回调里面还要嵌套回调怎么办？要嵌套很多层怎么办？</li>\n<li>如果嵌套了多层，其中某个环节出错了会造成什么后果？</li>\n<li>如果有个数据需要被每个回调都处理怎么办？</li>\n<li>……</li>\n</ul>\n<p>在实际编程中，上述系列问题不可避免。在这些问题的背后隐藏着回调编程模式的一些<strong>缺点</strong>：</p>\n<ul>\n<li><strong>回调层次过多时代码可读性差</strong></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b2e635460715\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef callback_1():\r\n  # processing ...\r\n  def callback_2():\r\n      # processing.....\r\n      def callback_3():\r\n          # processing ....\r\n          def callback_4():\r\n              #processing .....\r\n              def callback_5():\r\n                  # processing ......\r\n              async_function(callback_5)\r\n          async_function(callback_4)\r\n      async_function(callback_3)\r\n  async_function(callback_2)\r\nasync_function(callback_1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b2e635460715-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b2e635460715-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">callback_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># processing ...</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">callback_2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-p\"># processing.....</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">callback_3</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-6\"><span class=\"crayon-h\">          </span><span class=\"crayon-p\"># processing ....</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">callback_4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-8\"><span class=\"crayon-h\">              </span><span class=\"crayon-p\">#processing .....</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-9\"><span class=\"crayon-h\">              </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">callback_5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-10\"><span class=\"crayon-h\">                  </span><span class=\"crayon-p\"># processing ......</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-11\"><span class=\"crayon-h\">              </span><span class=\"crayon-e\">async_function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback_5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">async_function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback_4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">async_function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback_3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b2e635460715-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">async_function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback_2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b2e635460715-15\"><span class=\"crayon-e\">async_function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback_1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<ul>\n<li><strong>破坏代码结构</strong></li>\n</ul>\n<p>写同步代码时，关联的操作时自上而下运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b50604113567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndo_a()\r\ndo_b()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b50604113567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b50604113567-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b50604113567-1\"><span class=\"crayon-e\">do_a</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b50604113567-2\"><span class=\"crayon-e\">do_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果 b 处理依赖于 a 处理的结果，而 a 过程是异步调用，就不知 a 何时能返回值，需要将后续的处理过程以callback的方式传递给 a ，让 a 执行完以后可以执行 b。代码变化为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b55537088432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndo_a(do_b())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b55537088432-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b55537088432-1\"><span class=\"crayon-e\">do_a</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果整个流程中全部改为异步处理，而流程比较长的话，代码逻辑就会成为这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b58378572726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndo_a(do_b(do_c(do_d(do_e(do_f(......))))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b58378572726-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b58378572726-1\"><span class=\"crayon-e\">do_a</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_c</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_e</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面实际也是回调地狱式的风格，但这不是主要矛盾。主要在于，原本从上而下的代码结构，要改成从内到外的。先f，再e，再d，…，直到最外层 a 执行完成。在同步版本中，执行完a后执行b，这是线程的指令指针控制着的流程，而在回调版本中，流程就是程序猿需要注意和安排的。</p>\n<ul>\n<li><strong>共享状态管理困难</strong><br>\n回顾第3节爬虫代码，同步阻塞版的<strong><span style=\"color: #ff0000\">sock</span></strong>对象从头使用到尾，而在回调的版本中，我们必须在<strong><span style=\"color: #ff0000\">Crawler</span></strong>实例化后的对象<strong><span style=\"color: #ff0000\">self</span></strong>里保存它自己的<strong><span style=\"color: #ff0000\">sock</span></strong>对象。如果不是采用OOP的编程风格，那需要把要共享的状态接力似的传递给每一个回调。多个异步调用之间，到底要共享哪些状态，事先就得考虑清楚，精心设计。</li>\n<li><strong>错误处理困难</strong><br>\n一连串的回调构成一个完整的调用链。例如上述的 a 到 f。假如 d 抛了异常怎么办？整个调用链断掉，接力传递的状态也会丢失，这种现象称为<strong>调用栈撕裂</strong>。 c 不知道该干嘛，继续异常，然后是 b 异常，接着 a 异常。好嘛，报错日志就告诉你，a 调用出错了，但实际是 d 出错。<strong>所以，为了防止栈撕裂，异常必须以数据的形式返回，而不是直接抛出异常，然后每个回调中需要检查上次调用的返回值，以防错误吞没。</strong></li>\n</ul>\n<p>如果说代码风格难看是小事，但栈撕裂和状态管理困难这两个缺点会让基于回调的异步编程很艰难。所以不同编程语言的生态都在致力于解决这个问题。才诞生了后来的<strong><span style=\"color: #ff0000\">Promise、Co-routine</span></strong>等解决方案。</p>\n<p>Python 生态也以终为始，秉承着“程序猿不必难程序猿”的原则，让语言和框架开发者苦逼一点，也要让应用开发者舒坦。在<strong>事件循环+回调</strong>的基础上衍生出了基于协程的解决方案，代表作有 <strong><span style=\"color: #ff0000\">Tornado、Twisted、asyncio</span></strong> 等。接下来我们随着 Python 生态异步编程的发展过程，深入理解Python异步编程。</p>\n<h2>4.2 核心问题</h2>\n<p>通过前面的学习，我们清楚地认识到异步编程最大的困难：异步任务何时执行完毕？接下来要对异步调用的返回结果做什么操作？</p>\n<p>上述问题我们已经通过事件循环和回调解决了。但是回调会让程序变得复杂。要异步，必回调，又是否有办法规避其缺点呢？那需要弄清楚其本质，为什么回调是必须的？还有使用回调时克服的那些缺点又是为了什么？</p>\n<p>答案是程序为了知道自己已经干了什么？正在干什么？将来要干什么？<strong>换言之，程序得知道当前所处的状态，而且要将这个状态在不同的回调之间延续下去。</strong></p>\n<p>多个回调之间的状态管理困难，那让每个回调都能管理自己的状态怎么样？链式调用会有栈撕裂的困难，让回调之间不再链式调用怎样？不链式调用的话，那又如何让被调用者知道已经完成了？那就让这个回调通知那个回调如何？而且一个回调，不就是一个待处理任务吗？</p>\n<p>任务之间得相互通知，每个任务得有自己的状态。那不就是很古老的编程技法：协作式多任务？然而要在单线程内做调度，<strong>啊哈，协程！</strong>每个协程具有自己的栈帧，当然能知道自己处于什么状态，协程之间可以协作那自然可以通知别的协程。</p>\n<h2>4.3 协程</h2>\n<ul>\n<li><strong>协程(Co-routine)，即是协作式的例程。</strong></li>\n</ul>\n<p>它是非抢占式的多任务子例程的概括，可以允许有多个入口点在例程中确定的位置来控制程序的暂停与恢复执行。</p>\n<p>例程是什么？编程语言定义的可被调用的代码段，为了完成某个特定功能而封装在一起的一系列指令。一般的编程语言都用称为函数或方法的代码结构来体现。</p>\n<h2>4.4 基于生成器的协程</h2>\n<p>早期的 Pythoner 发现 Python 中有种特殊的对象——生成器（Generator），它的特点和协程很像。每一次迭代之间，会暂停执行，继续下一次迭代的时候还不会丢失先前的状态。</p>\n<p>为了支持用生成器做简单的协程，Python 2.5 对生成器进行了增强(PEP 342)，该增强提案的标题是 “Coroutines via Enhanced Generators”。有了PEP 342的加持，生成器可以通过<strong><span style=\"color: #ff0000\">yield</span></strong> 暂停执行和向外返回数据，也可以通过<strong><span style=\"color: #ff0000\">send()</span></strong>向生成器内发送数据，还可以通过<strong><span style=\"color: #ff0000\">throw()</span></strong>向生成器内抛出异常以便随时终止生成器的运行。</p>\n<p>接下来，我们用基于生成器的协程来重构先前的爬虫代码。</p>\n<h3>4.4.1 未来对象(Future)</h3>\n<p>不用回调的方式了，怎么知道异步调用的结果呢？先设计一个对象，异步调用执行完的时候，就把结果放在它里面。这种对象称之为未来对象。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/815c8151acb7d4fec01f637bec5bd4a3.png\"><img class=\"aligncenter wp-image-88300 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/815c8151acb7d4fec01f637bec5bd4a3.png\" alt=\"09_future\" width=\"1324\" height=\"722\"></a></p>\n<p>未来对象有一个<strong><span style=\"color: #ff0000\">result</span></strong>属性，用于存放未来的执行结果。还有个<strong><span style=\"color: #ff0000\">set_result()</span></strong>方法，是用于设置<strong><span style=\"color: #ff0000\">result</span></strong>的，并且会在给<strong><span style=\"color: #ff0000\">result</span></strong>绑定值以后运行事先给future添加的回调。回调是通过未来对象的<strong><span style=\"color: #ff0000\">add_done_callback()</span></strong>方法添加的。</p>\n<p>不要疑惑此处的<strong><span style=\"color: #ff0000\">callback</span></strong>，说好了不回调的嘛？难道忘了我们曾经说的<strong>要异步，必回调</strong>。不过也别急，此处的回调，和先前学到的回调，还真有点不一样。</p>\n<h3>4.4.2 重构 Crawler</h3>\n<p>现在不论如何，我们有了未来对象可以代表未来的值。先用<strong><span style=\"color: #ff0000\">Future</span></strong>来重构爬虫代码。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/13a05fa1bcc865ccf7940839c7529104.png\"><img class=\"aligncenter wp-image-88301 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/13a05fa1bcc865ccf7940839c7529104.png\" alt=\"10_gen_crawler\" width=\"1332\" height=\"1456\"></a></p>\n<p>和先前的回调版本对比，已经有了较大差异。fetch 方法内有了yield表达式，使它成为了生成器。我们知道生成器需要先调用<strong><span style=\"color: #ff0000\">next()</span></strong>迭代一次或者是先<strong><span style=\"color: #ff0000\">send(None)</span></strong>启动，遇到yield之后便暂停。那这fetch生成器如何再次恢复执行呢？至少 <strong><span style=\"color: #ff0000\">Future</span></strong> 和 <strong><span style=\"color: #ff0000\">Crawler</span></strong>都没看到相关代码。</p>\n<h3>4.4.3 任务对象(Task)</h3>\n<p>为了解决上述问题，我们只需遵循一个编程规则：单一职责，每种角色各司其职，如果还有工作没有角色来做，那就创建一个角色去做。没人来恢复这个生成器的执行么？没人来管理生成器的状态么？创建一个，就叫<strong><span style=\"color: #ff0000\">Task</span></strong>好了，很合适的名字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/2702feaec0918e6ac1efd009e9222b0a.png\"><img class=\"aligncenter wp-image-88302 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/2702feaec0918e6ac1efd009e9222b0a.png\" alt=\"11_task\" width=\"1332\" height=\"552\"></a></p>\n<p>上述代码中<strong><span style=\"color: #ff0000\">Task</span></strong>封装了<strong><span style=\"color: #ff0000\">coro</span></strong>对象，即初始化时传递给他的对象，被管理的任务是待执行的协程，故而这里的coro就是<strong><span style=\"color: #ff0000\">fetch()</span></strong>生成器。它还有个<strong><span style=\"color: #ff0000\">step()</span></strong>方法，在初始化的时候就会执行一遍。<strong><span style=\"color: #ff0000\">step()</span></strong>内会调用生成器的<strong><span style=\"color: #ff0000\">send()</span></strong>方法，初始化第一次发送的是None就驱动了coro即<strong><span style=\"color: #ff0000\">fetch()</span></strong>的第一次执行。</p>\n<p><strong><span style=\"color: #ff0000\">send()</span></strong>完成之后，得到下一次的<strong><span style=\"color: #ff0000\">future</span></strong>，然后给下一次的<strong><span style=\"color: #ff0000\">future</span></strong>添加<strong><span style=\"color: #ff0000\">step()</span></strong>回调。原来<strong><span style=\"color: #ff0000\">add_done_callback()</span></strong>不是给写爬虫业务逻辑用的。此前的<strong><span style=\"color: #ff0000\">callback</span></strong>可就干的是业务逻辑呀。</p>\n<p>再看<strong><span style=\"color: #ff0000\">fetch()</span></strong>生成器，其内部写完了所有的业务逻辑，包括如何发送请求，如何读取响应。而且注册给selector的回调相当简单，就是给对应的<strong><span style=\"color: #ff0000\">future</span></strong>对象绑定结果值。两个yield表达式都是返回对应的future对象，然后返回<strong><span style=\"color: #ff0000\">Task.step()</span></strong>之内，这样<strong><span style=\"color: #ff0000\">Task, Future, Coroutine</span></strong>三者精妙地串联在了一起。</p>\n<p>初始化Task对象以后，把<span style=\"color: #ff0000\"><strong>fetch()</strong></span>给驱动到了第44行<strong><span style=\"color: #ff0000\">yied f</span></strong>就完事了，接下来怎么继续？</p>\n<h3>4.4.4 事件循环(Event Loop)驱动协程运行</h3>\n<p>该事件循环上场了。接下来，只需等待已经注册的EVENT_WRITE事件发生。事件循环就像心脏一般，只要它开始跳动，整个程序就会持续运行。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f73d1e5d440798c92bc0a4dfb334270f.png\"><img class=\"aligncenter wp-image-88303 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f73d1e5d440798c92bc0a4dfb334270f.png\" alt=\"12_evloop\" width=\"1328\" height=\"616\"></a></p>\n<p>注：总体耗时约0.43秒。</p>\n<p>现在loop有了些许变化，<strong><span style=\"color: #ff0000\">callback()</span></strong>不再传递<strong><span style=\"color: #ff0000\">event_key</span></strong>和<strong><span style=\"color: #ff0000\">event_mask</span></strong>参数。也就是说，这里的回调根本不关心是谁触发了这个事件，结合<strong><span style=\"color: #ff0000\">fetch()</span></strong>可以知道，它只需完成对<strong><span style=\"color: #ff0000\">future</span></strong>设置结果值即可<strong><span style=\"color: #ff0000\">f.set_result()</span></strong>。而且<strong><span style=\"color: #ff0000\">future</span></strong>是谁它也不关心，因为<strong>协程</strong>能够保存自己的状态，知道自己的<strong><span style=\"color: #ff0000\">future</span></strong>是哪个。也不用关心到底要设置什么值，因为要设置什么值也是协程内安排的。</p>\n<p><strong>此时的loop()，真的成了一个心脏，它只管往外泵血，不论这份血液是要输送给大脑还是要给脚趾，只要它还在跳动，生命就能延续。</strong></p>\n<h3>4.4.5 生成器协程风格和回调风格对比总结</h3>\n<p>在回调风格中：</p>\n<ul>\n<li>存在链式回调（虽然示例中嵌套回调只有一层）</li>\n<li>请求和响应也不得不分为两个回调以至于破坏了同步代码那种结构</li>\n<li>程序员必须在回调之间维护必须的状态。</li>\n</ul>\n<p>还有更多示例中没有展示，但确实存在的问题，参见4.1节。</p>\n<p>而基于生成器协程的风格：</p>\n<ul>\n<li>无链式调用</li>\n<li><strong><span style=\"color: #ff0000\">selector</span></strong>的回调里只管给<strong><span style=\"color: #ff0000\">future</span></strong>设置值，不再关心业务逻辑</li>\n<li>loop 内回调<strong><span style=\"color: #ff0000\">callback()</span></strong>不再关注是谁触发了事件</li>\n<li>已趋近于同步代码的结构</li>\n<li>无需程序员在多个协程之间维护状态，例如哪个才是自己的<strong><span style=\"color: #ff0000\">sock</span></strong></li>\n</ul>\n<h3>4.4.6 碉堡了，但是代码很丑！能不能重构？</h3>\n<p>如果说<strong><span style=\"color: #ff0000\">fetch</span></strong>的容错能力要更强，业务功能也需要更完善，怎么办？而且技术处理的部分（socket相关的）和业务处理的部分（请求与返回数据的处理）混在一起。</p>\n<ul>\n<li>创建<strong><span style=\"color: #ff0000\">socket</span></strong>连接可以抽象复用吧？</li>\n<li>循环读取整个<strong><span style=\"color: #ff0000\">response</span></strong>可以抽象复用吧？</li>\n<li>循环内处理<strong><span style=\"color: #ff0000\">socket.recv()</span></strong>的可以抽象复用吧？</li>\n</ul>\n<p>但是这些关键节点的地方都有<strong><span style=\"color: #ff0000\">yield</span></strong>，抽离出来的代码也需要是生成器。而且<strong><span style=\"color: #ff0000\">fetch()</span></strong>自己也得是生成器。生成器里玩生成器，代码好像要写得更丑才可以……</p>\n<p>Python 语言的设计者们也认识到了这个问题，再次秉承着“程序猿不必为难程序猿”的原则，他们捣鼓出了一个<strong><span style=\"color: #ff0000\">yield from</span></strong>来解决生成器里玩生成器的问题。</p>\n<h2>4.5 用 yield from 改进生成器协程</h2>\n<h3>4.5.1 yield from语法介绍</h3>\n<p>yield from 是Python 3.3 新引入的语法（PEP 380）。它主要解决的就是在生成器里玩生成器不方便的问题。它有两大主要功能。</p>\n<p>第一个功能是：让嵌套生成器不必通过循环迭代yield，而是直接yield from。以下两种在生成器里玩子生成器的方式是等价的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b64999572638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef gen_one():\r\n    subgen = range(10)    yield from subgendef gen_two():\r\n    subgen = range(10)    for item in subgen:        yield item</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b64999572638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b64999572638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b64999572638-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b64999572638-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">gen_one</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b64999572638-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">subgen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">yield </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">subgendef </span><span class=\"crayon-e\">gen_two</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b64999572638-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">subgen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">subgen</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-e\">yield </span><span class=\"crayon-v\">item</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>第二个功能就是在子生成器和原生成器的调用者之间打开双向通道，两者可以直接通信。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d73a268b6e434927848\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef gen():\r\n    yield from subgen()def subgen():\r\n    while True:\r\n        x = yield\r\n        yield x+1def main():\r\n    g = gen()\r\n    next(g)                # 驱动生成器g开始执行到第一个 yield\r\n    retval = g.send(1)     # 看似向生成器 gen() 发送数据\r\n    print(retval)          # 返回2\r\n    g.throw(StopIteration) # 看似向gen()抛入异常</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d73a268b6e434927848-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b6e434927848-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b6e434927848-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b6e434927848-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b6e434927848-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b6e434927848-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b6e434927848-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b6e434927848-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d73a268b6e434927848-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d73a268b6e434927848-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d73a268b6e434927848-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">gen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b6e434927848-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">yield </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">subgen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">subgen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b6e434927848-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b6e434927848-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yield</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b6e434927848-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b6e434927848-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b6e434927848-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">                </span><span class=\"crayon-p\"># 驱动生成器g开始执行到第一个 yield</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b6e434927848-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\"># 看似向生成器 gen() 发送数据</span></div><div class=\"crayon-line\" id=\"crayon-599d73a268b6e434927848-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">          </span><span class=\"crayon-p\"># 返回2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d73a268b6e434927848-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">throw</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">StopIteration</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 看似向gen()抛入异常</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>通过上述代码清晰地理解了yield from的双向通道功能。关键字yield from在gen()内部为subgen()和main()开辟了通信通道。main()里可以直接将数据1发送给subgen(),subgen()也可以将计算后的数据2返回到main()里，main()里也可以直接向subgen()抛入异常以终止subgen()。</p>\n<p>顺带一提，yield from 除了可以 yield from 还可以 yield from 。</p>\n<h3>4.5.2 重构代码</h3>\n<p>抽象socket连接的功能:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/46d52cc58abf84225a529c280f199c7c.png\"><img class=\"aligncenter wp-image-88304 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/46d52cc58abf84225a529c280f199c7c.png\" alt=\"13_yf_conn\" width=\"1326\" height=\"520\"></a></p>\n<p>抽象单次<strong><span style=\"color: #ff0000\">recv()</span></strong>和读取完整的<span style=\"color: #ff0000\">response</span>功能:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/429685e8f353d20d8bce9990ceb529e1.png\"><img class=\"aligncenter wp-image-88305 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/429685e8f353d20d8bce9990ceb529e1.png\" alt=\"14_yf_read\" width=\"1328\" height=\"698\"></a></p>\n<p>三个关键点的抽象已经完成，现在重构<strong><span style=\"color: #ff0000\">Crawler</span></strong>类：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/47558d12801fd122257c3feff7c94a61.png\"><img class=\"aligncenter wp-image-88306 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/47558d12801fd122257c3feff7c94a61.png\" alt=\"15_yf_crawler\" width=\"1326\" height=\"544\"></a></p>\n<p>上面代码整体来讲没什么问题，可复用的代码已经抽象出去，作为子生成器也可以使用 <strong><span style=\"color: #ff0000\">yield from</span></strong> 语法来获取值。但另外有个点需要<strong>注意</strong>：在第24和第35行返回<strong><span style=\"color: #ff0000\">future</span></strong>对象的时候，我们了<strong><span style=\"color: #ff0000\">yield from f</span> </strong>而不是原来的<strong><span style=\"color: #ff0000\">yield f</span></strong>。<strong><span style=\"color: #ff0000\">yield</span></strong>可以直接作用于普通Python对象，而<strong><span style=\"color: #ff0000\">yield from</span></strong>却不行，所以我们对<strong><span style=\"color: #ff0000\">Future</span></strong>还要进一步改造，把它变成一个<strong><span style=\"color: #ff0000\">iterable</span></strong>对象就可以了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/b80205ab137273a4224d7284203c6ed9.png\"><img class=\"aligncenter wp-image-88307 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/b80205ab137273a4224d7284203c6ed9.png\" alt=\"16_yf_future\" width=\"1324\" height=\"584\"></a></p>\n<p>只是增加了<strong><span style=\"color: #ff0000\">__iter__()</span></strong>方法的实现。如果不把<strong><span style=\"color: #ff0000\">Future</span></strong>改成<strong><span style=\"color: #ff0000\">iterable</span></strong>也是可以的，还是用原来的<strong><span style=\"color: #ff0000\">yield</span></strong> f即可。那为什么需要改进呢？</p>\n<p>首先，我们是在基于生成器做协程，而生成器还得是生成器，如果继续混用<strong><span style=\"color: #ff0000\">yield</span></strong>和<strong><span style=\"color: #ff0000\">yield from</span></strong> 做协程，代码可读性和可理解性都不好。其次，如果不改，协程内还得关心它等待的对象是否可被yield，如果协程里还想继续返回协程怎么办？如果想调用普通函数动态生成一个<strong><span style=\"color: #ff0000\">Future</span></strong>对象再返回怎么办？</p>\n<p>所以，在Python 3.3 引入<strong><span style=\"color: #ff0000\">yield from</span></strong>新语法之后，就不再推荐用yield去做协程。全都使用<strong><span style=\"color: #ff0000\">yield from</span></strong>由于其双向通道的功能，可以让我们在协程间随心所欲地传递数据。</p>\n<h3>4.5.3 yield from改进协程总结</h3>\n<p>用<strong><span style=\"color: #ff0000\">yield from</span></strong>改进基于生成器的协程，代码抽象程度更高。使业务逻辑相关的代码更精简。由于其双向通道功能可以让协程之间随心所欲传递数据，使Python异步编程的协程解决方案大大向前迈进了一步。</p>\n<p>于是Python语言开发者们充分利用<strong><span style=\"color: #ff0000\">yield from</span></strong>，使 <strong><span style=\"color: #ff0000\">Guido</span></strong> 主导的Python异步编程框架<strong><span style=\"color: #ff0000\">Tulip</span></strong>迅速脱胎换骨，并迫不及待得让它在 Python 3.4 中换了个名字<strong><span style=\"color: #ff0000\">asyncio</span></strong>以“实习生”角色出现在标准库中。</p>\n<h3>4.5.4 asyncio 介绍</h3>\n<p><strong><span style=\"color: #ff0000\">asyncio</span></strong>是Python 3.4 试验性引入的异步I/O框架（PEP 3156），提供了基于协程做异步I/O编写单线程并发代码的基础设施。其核心组件有事件循环（Event Loop）、协程(Coroutine）、任务(Task)、未来对象(Future)以及其他一些扩充和辅助性质的模块。</p>\n<p>在引入asyncio的时候，还提供了一个装饰器<strong><span style=\"color: #ff0000\">@asyncio.coroutine</span></strong>用于装饰使用了<strong><span style=\"color: #ff0000\">yield from</span></strong>的函数，以标记其为协程。但并不强制使用这个装饰器。</p>\n<p>虽然发展到 Python 3.4 时有了<strong><span style=\"color: #ff0000\">yield from</span></strong>的加持让协程更容易了，但是由于协程在Python中发展的历史包袱所致，很多人仍然弄不明白<strong>生成器</strong>和<strong>协程</strong>的联系与区别，也弄不明白<strong><span style=\"color: #ff0000\">yield</span></strong> 和 <strong><span style=\"color: #ff0000\">yield from</span></strong> 的区别。这种混乱的状态也违背Python之禅的一些准则。</p>\n<p>于是Python设计者们又快马加鞭地在 3.5 中新增了<strong><span style=\"color: #ff0000\">async/await</span></strong>语法（PEP 492），对协程有了明确而显式的支持，称之为<strong>原生协程</strong>。<strong><span style=\"color: #ff0000\">async/await</span></strong> 和 <strong><span style=\"color: #ff0000\">yield from</span></strong>这两种风格的协程底层复用共同的实现，而且相互兼容。</p>\n<p>在Python 3.6 中<strong><span style=\"color: #ff0000\">asyncio</span></strong>库“转正”，不再是实验性质的，成为标准库的正式一员。</p>\n<h2>4.6 总结</h2>\n<p>行至此处，我们已经掌握了<strong><span style=\"color: #ff0000\">asyncio</span></strong>的核心原理，学习了它的原型，也学习了异步I/O在 CPython 官方支持的生态下是如何一步步发展至今的。</p>\n<p>实际上，真正的<strong><span style=\"color: #ff0000\">asyncio</span></strong>比我们前几节中学到的要复杂得多，它还实现了零拷贝、公平调度、异常处理、任务状态管理等等使 Python 异步编程更完善的内容。理解原理和原型对我们后续学习有莫大的帮助。</p>\n<h1>5 asyncio和原生协程初体验</h1>\n<p>本节中，我们将初步体验<strong><span style=\"color: #ff0000\">asyncio</span></strong>库和新增语法<strong><span style=\"color: #ff0000\">async/await</span></strong>给我们带来的便利。由于Python2-3的过度期间，Python3.0-3.4的使用者并不是太多，也为了不让更多的人困惑，也因为<strong><span style=\"color: #ff0000\">aysncio</span></strong>在3.6才转正，所以更深入学习asyncio库的时候我们将使用<strong><span style=\"color: #ff0000\">async/await</span></strong>定义的原生协程风格，<strong><span style=\"color: #ff0000\">yield from</span></strong>风格的协程不再阐述（实际上它们可用很小的代价相互代替）。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7e131eb91da34645a3d4fa24280fec62.png\"><img class=\"aligncenter wp-image-88308 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7e131eb91da34645a3d4fa24280fec62.png\" alt=\"17_aio\" width=\"1328\" height=\"802\"></a></p>\n<p>对比生成器版的协程，使用<strong><span style=\"color: #ff0000\">asyncio</span></strong>库后变化很大：</p>\n<ul>\n<li>没有了<strong><span style=\"color: #ff0000\">yield</span> </strong>或 <strong><span style=\"color: #ff0000\">yield from</span></strong>，而是<strong><span style=\"color: #ff0000\">async/await</span></strong></li>\n<li>没有了自造的<strong><span style=\"color: #ff0000\">loop()</span></strong>，取而代之的是<strong><span style=\"color: #ff0000\">asyncio.get_event_loop()</span></strong></li>\n<li>无需自己在<strong><span style=\"color: #ff0000\">socket</span></strong>上做异步操作，不用显式地注册和注销事件，<strong><span style=\"color: #ff0000\">aiohttp</span></strong>库已经代劳</li>\n<li>没有了显式的<strong><span style=\"color: #ff0000\"> Future</span></strong> 和<strong><span style=\"color: #ff0000\"> Task，asyncio</span></strong>已封装</li>\n<li>更少量的代码，更优雅的设计</li>\n</ul>\n<p>说明：我们这里发送和接收HTTP请求不再自己操作<strong><span style=\"color: #ff0000\">socket</span></strong>的原因是，在实际做业务项目的过程中，要处理妥善地HTTP协议会很复杂，我们需要的是功能完善的异步HTTP客户端，业界已经有了成熟的解决方案，DRY不是吗？</p>\n<p>和同步阻塞版的代码对比：</p>\n<ul>\n<li>异步化</li>\n<li>代码量相当（引入<strong><span style=\"color: #ff0000\">aiohttp</span></strong>框架后更少）</li>\n<li>代码逻辑同样简单，跟同步代码一样的结构、一样的逻辑</li>\n<li>接近10倍的性能提升</li>\n</ul>\n<h1>结语</h1>\n<p>到此为止，我们已经深入地学习了异步编程是什么、为什么、在Python里是怎么样发展的。我们找到了一种让代码看起来跟同步代码一样简单，而效率却提升N倍（具体提升情况取决于项目规模、网络环境、实现细节）的异步编程方法。它也没有回调的那些缺点。</p>\n<p>本系列教程接下来的一篇将是学习<span style=\"color: #ff0000\"><strong>asyncio</strong></span>库如何的使用，快速掌握它的主要内容。后续我们还会深入探究<strong><span style=\"color: #ff0000\">asyncio</span></strong>的优点与缺点，也会探讨Python生态中其他异步I/O方案和asyncio的区别。</p>\n<h1>附</h1>\n<h2><strong>参考资料</strong></h2>\n<ul>\n<li>《A Web Crawler With asyncio Coroutines》</li>\n<li>《让 CPU 告诉你硬盘和网络到底有多慢》</li>\n</ul>\n<h2><strong>相关代码</strong></h2>\n<ul>\n<li>http://github.com/denglj/aiotutorial</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88291\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88291votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88291\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 17 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,异步编程",
    "article_url": "http://python.jobbole.com/88291/",
    "url_object_id": "22131321c5d288d3fa669dc269e4231c",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/c4d9d606f774db64be492d4acd8c2cf1.png"
    ]
}
{
    "title": "Python3 是如何解决棘手的字符编码问题的？",
    "create_date": "2017/08/06",
    "agree_num": 2,
    "comment_num": 1,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://foofish.net/how-python3-handle-charset-encoding.html\">liuzhijun</a>   </div><p>Python3 最重要的一项改进之一就是解决了 Python2 中字符串与字符编码遗留下来的这个大坑。<a href=\"http://python.jobbole.com/88264/\">Python 编码为什么那么蛋疼？</a>已经介绍过 Python2 字符串设计上的一些缺陷：</p>\n<ul>\n<li>使用 ASCII 码作为默认编码方式，对中文处理很不友好。</li>\n<li>把字符串的牵强地分为 unicode 和 str 两种类型，误导开发者</li>\n</ul>\n<p>当然这并不算 Bug，只要处理的时候多留心也可以避免这些坑。但在 Python3 两个问题都很好的解决了。</p>\n<p>首先，Python3 把系统默认编码设置为 UTF-8</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c1d103345237\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; import sys\r\n&gt;&gt;&gt; sys.getdefaultencoding()\r\n'utf-8'\r\n&gt;&gt;&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c1d103345237-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c1d103345237-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c1d103345237-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c1d103345237-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c1d103345237-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c1d103345237-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getdefaultencoding</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c1d103345237-3\"><span class=\"crayon-s\">'utf-8'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c1d103345237-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后，文本字符和二进制数据区分得更清晰，分别用 str 和 bytes 表示。文本字符全部用 str 类型表示，str 能表示 Unicode 字符集中所有字符，而二进制字节数据用一种全新的数据类型，用 bytes 来表示。</p>\n<h1>str</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c35213425890\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; a = \"a\"\r\n&gt;&gt;&gt; a\r\n'a'\r\n&gt;&gt;&gt; type(a)\r\n&lt;class 'str'&gt;\r\n\r\n&gt;&gt;&gt; b = \"禅\"\r\n&gt;&gt;&gt; b\r\n'禅'\r\n&gt;&gt;&gt; type(b)\r\n&lt;class 'str'&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c35213425890-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c35213425890-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c35213425890-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c35213425890-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c35213425890-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c35213425890-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"a\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c35213425890-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-3\"><span class=\"crayon-s\">'a'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c35213425890-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'str'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c35213425890-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c35213425890-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-9\"><span class=\"crayon-s\">'禅'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c35213425890-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c35213425890-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'str'</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h1>bytes</h1>\n<p>Python3 中，在字符引号前加‘b’，明确表示这是一个 bytes 类型的对象，实际上它就是一组二进制字节序列组成的数据，bytes 类型可以是 ASCII范围内的字符和其它十六进制形式的字符数据，但不能用中文等非ASCII字符表示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c39196178253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; c = b'a'\r\n&gt;&gt;&gt; c\r\nb'a'\r\n&gt;&gt;&gt; type(c)\r\nclass 'bytes'&gt;\r\n\r\n&gt;&gt;&gt; d = b'\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; d\r\nb'\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; type(d)\r\nclass 'bytes'&gt;\r\n&gt;&gt;&gt;\r\n\r\n&gt;&gt;&gt; e = b'禅'\r\n  File \"\", line 1\r\nSyntaxError: bytes can only contain ASCII literal characters.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c39196178253-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c39196178253-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'a'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-3\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'a'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytes'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">d</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-9\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytes'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-14\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'禅'</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c39196178253-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c39196178253-16\"><span class=\"crayon-v\">SyntaxError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">only </span><span class=\"crayon-e\">contain </span><span class=\"crayon-e\">ASCII </span><span class=\"crayon-e\">literal </span><span class=\"crayon-v\">characters</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>bytes 类型提供的操作和 str 一样，支持分片、索引、基本数值运算等操作。但是 str 与 bytes 类型的数据不能执行 <code>+</code> 操作，尽管在py2中是可行的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c3d419724278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; c = b'a'\r\n&gt;&gt;&gt; c\r\nb'a'\r\n&gt;&gt;&gt; type(c)\r\n&lt;class 'bytes'&gt;\r\n\r\n&gt;&gt;&gt; d = b'\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; d\r\nb'\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; type(d)\r\n&lt;class 'bytes'&gt;\r\n&gt;&gt;&gt;\r\n\r\n&gt;&gt;&gt; e = b'禅'\r\n  File \"&lt;stdin&gt;\", line 1\r\nSyntaxError: bytes can only contain ASCII literal characters.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c3d419724278-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c3d419724278-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'a'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-3\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'a'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytes'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">d</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-9\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bytes'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-14\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'禅'</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c3d419724278-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c3d419724278-16\"><span class=\"crayon-v\">SyntaxError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">only </span><span class=\"crayon-e\">contain </span><span class=\"crayon-e\">ASCII </span><span class=\"crayon-e\">literal </span><span class=\"crayon-v\">characters</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>python2 与 python3 字节与字符的对应关系</p>\n<table>\n<thead>\n<tr>\n<th>PYTHON2</th>\n<th>PYTHON3</th>\n<th>表现</th>\n<th>转换</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>str</td>\n<td>bytes</td>\n<td>字节</td>\n<td>encode</td>\n<td>存储</td>\n</tr>\n<tr>\n<td>unicode</td>\n<td>str</td>\n<td>字符</td>\n<td>decode</td>\n<td>显示</td>\n</tr>\n</tbody>\n</table>\n<h1>encode 与 decode</h1>\n<p>str 与 bytes 之间的转换可以用 encode 和从decode 方法。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4c330c8aa381b0be38553b3a5031bb82.jpg\"><img class=\"aligncenter wp-image-88278 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4c330c8aa381b0be38553b3a5031bb82.jpg\" alt=\"python3-str2\" width=\"458\" height=\"115\"></a></p>\n<p>encode 负责字符到字节的编码转换。默认使用 UTF-8 编码准换。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c41639997409\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; s = \"Python之禅\"\r\n&gt;&gt;&gt; s.encode()\r\nb'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'\r\n&gt;&gt;&gt; s.encode(\"gbk\")\r\nb'Python\\xd6\\xae\\xec\\xf8'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c41639997409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c41639997409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c41639997409-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c41639997409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c41639997409-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c41639997409-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Python之禅\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c41639997409-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c41639997409-3\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c41639997409-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"gbk\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c41639997409-5\"><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Python\\xd6\\xae\\xec\\xf8'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>decode 负责字节到字符的解码转换，通用使用 UTF-8 编码格式进行转换。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d759956c44213776764\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; b'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'.decode()\r\n'Python之禅'\r\n&gt;&gt;&gt; b'Python\\xd6\\xae\\xec\\xf8'.decode(\"gbk\")\r\n'Python之禅'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d759956c44213776764-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c44213776764-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d759956c44213776764-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d759956c44213776764-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d759956c44213776764-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Python\\xe4\\xb9\\x8b\\xe7\\xa6\\x85'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c44213776764-2\"><span class=\"crayon-s\">'Python之禅'</span></div><div class=\"crayon-line\" id=\"crayon-599d759956c44213776764-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Python\\xd6\\xae\\xec\\xf8'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"gbk\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d759956c44213776764-4\"><span class=\"crayon-s\">'Python之禅'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88277\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88277votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88277\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,字符编码",
    "article_url": "http://python.jobbole.com/88277/",
    "url_object_id": "d662b8f0bc6251d6886a1036d927b07b",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/4c330c8aa381b0be38553b3a5031bb82.jpg"
    ]
}
{
    "title": "一个 Reentrant Error 引发的对 Python 信号机制的探索和思考",
    "create_date": "2017/08/21",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 0,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010722497\">hsfzxjy</a>   </div><h1>写在前面</h1>\n<p>前几天工作时遇到了一个匪夷所思的问题。经过几次尝试后问题得以解决，但问题产生的原因却仍令人费解。查找 SO 无果，我决定翻看 Python 的源码。断断续续地研究了几天，终于恍然大悟。撰此文以记。</p>\n<p>本文环境：</p>\n<ul>\n<li>Ubuntu 16.04 (64 bit)</li>\n<li>Python 3.6.2</li>\n</ul>\n<p>使用的 C 源码可以从 <a href=\"https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz\">Python 官网</a> 获取。</p>\n<h2>起因</h2>\n<p>工作时用到了 celery 作为异步任务队列，为方便调试，我写了一个脚本用以启动/关闭 celery 主进程。代码简化后如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22e9b987263546\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport sys\r\nimport subprocess\r\n# ...\r\ncelery_process = subprocess.Popen(\r\n    ['celery', '-A', 'XXX', 'worker'],\r\n    stdout=subprocess.PIPE,\r\n    stderr=sys.stderr\r\n)\r\ntry:\r\n    # Start and wait for server process\r\nexcept KeyboardInterrupt:\r\n    # Ctrl + C pressed\r\n    celery_process.terminate()\r\n    celery_process.wait()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22e9b987263546-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22e9b987263546-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">subprocess</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-3\"><span class=\"crayon-c\"># ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-4\"><span class=\"crayon-v\">celery_process</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">subprocess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Popen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'celery'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'-A'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdout</span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">subprocess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PIPE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stderr</span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">stderr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-8\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-9\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Start and wait for server process</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-11\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">KeyboardInterrupt</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Ctrl + C pressed</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22e9b987263546-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">celery_process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">terminate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22e9b987263546-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">celery_process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>代码启动了 celery worker，并尝试在捕获到 <strong>KeyboardInterrupt</strong> 异常时将其热关闭。</p>\n<p>初看上去没什么问题。然而实际测试时却发生了十分诡异的事情：按下 <strong>Ctrl+C</strong> 后，程序 <strong>偶尔</strong> 会抛出这样的异常：<strong>RuntimeError: reentrant call inside &lt;_io.BufferedWriter name='&lt;stdout&gt;’&gt;</strong>。诡异之处有两点：</p>\n<ul>\n<li>异常发生的时机有随机性</li>\n<li>异常的 traceback 指向 celery 包，也就是说这是在 celery 主进程内部发生的异常</li>\n</ul>\n<p>这个结果大大出乎了我的意料。随机性异常是众多最难缠的问题之一，因为这常常意味着并发问题，涉及底层知识，病灶隐蔽，调试难度大，同时没有有效的手段判断问题是否彻底解决（可能只是降低了频率）。</p>\n<h2>解决</h2>\n<p>异常信息中有两个词很关键：<strong>reentrant</strong> 和 <strong>stdout</strong>。<strong>reentrant call</strong> 说明有一个不可重入的函数被递归调用了；<strong>stdout</strong> 则指明了发生的地点和时机。初步可以判定：<strong>由于某种原因，有两股控制流在同时操控 <strong>stdout</strong></strong>。</p>\n<p>“可重入”是什么？根据 <a href=\"https://en.wikipedia.org/wiki/Reentrancy_%28computing%29\">Wikipedia</a> 的定义：<strong>如果一个子程序能在执行时被中断并在之后被正确地、安全地唤起，它就被称为可重入的</strong>。依赖于全局数据的过程是不可重入的，如 <strong>printf</strong>（依赖于全局文件描述符）、<strong>malloc</strong>（依赖与和堆相关的一系列数据结构）等函数。需要注意的是，可重入性（reentrant）与 线程安全性（thread-safe）并不等价，甚至不存在包含关系，<a href=\"https://en.wikipedia.org/wiki/Reentrancy_%28computing%29#Examples\">Wikipedia</a> 中给出了相关的反例。</p>\n<p>多次尝试后，出现了一条线索：有时候 <strong>worker: Warm shutdown (MainProcess)</strong> 这个字符串会被二次打印，时机不确定。这句话是 celery 将要热关闭时的提示语，二次出现只可能是主进程收到了第二个信号。阅读 <a href=\"http://docs.celeryproject.org/en/latest/userguide/workers.html#process-signals\">celery 的文档</a> 可知，<strong>SIGINT</strong> 和 <strong>SIGTERM</strong> 信号可以引发热关闭。回头浏览我的代码，其中只有一处发送了 <strong>SIGTERM</strong> 信号（<strong>celery_process.terminate()</strong>），至于另一个神秘的信号，我怀疑是 <strong>SIGINT</strong>。</p>\n<p>SO 一下，结果印证了我的猜想：</p>\n<blockquote><p>If you are generating the SIGINT with Ctrl-C on a Unix system, then the signal is being sent to the entire process group.<br>\n— via <a href=\"https://stackoverflow.com/questions/6803395/child-process-receives-parents-sigint\">StackOverflow</a></p></blockquote>\n<p><strong>SIGINT</strong> 信号不仅会发送到父进程，而是会发到整个进程组，默认情况下包括了所有子进程。也就是说——在拦截了 <strong>KeyboardInterrupt</strong> 之后执行的 <strong>celery_process.terminate()</strong> 是多此一举，因为 <strong>SIGINT</strong> 信号也会被发送至 celery 主进程，同样会引起热关闭。代码稍作修改即可正常运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22ea5310620071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ...\r\ntry:\r\n    # Start and wait for server process\r\nexcept KeyboardInterrupt:\r\n    # Ctrl + C pressed\r\n    pass\r\nelse:\r\n    # Signal SIGTERM if no exception raised\r\n    celery_process.terminate()\r\nfinally:\r\n    # Wait for it to avoid it becoming orphan\r\n    celery_process.wait()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ea5310620071-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ea5310620071-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-1\"><span class=\"crayon-c\"># ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-2\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Start and wait for server process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-4\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">KeyboardInterrupt</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Ctrl + C pressed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-7\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Signal SIGTERM if no exception raised</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">celery_process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">terminate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-10\"><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ea5310620071-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Wait for it to avoid it becoming orphan</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ea5310620071-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">celery_process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h1>猜测</h1>\n<p>UNIX 信号处理是一个相当奇葩的过程——当进程收到一个信号时，内核会选择一条线程（以一定的规则），中断其当前控制流，将控制流强行转给信号处理函数，待其执行完毕后再将控制流交还给原线程。时序图如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/704f4a290960c2c282be35fa9586df4b.png\"><img class=\"aligncenter wp-image-88385 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/704f4a290960c2c282be35fa9586df4b.png\" alt=\"2109186474-59955074e4f2d\" width=\"332\" height=\"409\"></a></p>\n<p>由于控制流转换发生在同一条线程上，许多线程间同步机制会失效甚至报错。因此信号处理函数的编写要比线程函数更加严格，对同一个文件输出是被禁止并且无解的，因为很可能会发生这样的事情：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9c30c4c57042c9259dfc40db8c99821c.png\"><img class=\"aligncenter wp-image-88386 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9c30c4c57042c9259dfc40db8c99821c.png\" alt=\"2109186474-59955074e4f2d\" width=\"332\" height=\"409\"></a></p>\n<p>而且这个问题不能通过加锁来解决（因为是在同一个线程中，会死锁）。</p>\n<p>因此，我猜测异常发生时的事件时序是这样的：在 <strong>print</strong> 未执行完时中断，又在信号处理函数中调用 print，触发了重入检测，引起 <strong>RuntimeError</strong>：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/cf2e6691105b05ccda562ab39cf844c6.png\"><img class=\"aligncenter wp-image-88387 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/cf2e6691105b05ccda562ab39cf844c6.png\" alt=\"2109186474-59955074e4f2d\" width=\"500\" height=\"349\"></a></p>\n<h1>疑云又起</h1>\n<p>不幸的是，我的猜想很快被推翻了。</p>\n<p>在翻看 Python <strong>signal</strong> 模块的官方文档，我看到了如下叙述：</p>\n<blockquote><p>A Python signal handler does not get executed inside the low-level (C) signal handler. Instead, the low-level signal handler sets a flag which tells the virtual machine to execute the corresponding Python signal handler at a later point(for example at the next bytecode instruction).<br>\n— via <a href=\"https://docs.python.org/3/library/signal.html?highlight=signal#execution-of-python-signal-handlers\">Python Documentation</a></p></blockquote>\n<p>也就是说，<strong>Python 中使用 <strong>signal.signal</strong> 注册的信号处理函数并不会在收到信号时立即执行，而只是简单做一个标记，将其延迟至之后的某个时机</strong>。这么做可以尽量快地结束异常控制流，减少其对被阻断进程的影响。</p>\n<p>这番表述可以说是推翻了我的猜想，因为 Signal Handler 中的 <strong>print</strong> 并没有在异常控制流中执行。那异常又是怎么产生的呢？</p>\n<p>文档说 Python Signal Handler 会被延后至某个时机进行，但并没有明示是什么时候。对于这个疑问，<a href=\"https://stackoverflow.com/questions/19699314/how-to-use-a-separate-thread-for-asynchronous-signal-handling-in-python\">这个提问的被采纳回答</a> 则斩钉截铁地将其具体化到了“某两个 Python 字节码之间”。</p>\n<p>我们知道，Python 程序在执行前会被编译成 Python 内定的字节码<br>\n（bytecode）,Python 虚拟机实际执行的正是这些字节码。倘若该回答是正确的，则立即有如下推论：<strong>在处理信号的过程中，字节码具有原子性（atomic）</strong>。也就是说，主线程总是在两个字节码之间决定是否转移控制流， 而 <strong>不会</strong> 出现以下情况：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/609d91591bf45237e60dc66b9987c4f2.png\"><img class=\"aligncenter wp-image-88388 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/609d91591bf45237e60dc66b9987c4f2.png\" alt=\"2109186474-59955074e4f2d\" width=\"334\" height=\"239\"></a></p>\n<p>这很显然与我的程序结果相悖：<strong>print</strong> 与 <strong>print</strong> 所调用的 <strong>io.BufferedWriter.write</strong> 和 <strong>io.BufferedWriter.flush</strong> 都是用纯 C 代码编写的，对其的调用只消耗一条字节码（<strong>CALL_FUNCTION</strong> 或 <strong>CALL_FUNCTION_KW</strong>），在信号中断的影响下，这几个函数仍保持原子性，在时序图上互不重叠，更不会发生重入。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9843231a4064679f3cef55e27ea4b5d0.png\"><img class=\"aligncenter wp-image-88389 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9843231a4064679f3cef55e27ea4b5d0.png\" alt=\"2109186474-59955074e4f2d\" width=\"198\" height=\"198\"></a></p>\n<p>因此，<strong>除了在两个字节码之间，应该还有其他时机唤起了 Python Signal Handler</strong>。</p>\n<p>至此，问题已触及 Python 的地板了，需向更底层挖掘才能找到答案。</p>\n<h1>深入源码</h1>\n<p>信号注册逻辑位于 <strong>Modules/signalmodule.c</strong> 文件中。 313 行的 <strong>signal_handler</strong> 是信号处理函数的最外层包装，由系统调用 <strong>signal</strong> 或 <strong>sigaction</strong> 注册至内核，并在信号发生时被内核回调，是异常控制流的入口。<strong>signal_handler</strong> 主要调用了 239 行处的 <strong>trip_signal</strong> 函数，其中有这样一段代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22ead588844268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHandlers[sig_num].tripped = 1;\r\n\r\nif (!is_tripped) {\r\n    is_tripped = 1;\r\n    Py_AddPendingCall(checksignals_witharg, NULL);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ead588844268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ead588844268-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ead588844268-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ead588844268-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ead588844268-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ead588844268-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22ead588844268-1\"><span class=\"crayon-v\">Handlers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sig_num</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tripped</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ead588844268-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ead588844268-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">is_tripped</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ead588844268-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">is_tripped</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ead588844268-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Py_AddPendingCall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">checksignals_witharg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ead588844268-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这段代码便是文档中所说的逻辑：做标记并延后 Python Signal Handler。其中 <strong>checksignals_witharg</strong> 即为被延后调用的函数，位于 192 行，核心代码只有一句：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22eb1656626547\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int\r\nchecksignals_witharg(void * unused)\r\n{\r\n    return PyErr_CheckSignals();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb1656626547-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb1656626547-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb1656626547-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb1656626547-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb1656626547-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb1656626547-1\"><span class=\"crayon-e\">static </span><span class=\"crayon-k \">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb1656626547-2\"><span class=\"crayon-e\">checksignals_witharg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unused</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb1656626547-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb1656626547-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyErr_CheckSignals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb1656626547-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><strong>PyErr_CheckSignals</strong> 位于 1511 行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22eb4988550534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint\r\nPyErr_CheckSignals(void)\r\n{\r\n    int i;\r\n    PyObject *f;\r\n\r\n    if (!is_tripped)\r\n        return 0;\r\n\r\n#ifdef WITH_THREAD\r\n    if (PyThread_get_thread_ident() != main_thread)\r\n        return 0;\r\n#endif\r\n\r\n    is_tripped = 0;\r\n\r\n    if (!(f = (PyObject *)PyEval_GetFrame()))\r\n        f = Py_None;\r\n\r\n    for (i = 1; i &lt; NSIG; i++) {\r\n        if (Handlers[i].tripped) {\r\n            PyObject *result = NULL;\r\n            PyObject *arglist = Py_BuildValue(\"(iO)\", i, f);\r\n            Handlers[i].tripped = 0;\r\n\r\n            if (arglist) {\r\n                result = PyEval_CallObject(Handlers[i].func,\r\n                                           arglist);\r\n                Py_DECREF(arglist);\r\n            }\r\n            if (!result)\r\n                return -1;\r\n\r\n            Py_DECREF(result);\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb4988550534-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb4988550534-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-1\"><span class=\"crayon-k \">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-2\"><span class=\"crayon-e\">PyErr_CheckSignals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">void</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">is_tripped</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-10\"><span class=\"crayon-c\">#ifdef WITH_THREAD</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PyThread_get_thread_ident</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">main_thread</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-13\"><span class=\"crayon-c\">#endif</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-14\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">is_tripped</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-16\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">PyEval_GetFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Py_None</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NSIG</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Handlers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tripped</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">arglist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Py_BuildValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"(iO)\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Handlers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tripped</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arglist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyEval_CallObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Handlers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-28\"><span class=\"crayon-h\">                                           </span><span class=\"crayon-v\">arglist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Py_DECREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arglist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Py_DECREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb4988550534-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb4988550534-39\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0090 seconds] -->\r\n<p>可见，这个函数便是异步回调的最里层，包含了执行 Python Signal Handler 的逻辑。</p>\n<p>至此我们可以发现，整个 Python 中有两个办法可以唤起 Python Signal Handler，一个是调用 <strong>checksignals_witharg</strong>，另一个是调用 <strong>PyErr_CheckSignals</strong>。前者只是后者的简单封包。</p>\n<p><strong>checksignals_witharg</strong> 在 Python 源码中只出现了一次（不包括定义，下同），没有被直接调用的迹象。但需要注意的是，<strong>checksignals_witharg</strong> 曾被当做 <strong>Py_AddPendingCall</strong> 的参数，<strong>Py_AddPendingCall</strong> 所做的工作时将其加入到一个全局队列中。与之对应的出队操作是 <strong>Py_MakePendingCalls</strong>，位于 <strong>Python/ceval.c</strong> 的 464 行。此函数会间接调用 <strong>checksignals_witharg</strong>，在 Python 源码中被调用了 3 次：</p>\n<ul>\n<li><strong>Modules/_threadmodule.c</strong> 52 行的 <strong>acquire_timed</strong></li>\n<li><strong>Modules/main.c</strong> 310 行的 <strong>run_file</strong></li>\n<li><strong>Python/ceval.c</strong> 722 行的 <strong>_PyEval_EvalFrameDefault</strong></li>\n</ul>\n<p>值得注意的是，<strong>_PyEval_EvalFrameDefault</strong> 是一个长达 2600 多行的状态机，是解析字节码的核心逻辑所在。此处调用出现于状态机主循环开始处——这印证了上面回答中的部分说法，即 Python 会在两个字节码中间唤起 Python Signal Hanlder。</p>\n<p>而 <strong>PyErr_CheckSignals</strong> 在 Python 源码中出现了 80 多处，遍布 Python 的各个模块中——这说明该回答的另一半说法是错误的：<strong>除了在两个字节码之间，Python 还可能在其他角落唤起 Python Signal Handler</strong>。其中有两处值得注意，它们都位于 <strong>Modules/_io/bufferedio.c</strong> 中：</p>\n<ul>\n<li>1884 行的 <strong>_bufferedwriter_flush_unlocked</strong></li>\n<li>1939 行的 <strong>_io_BufferedWriter_write_impl</strong></li>\n</ul>\n<p>这两个函数是 <strong>io.BufferedWriter</strong> 类的底层实现，会被 <strong>print</strong> 间接调用。仔细观察可以发现，它们都有着相似的结构：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22eb9143790049\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nENTER_BUFFERED(self)\r\n// ...\r\nPyErr_CheckSignals();\r\n// ...\r\nLEAVE_BUFFERED(self)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb9143790049-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb9143790049-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb9143790049-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22eb9143790049-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22eb9143790049-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb9143790049-1\"><span class=\"crayon-e\">ENTER_BUFFERED</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb9143790049-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb9143790049-3\"><span class=\"crayon-e\">PyErr_CheckSignals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22eb9143790049-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22eb9143790049-5\"><span class=\"crayon-e\">LEAVE_BUFFERED</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><strong>ENTER_BUFFERED</strong> 是一个宏，会尝试申请无阻塞线程锁以保证函数不会被重入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d22ebc551732828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define ENTER_BUFFERED(self) \\\r\n    ( (PyThread_acquire_lock(self-&gt;lock, 0) ? \\\r\n       1 : _enter_buffered_busy(self)) \\\r\n     &amp;&amp; (self-&gt;owner = PyThread_get_thread_ident(), 1) )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ebc551732828-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ebc551732828-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d22ebc551732828-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d22ebc551732828-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d22ebc551732828-1\"><span class=\"crayon-c\">#define ENTER_BUFFERED(self) \\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ebc551732828-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PyThread_acquire_lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d22ebc551732828-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_enter_buffered_busy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d22ebc551732828-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">owner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyThread_get_thread_ident</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f1718fefe89be68d394ecda1f16bcac9.jpg\"><img class=\"aligncenter wp-image-88390 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f1718fefe89be68d394ecda1f16bcac9.jpg\" alt=\"141821598-5995ba8810149_articlex\" width=\"200\" height=\"161\"></a></p>\n<p>至此，真相已经大白了。</p>\n<h1>真相</h1>\n<p>当信号中断发生在 <strong>_bufferedwriter_flush_unlocked</strong> 或 <strong>_io_BufferedWriter_write_impl</strong> 中时，这两个函数中的 <strong>PyErr_CheckSignals</strong> 会直接唤起 Python Signal Handler，而此时由 <strong>ENTER_BUFFERED</strong> 上的锁尚未解开，若 Python Signal Handler 中又有 <strong>print</strong> 函数调用，则会导致再次 <strong>ENTER_BUFFERED</strong> 上锁失败，从而抛出异常。时序图如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/360001a8e5ca460c02f6b0017ca1cb10.png\"><img class=\"aligncenter wp-image-88391 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/360001a8e5ca460c02f6b0017ca1cb10.png\" alt=\"2109186474-59955074e4f2d\" width=\"590\" height=\"510\"></a></p>\n<h1>思考</h1>\n<p>为什么不将 Python Signal Handler 调用的地点统一在一个地方，而是散布在程序的各处呢？阅读相关代码，我认为有两点原因：</p>\n<ul>\n<li>信号中断会使某些系统调用行为异常，从而使系统调用的调用者不知如何处理，此时需要调用 Signal Handler 进行可能的状态恢复。一个例子是 <strong>write</strong> 系统调用，信号中断会导致数据部分写回，与此相关的一大批 I/O 函数（包括出问题的 <strong>_bufferedwriter_flush_unlocked</strong> 和 <strong>_io_BufferedWriter_write_impl</strong>）便只能相应地调用 <strong>PyErr_CheckSignals</strong>。</li>\n<li>某些函数需要做计算密集型任务，为了防止 Python Signal Handler 的调用被过长地延后（其实主要是为了及时响应键盘中断，防止程序无法从前台结束），必须适时地检查并调用 Python Signal Handler。一个例子是 <strong>Objects/longobject.c</strong> 中的诸函数，<strong>longobject.c</strong> 定义了 Python 特有的无限长整型，其相关的运算可能耗时相当长，必须做这样的处理。</li>\n</ul>\n<h1>总结</h1>\n<ul>\n<li>Python Signal Handler 的调用会被延后，但时机不止在两个字节码之间，而是可能出现在任何地方。</li>\n<li>由于第一条，Python Signal Handler 中尽量都使用 <strong>可重入的</strong> 的函数，以避免奇怪的问题。可重入性可以从文档获知，也可以结合定义由源码推断出来。</li>\n<li>有疑问，翻源码。人会说谎，代码不会。</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88384\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88384votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88384\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,信号机制",
    "article_url": "http://python.jobbole.com/88384/",
    "url_object_id": "0ded81177d32441ad38afe8009f96d74",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/704f4a290960c2c282be35fa9586df4b.png"
    ]
}
{
    "title": "Python 爬虫实战(2)：股票数据定向爬虫",
    "create_date": "2017/08/12",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 3,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010520835\">hang</a>   </div><h1>功能简介</h1>\n<p><strong>目标：</strong> 获取上交所和深交所所有股票的名称和交易信息。<br>\n<strong>输出：</strong> 保存到文件中。<br>\n<strong>技术路线：</strong> <span style=\"color: #ff0000\"><strong>requests—bs4–re</strong></span><br>\n<strong>语言：python3.5</strong></p>\n<h2>说明</h2>\n<p><strong>网站选择原则：</strong> 股票信息静态存在于html页面中，非js代码生成，没有Robbts协议限制。<br>\n<strong>选取方法：</strong> 打开网页，查看源代码，搜索网页的股票价格数据是否存在于源代码中。<br>\n如打开新浪股票网址：<a href=\"http://finance.sina.com.cn/realstock/company/sz000877/nc.shtml\">链接描述</a>，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png\"><img class=\"aligncenter wp-image-88351 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"609\" height=\"146\"></a></p>\n<p>上图中左边为网页的界面，显示了天山股份的股票价格是13.06。右边为该网页的源代码，在源代码中查询13.06发现没有找到。所以判断该网页的数据使用js生成的，不适合本项目。因此换一个网页。</p>\n<p>再打开百度股票的网址：<a href=\"https://gupiao.baidu.com/stock/sz300023.html\">链接描述</a>，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/aad76450e2f545d67619659a71a420fc.png\"><img class=\"aligncenter wp-image-88352 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/aad76450e2f545d67619659a71a420fc.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"670\" height=\"94\"></a></p>\n<p>从上图中可以发现百度股票的数据是html代码生成的，符合我们本项目的要求，所以在本项目中选择百度股票的网址。</p>\n<p>由于百度股票只有单个股票的信息，所以还需要当前股票市场中所有股票的列表，在这里我们选择东方财富网，网址为：<a href=\"http://quote.eastmoney.com/stocklist.html\">链接描述</a>，界面如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/79e952720ce03bff5b28e3092edba336.png\"><img class=\"aligncenter wp-image-88353 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/79e952720ce03bff5b28e3092edba336.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"666\" height=\"224\"></a></p>\n<h1>原理分析</h1>\n<p>查看百度股票每只股票的网址：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/sz300023.html</strong></span>，可以发现网址中有一个编号<span style=\"color: #ff0000\"><strong>300023</strong></span>正好是这只股票的编号，<span style=\"color: #ff0000\"><strong>sz</strong></span>表示的深圳交易所。因此我们构造的程序结构如下：</p>\n<ul>\n<li><strong>步骤1：</strong> 从东方财富网获取股票列表；</li>\n<li><strong>步骤2：</strong> 逐一获取股票代码，并增加到百度股票的链接中，最后对这些链接进行逐个的访问获得股票的信息；</li>\n<li><strong>步骤3：</strong> 将结果存储到文件。</li>\n</ul>\n<p>接着查看百度个股信息网页的源代码，发现每只股票的信息在html代码中的存储方式如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5d61524f2de99088419b3ec5740a3b6.png\"><img class=\"aligncenter wp-image-88354 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5d61524f2de99088419b3ec5740a3b6.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"417\" height=\"216\"></a></p>\n<p>因此，在我们存储每只股票的信息时，可以参考上图中html代码的存储方式。每一个信息源对应一个信息值，即采用键值对的方式进行存储。在python中键值对的方式可以用<strong>字典</strong>类型。因此，在本项目中，使用字典来存储每只股票的信息，然后再用字典把所有股票的信息记录起来，最后将字典中的数据输出到文件中。</p>\n<h1>代码编写</h1>\n<p><span style=\"color: #ff0000\"><strong>首先是获得html网页数据的程序</strong></span>，在这里不多做介绍了，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927908141449063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#获得html文本\r\ndef getHTMLText(url):\r\n    try:\r\n        r = requests.get(url)\r\n        r.raise_for_status()\r\n        r.encoding = r.apparent_encoding\r\n        return r.text\r\n    except:\r\n        return \"\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927908141449063-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927908141449063-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927908141449063-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927908141449063-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d712927908141449063-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927908141449063-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d712927908141449063-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927908141449063-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d712927908141449063-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927908141449063-1\"><span class=\"crayon-c\">#获得html文本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927908141449063-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927908141449063-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927908141449063-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927908141449063-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">raise_for_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927908141449063-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apparent_encoding</span></div><div class=\"crayon-line\" id=\"crayon-599d712927908141449063-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927908141449063-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927908141449063-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p><span style=\"color: #ff0000\"><strong>接下来是html代码解析程序</strong></span>，在这里首先需要解析的是东方财富网页面：<a href=\"http://quote.eastmoney.com/stocklist.html\">链接描述</a>，我们打开其源代码，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5866605d0bcdefdb66cb02ebcee5ea0.png\"><img class=\"aligncenter wp-image-88355 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5866605d0bcdefdb66cb02ebcee5ea0.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"607\" height=\"79\"></a></p>\n<p>由上图可以看到，<span style=\"color: #ff0000\"><strong>a</strong></span>标签的<span style=\"color: #ff0000\"><strong>href</strong></span>属性中的网址链接里面有每只股票的对应的号码，因此我们只要把网址里面对应股票的号码解析出来即可。解析步骤如下：</p>\n<p><strong>第一步，获得一个页面：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927914794023270\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhtml = getHTMLText(stockURL)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927914794023270-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927914794023270-1\"><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><strong>第二步，解析页面，找到所有的a标签：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927918298702447\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoup = BeautifulSoup(html, 'html.parser') \r\na = soup.find_all('a')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927918298702447-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927918298702447-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927918298702447-1\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927918298702447-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><strong>第三步，对<span style=\"color: #ff0000\"><strong>a</strong></span>标签中的每一个进行遍历来进行相关的处理。处理过程如下：</strong></p>\n<p>1.找到<span style=\"color: #ff0000\"><strong>a</strong></span>标签中的<span style=\"color: #ff0000\"><strong>href</strong></span>属性，并且判断属性中间的链接，把链接后面的数字取出来，在这里可以使用正则表达式来进行匹配。由于深圳交易所的代码以<span style=\"color: #ff0000\"><strong>sz</strong></span>开头，上海交易所的代码以<span style=\"color: #ff0000\"><strong>sh</strong></span>开头，股票的数字有<span style=\"color: #ff0000\"><strong>6</strong></span>位构成，所以正则表达式可以写为<span style=\"color: #ff0000\"><strong>[s][hz]\\d{6}</strong></span>。也就是说构造一个正则表达式，在链接中去寻找满足这个正则表达式的字符串，并把它提取出来。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292791c665270202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in a:\r\n    href = i.attrs['href']\r\n    lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292791c665270202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292791c665270202-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71292791c665270202-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292791c665270202-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292791c665270202-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d71292791c665270202-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>2.由于在<span style=\"color: #ff0000\"><strong>html</strong></span>中有很多的<span style=\"color: #ff0000\"><strong>a</strong></span>标签，但是有些<span style=\"color: #ff0000\"><strong>a</strong></span>标签中没有<span style=\"color: #ff0000\"><strong>href</strong></span>属性，因此上述程序在运行的时候出现异常，所有对上述的程序还要进行<span style=\"color: #ff0000\"><strong>try…except</strong></span>来对程序进行异常处理，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927922190953662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in a:\r\n    try:\r\n        href = i.attrs['href']\r\n        lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n    except:\r\n        continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927922190953662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927922190953662-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927922190953662-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927922190953662-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d712927922190953662-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927922190953662-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927922190953662-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927922190953662-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927922190953662-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927922190953662-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927922190953662-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927922190953662-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>从上面代码可以看出，对于出现异常的情况我们使用了<span style=\"color: #ff0000\"><strong>continue</strong></span>语句，直接让其跳过，继续执行下面的语句。通过上面的程序我们就可以把东方财富网上股票的代码信息全部保存下来了。</p>\n<p><strong>将上述的代码封装成一个函数，对东方财富网页面解析的完整代码如下所示：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927927261276984\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getStockList(lst, stockURL):\r\n    html = getHTMLText(stockURL)\r\n    soup = BeautifulSoup(html, 'html.parser') \r\n    a = soup.find_all('a')\r\n    for i in a:\r\n        try:\r\n            href = i.attrs['href']\r\n            lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n        except:\r\n            continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927927261276984-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927927261276984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927927261276984-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927927261276984-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d712927927261276984-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927927261276984-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d712927927261276984-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927927261276984-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d712927927261276984-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927927261276984-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927927261276984-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927927261276984-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927927261276984-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927927261276984-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927927261276984-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927927261276984-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927927261276984-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927927261276984-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927927261276984-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927927261276984-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p><strong>接下来是获得百度股票网<a href=\"https://gupiao.baidu.com/stock/sz300023.html\">链接描述</a>单只股票的信息。</strong>我们先查看该页面的源代码，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7742e9536a095384a3b609d59b9d33c9.png\"><img class=\"aligncenter wp-image-88356 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7742e9536a095384a3b609d59b9d33c9.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"562\" height=\"735\"></a></p>\n<p>股票的信息就存在上图所示的html代码中，因此我们需要对这段html代码进行解析。过程如下：</p>\n<p>1.百度股票网的网址为：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/</strong></span><br>\n一只股票信息的网址为：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/sz300023.html</strong></span></p>\n<p>所以只要<span style=\"color: #ff0000\"><strong>百度股票网的网址+每只股票的代码</strong></span>即可，而每只股票的代码我们已经有前面的程序<span style=\"color: #ff0000\"><strong>getStockList</strong></span>从东方财富网解析出来了，因此对<span style=\"color: #ff0000\"><strong>getStockList</strong></span>函数返回的列表进行遍历即可，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292792b200716304\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor stock in lst:\r\n        url = stockURL + stock + \".html\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292792b200716304-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292792b200716304-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292792b200716304-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292792b200716304-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>2.获得网址后，就要访问网页获得网页的<span style=\"color: #ff0000\"><strong>html</strong></span>代码了，程序如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292792e366550241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhtml = getHTMLText(url)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292792e366550241-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292792e366550241-1\"><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>3.获得了<span style=\"color: #ff0000\"><strong>html</strong></span>代码后就需要对<span style=\"color: #ff0000\"><strong>html</strong></span>代码进行解析，由上图我们可以看到单个股票的信息存放在标签为<span style=\"color: #ff0000\"><strong>div</strong></span>,属性为<span style=\"color: #ff0000\"><strong>stock-bets</strong></span>的<span style=\"color: #ff0000\"><strong>html</strong></span>代码中，因此对其进行解析：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927933327889161\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoup = BeautifulSoup(html, 'html.parser')\r\nstockInfo = soup.find('div',attrs={'class':'stock-bets'})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927933327889161-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927933327889161-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927933327889161-1\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927933327889161-2\"><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>4.我们又发现股票名称在<span style=\"color: #ff0000\"><strong>bets-name</strong></span>标签内，继续解析，存入字典中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927937973778276\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninfoDict = {}\r\nname = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\ninfoDict.update({'股票名称': name.text.split()[0]})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927937973778276-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927937973778276-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927937973778276-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927937973778276-1\"><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927937973778276-2\"><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d712927937973778276-3\"><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><span style=\"color: #ff0000\"><strong>split()</strong></span>的意思是股票名称空格后面的部分不需要了。</p>\n<p>5.我们从<span style=\"color: #ff0000\"><strong>html</strong></span>代码中还可以观察到股票的其他信息存放在<span style=\"color: #ff0000\"><strong>dt</strong></span>和<span style=\"color: #ff0000\"><strong>dd</strong></span>标签中，其中dt表示股票信息的键域，dd标签是值域。获取全部的键和值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292793a686805802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkeyList = stockInfo.find_all('dt')\r\nvalueList = stockInfo.find_all('dd')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292793a686805802-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292793a686805802-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292793a686805802-1\"><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292793a686805802-2\"><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>并把获得的键和值按键值对的方式村放入字典中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292793e168102605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in range(len(keyList)):\r\n    key = keyList[i].text\r\n    val = valueList[i].text\r\n    infoDict[key] = val</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292793e168102605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292793e168102605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71292793e168102605-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292793e168102605-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292793e168102605-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292793e168102605-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-599d71292793e168102605-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292793e168102605-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>6.最后把字典中的数据存入外部文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927941245026443\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open(fpath, 'a', encoding='utf-8') as f:\r\nf.write( str(infoDict) + '\\n' )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927941245026443-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927941245026443-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927941245026443-1\"><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927941245026443-2\"><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><strong>将上述过程封装成完成的函数，代码如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927944040093440\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getStockInfo(lst, stockURL, fpath):\r\n    for stock in lst:\r\n        url = stockURL + stock + \".html\"\r\n        html = getHTMLText(url)\r\n        try:\r\n            if html==\"\":\r\n                continue\r\n            infoDict = {}\r\n            soup = BeautifulSoup(html, 'html.parser')\r\n            stockInfo = soup.find('div',attrs={'class':'stock-bets'})\r\n \r\n            name = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\n            infoDict.update({'股票名称': name.text.split()[0]})\r\n             \r\n            keyList = stockInfo.find_all('dt')\r\n            valueList = stockInfo.find_all('dd')\r\n            for i in range(len(keyList)):\r\n                key = keyList[i].text\r\n                val = valueList[i].text\r\n                infoDict[key] = val\r\n             \r\n            with open(fpath, 'a', encoding='utf-8') as f:\r\n                f.write( str(infoDict) + '\\n' )\r\n        except:\r\n            continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927944040093440-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d712927944040093440-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-14\"><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-18\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-19\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-20\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-21\"><span class=\"crayon-e\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-22\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927944040093440-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d712927944040093440-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>try…except</strong></span>用于异常处理。</p>\n<p><strong>接下来编写主函数，调用上述函数即可：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d712927948755870847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef main():\r\n    stock_list_url = 'http://quote.eastmoney.com/stocklist.html'\r\n    stock_info_url = 'https://gupiao.baidu.com/stock/'\r\n    output_file = 'D:/BaiduStockInfo.txt'\r\n    slist=[]\r\n    getStockList(slist, stock_list_url)\r\n    getStockInfo(slist, stock_info_url, output_file)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d712927948755870847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927948755870847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d712927948755870847-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927948755870847-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d712927948755870847-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d712927948755870847-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d712927948755870847-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d712927948755870847-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927948755870847-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://quote.eastmoney.com/stocklist.html'</span></div><div class=\"crayon-line\" id=\"crayon-599d712927948755870847-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://gupiao.baidu.com/stock/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927948755870847-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/BaiduStockInfo.txt'</span></div><div class=\"crayon-line\" id=\"crayon-599d712927948755870847-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">slist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d712927948755870847-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d712927948755870847-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h1>项目完整程序</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71292794c462588589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# -*- coding: utf-8 -*-\r\n\r\nimport requests\r\nfrom bs4 import BeautifulSoup\r\nimport traceback\r\nimport re\r\n \r\ndef getHTMLText(url):\r\n    try:\r\n        r = requests.get(url)\r\n        r.raise_for_status()\r\n        r.encoding = r.apparent_encoding\r\n        return r.text\r\n    except:\r\n        return \"\"\r\n \r\ndef getStockList(lst, stockURL):\r\n    html = getHTMLText(stockURL)\r\n    soup = BeautifulSoup(html, 'html.parser') \r\n    a = soup.find_all('a')\r\n    for i in a:\r\n        try:\r\n            href = i.attrs['href']\r\n            lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n        except:\r\n            continue\r\n \r\ndef getStockInfo(lst, stockURL, fpath):\r\n    count = 0\r\n    for stock in lst:\r\n        url = stockURL + stock + \".html\"\r\n        html = getHTMLText(url)\r\n        try:\r\n            if html==\"\":\r\n                continue\r\n            infoDict = {}\r\n            soup = BeautifulSoup(html, 'html.parser')\r\n            stockInfo = soup.find('div',attrs={'class':'stock-bets'})\r\n \r\n            name = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\n            infoDict.update({'股票名称': name.text.split()[0]})\r\n             \r\n            keyList = stockInfo.find_all('dt')\r\n            valueList = stockInfo.find_all('dd')\r\n            for i in range(len(keyList)):\r\n                key = keyList[i].text\r\n                val = valueList[i].text\r\n                infoDict[key] = val\r\n             \r\n            with open(fpath, 'a', encoding='utf-8') as f:\r\n                f.write( str(infoDict) + '\\n' )\r\n                count = count + 1\r\n                print(\"\\r当前进度: {:.2f}%\".format(count*100/len(lst)),end=\"\")\r\n        except:\r\n            count = count + 1\r\n            print(\"\\r当前进度: {:.2f}%\".format(count*100/len(lst)),end=\"\")\r\n            continue\r\n \r\ndef main():\r\n    stock_list_url = 'http://quote.eastmoney.com/stocklist.html'\r\n    stock_info_url = 'https://gupiao.baidu.com/stock/'\r\n    output_file = 'D:/BaiduStockInfo.txt'\r\n    slist=[]\r\n    getStockList(slist, stock_list_url)\r\n    getStockInfo(slist, stock_info_url, output_file)\r\n \r\nmain()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71292794c462588589-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599d71292794c462588589-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-1\"><span class=\"crayon-c\"># -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">requests</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">traceback</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">raise_for_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apparent_encoding</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-14\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-17\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-27\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-28\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-42\"><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-47\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-48\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-49\"><span class=\"crayon-e\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-50\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-51\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-53\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r当前进度: {:.2f}%\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">end</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r当前进度: {:.2f}%\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">end</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-58\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-59\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://quote.eastmoney.com/stocklist.html'</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://gupiao.baidu.com/stock/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/BaiduStockInfo.txt'</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">slist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71292794c462588589-66\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71292794c462588589-67\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0130 seconds] -->\r\n<p><strong>上述代码中的<span style=\"color: #ff0000\"><strong>print</strong></span>语句用于打印爬取的进度。执行完上述代码后在<span style=\"color: #ff0000\"><strong>D盘</strong></span>会出现<span style=\"color: #ff0000\"><strong>BaiduStockInfo.txt</strong></span>文件，里面存放了股票的信息。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88350\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88350votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88350\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "实践项目,爬虫",
    "article_url": "http://python.jobbole.com/88350/",
    "url_object_id": "4d65df19aae500c1c2fe349d112bd7f1",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png"
    ]
}
{
    "title": "Python 判断文件是否存在的三种方法",
    "create_date": "2017/08/21",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 1,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/jhao104/blog/1490038\">j_hao104</a>   </div><p>通常在读写文件之前，需要判断文件或目录是否存在，不然某些处理方法可能会使程序出错。所以最好在做任何操作之前，先判断文件是否存在。</p>\n<p>这里将介绍三种判断文件或文件夹是否存在的方法，分别使用<strong>os模块</strong>、<strong>Try语句</strong>、<strong>pathlib模块</strong>。</p>\n<h1 id=\"h2_0\">1.使用os模块</h1>\n<p>os模块中的<strong>os.path.exists()</strong>方法用于检验文件是否存在。</p>\n<ul>\n<li>判断文件是否存在<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249a5467669173\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\nos.path.exists(test_file.txt)\r\n#True\r\n\r\nos.path.exists(no_exist_file.txt)\r\n#False</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249a5467669173-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249a5467669173-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249a5467669173-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249a5467669173-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249a5467669173-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249a5467669173-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249a5467669173-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249a5467669173-2\"><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249a5467669173-3\"><span class=\"crayon-c\">#True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249a5467669173-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d249a5467669173-5\"><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">no_exist_file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249a5467669173-6\"><span class=\"crayon-c\">#False</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</li>\n</ul>\n<ul>\n<li>判断文件夹是否存在<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249ae590474371\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\nos.path.exists(test_dir)\r\n#True\r\n\r\nos.path.exists(no_exist_dir)\r\n#False</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249ae590474371-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249ae590474371-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249ae590474371-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249ae590474371-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249ae590474371-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249ae590474371-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249ae590474371-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249ae590474371-2\"><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249ae590474371-3\"><span class=\"crayon-c\">#True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249ae590474371-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d249ae590474371-5\"><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">no_exist_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249ae590474371-6\"><span class=\"crayon-c\">#False</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</li>\n</ul>\n<p>可以看出用<strong>os.path.exists()</strong>方法，判断文件和文件夹是一样。</p>\n<p>其实这种方法还是有个问题，假设你想检查文件“test_data”是否存在，但是当前路径下有个叫“test_data”的文件夹，这样就可能出现误判。为了避免这样的情况，可以这样:</p>\n<ul>\n<li>只检查文件<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249b3121022970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\nos.path.isfile(\"test-data\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b3121022970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b3121022970-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249b3121022970-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b3121022970-2\"><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"test-data\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</li>\n</ul>\n<p>通过这个方法，如果文件”test-data”不存在将返回False，反之返回True。</p>\n<p>即是文件存在，你可能还需要判断文件是否可进行读写操作。</p>\n<h2 id=\"h2_1\">判断文件是否可做读写操作</h2>\n<p>使用<strong>os.access()</strong>方法判断文件是否可进行读写操作。</p>\n<p>语法：</p>\n<blockquote><p>os.access(path, mode)</p></blockquote>\n<p>path为文件路径，mode为操作模式，有这么几种:</p>\n<ul>\n<li>os.F_OK: 检查文件是否存在;</li>\n<li>os.R_OK: 检查文件是否可读;</li>\n<li>os.W_OK: 检查文件是否可以写入;</li>\n<li>os.X_OK: 检查文件是否可以执行</li>\n</ul>\n<p>该方法通过判断文件路径是否存在和各种访问模式的权限返回True或者False。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249b7837806495\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\nif os.access(\"/file/path/foo.txt\", os.F_OK):\r\n    print \"Given file path is exist.\"\r\n\r\nif os.access(\"/file/path/foo.txt\", os.R_OK):\r\n    print \"File is accessible to read\"\r\n\r\nif os.access(\"/file/path/foo.txt\", os.W_OK):\r\n    print \"File is accessible to write\"\r\n\r\nif os.access(\"/file/path/foo.txt\", os.X_OK):\r\n    print \"File is accessible to execute\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249b7837806495-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249b7837806495-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">access</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/file/path/foo.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Given file path is exist.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-5\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">access</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/file/path/foo.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">R_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"File is accessible to read\"</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">access</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/file/path/foo.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">W_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"File is accessible to write\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-10\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d249b7837806495-11\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">access</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/file/path/foo.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">X_OK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249b7837806495-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"File is accessible to execute\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h1 id=\"h2_2\">2.使用Try语句</h1>\n<p>可以在程序中直接使用<strong>open()</strong>方法来检查文件是否存在和可读写。</p>\n<p>语法：</p>\n<blockquote><p>open(&lt;file/path&gt;)</p></blockquote>\n<p>如果你open的文件不存在，程序会抛出错误，使用try语句来捕获这个错误。</p>\n<p>程序无法访问文件，可能有很多原因：</p>\n<ul>\n<li>如果你open的文件不存在，将抛出一个<strong>FileNotFoundError</strong>的异常;</li>\n<li>文件存在，但是没有权限访问，会抛出一个<strong>PersmissionError</strong>的异常。</li>\n</ul>\n<p>所以可以使用下面的代码来判断文件是否存在:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249bb612873857\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry:\r\n    f =open()\r\n    f.close()\r\nexcept FileNotFoundError:\r\n    print \"File is not found.\"\r\nexcept PersmissionError:\r\n    print \"You don't have permission to access this file.\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bb612873857-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249bb612873857-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bb612873857-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249bb612873857-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bb612873857-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249bb612873857-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bb612873857-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249bb612873857-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249bb612873857-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249bb612873857-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249bb612873857-4\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FileNotFoundError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249bb612873857-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"File is not found.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249bb612873857-6\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PersmissionError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249bb612873857-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You don't have permission to access this file.\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>其实没有必要去这么细致的处理每个异常，上面的这两个异常都是<strong>IOError</strong>的子类。所以可以将程序简化一下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249bf546228136\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry:\r\n    f =open()\r\n    f.close()\r\nexcept IOError:\r\n    print \"File is not accessible.\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bf546228136-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249bf546228136-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bf546228136-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249bf546228136-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249bf546228136-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249bf546228136-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249bf546228136-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249bf546228136-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249bf546228136-4\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">IOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d249bf546228136-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"File is not accessible.\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>使用try语句进行判断，处理所有异常非常简单和优雅的。而且相比其他不需要引入其他外部模块。</p>\n<h1 id=\"h2_3\">3. 使用pathlib模块</h1>\n<p>pathlib模块在Python3版本中是内建模块，但是在Python2中是需要单独安装三方模块。</p>\n<p>使用pathlib需要先使用文件路径来创建path对象。此路径可以是文件名或目录路径。</p>\n<ul>\n<li>检查路径是否存在<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249c2958987295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npath = pathlib.Path(\"path/file\")\r\npath.exist()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249c2958987295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249c2958987295-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249c2958987295-1\"><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"path/file\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249c2958987295-2\"><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</li>\n</ul>\n<ul>\n<li>检查路径是否是文件<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d249c5259113616\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npath = pathlib.Path(\"path/file\")\r\npath.is_file()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d249c5259113616-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d249c5259113616-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d249c5259113616-1\"><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"path/file\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d249c5259113616-2\"><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88381\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88381votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88381\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "基础知识,基础知识",
    "article_url": "http://python.jobbole.com/88381/",
    "url_object_id": "18d761ca5a19e7bb42ea43ca4c39cfd0",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"
    ]
}
{
    "title": "Python 爬虫实战（1）：分析豆瓣中最新电影的影评",
    "create_date": "2017/08/11",
    "agree_num": 3,
    "comment_num": 9,
    "fav_num": 7,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010473819\">hang</a>   </div><h1>简介</h1>\n<p><strong>刚接触python不久，做一个小项目来练练手。前几天看了《战狼2》，发现它在最新上映的电影里面是排行第一的，如下图所示。准备把豆瓣上对它的影评做一个分析。</strong><br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png\"><img class=\"aligncenter wp-image-88326 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"631\" height=\"332\"></a></p>\n<h1>目标总览</h1>\n<p>主要做了三件事：</p>\n<ul>\n<li>抓取网页数据</li>\n<li>清理数据</li>\n<li>用词云进行展示<br>\n使用的python版本是3.5.</li>\n</ul>\n<h2>一、抓取网页数据</h2>\n<p><strong>第一步要对网页进行访问，python中使用的是urllib库。代码如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae28473338439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom urllib import request\r\nresp = request.urlopen('https://movie.douban.com/nowplaying/hangzhou/')\r\nhtml_data = resp.read().decode('utf-8')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae28473338439-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae28473338439-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae28473338439-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae28473338439-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae28473338439-2\"><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'https://movie.douban.com/nowplaying/hangzhou/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae28473338439-3\"><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>其中<a href=\"https://movie.douban.com/nowplaying/hangzhou/\">https://movie.douban.com/nowp…</a>是豆瓣最新上映的电影页面，可以在浏览器中输入该网址进行查看。</p>\n<p>html_data是字符串类型的变量，里面存放了网页的html代码。<br>\n输入<span style=\"color: #ff0000\"><strong>print(html_data)</strong></span>可以查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/5c8197f4552247a94732373f359df514.png\"><img class=\"aligncenter wp-image-88327 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5c8197f4552247a94732373f359df514.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"596\" height=\"251\"></a></p>\n<p><strong>第二步，需要对得到的html代码进行解析，得到里面提取我们需要的数据。</strong><br>\n在python中使用BeautifulSoup库进行html代码的解析。<br>\n（注：如果没有安装此库，则使用<span style=\"color: #ff0000\"><strong>pip install BeautifulSoup</strong></span>进行安装即可！）<br>\nBeautifulSoup使用的格式如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae31867607256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nBeautifulSoup(html,\"html.parser\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae31867607256-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae31867607256-1\"><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"html.parser\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>第一个参数为需要提取数据的html，第二个参数是指定解析器，然后使用<span style=\"color: #ff0000\"><strong>find_all()</strong></span>读取html标签中的内容。</p>\n<p>但是html中有这么多的标签，该读取哪些标签呢？其实，最简单的办法是我们可以打开我们爬取网页的html代码，然后查看我们需要的数据在哪个html标签里面，再进行读取就可以了。如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c9668d5c635cd363549238604d48a780.png\"><img class=\"aligncenter wp-image-88328 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c9668d5c635cd363549238604d48a780.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"428\" height=\"355\"></a></p>\n<p>从上图中可以看出在<strong><span style=\"color: #ff0000\">div id=”nowplaying</span>“</strong>标签开始是我们想要的数据，里面有电影的名称、评分、主演等信息。所以相应的代码编写如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae35999608888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom bs4 import BeautifulSoup as bs\r\nsoup = bs(html_data, 'html.parser')    \r\nnowplaying_movie = soup.find_all('div', id='nowplaying')\r\nnowplaying_movie_list = nowplaying_movie[0].find_all('li', class_='list-item')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae35999608888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae35999608888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae35999608888-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae35999608888-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae35999608888-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae35999608888-2\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae35999608888-3\"><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'nowplaying'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae35999608888-4\"><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'li'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'list-item'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>nowplaying_movie_list </strong></span>是一个列表，可以用<span style=\"color: #000000\"><strong><span style=\"color: #ff0000\">print(nowplaying_movie_list[0]</span>)</strong></span>查看里面的内容，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa1ecd08775eb68490881bd69ec26722.png\"><img class=\"aligncenter wp-image-88329 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa1ecd08775eb68490881bd69ec26722.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"400\"></a></p>\n<p>在上图中可以看到data-subject属性里面放了电影的id号码，而在img标签的alt属性里面放了电影的名字，因此我们就通过这两个属性来得到电影的id和名称。（注：打开电影短评的网页时需要用到电影的id，所以需要对它进行解析），编写代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae41189632144\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnowplaying_list = [] \r\nfor item in nowplaying_movie_list:        \r\n        nowplaying_dict = {}        \r\n        nowplaying_dict['id'] = item['data-subject']       \r\n        for tag_img_item in item.find_all('img'):            \r\n            nowplaying_dict['name'] = tag_img_item['alt']            \r\n            nowplaying_list.append(nowplaying_dict)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae41189632144-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae41189632144-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae41189632144-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae41189632144-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae41189632144-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae41189632144-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae41189632144-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae41189632144-1\"><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae41189632144-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae41189632144-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae41189632144-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data-subject'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae41189632144-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tag_img_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'img'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae41189632144-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tag_img_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'alt'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae41189632144-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>其中列表nowplaying_list中就存放了最新电影的id和名称，可以使用<span style=\"color: #ff0000\"><strong>print(nowplaying_list)</strong></span>进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9d5b868c1c8010ccf4506ce93024123.png\"><img class=\"aligncenter wp-image-88330 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9d5b868c1c8010ccf4506ce93024123.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"389\"></a></p>\n<p>可以看到和豆瓣网址上面是匹配的。这样就得到了最新电影的信息了。接下来就要进行对最新电影短评进行分析了。例如《战狼2》的短评网址为：<span style=\"color: #ff0000\"><strong>https://movie.douban.com/subject/26363254/comments?start=0&amp;limit=20</strong></span></p>\n<p>其中<span style=\"color: #ff0000\"><strong>26363254</strong></span>就是电影的id，<span style=\"color: #ff0000\"><strong>start=0</strong></span>表示评论的第0条评论。</p>\n<p>接下来接对该网址进行解析了。打开上图中的短评页面的html代码，我们发现关于评论的数据是在<span style=\"color: #ff0000\"><strong>div</strong></span>标签的<span style=\"color: #ff0000\"><strong>comment</strong></span>属性下面，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e22ca4bece5fdc49bbb57793044dc2e1.png\"><img class=\"aligncenter wp-image-88331 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e22ca4bece5fdc49bbb57793044dc2e1.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"560\" height=\"282\"></a></p>\n<p>因此对此标签进行解析，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae46966072323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrequrl = 'https://movie.douban.com/subject/' + nowplaying_list[0]['id'] + '/comments' +'?' +'start=0' + '&amp;limit=20' \r\nresp = request.urlopen(requrl) \r\nhtml_data = resp.read().decode('utf-8') \r\nsoup = bs(html_data, 'html.parser') \r\ncomment_div_lits = soup.find_all('div', class_='comment')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae46966072323-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae46966072323-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae46966072323-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae46966072323-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae46966072323-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae46966072323-1\"><span class=\"crayon-v\">requrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://movie.douban.com/subject/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/comments'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'start=0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&amp;limit=20'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae46966072323-2\"><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae46966072323-3\"><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae46966072323-4\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae46966072323-5\"><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'comment'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>此时在<span style=\"color: #ff0000\"><strong>comment_div_lits </strong></span>列表中存放的就是div标签和comment属性下面的html代码了。在上图中还可以发现在p标签下面存放了网友对电影的评论，如下图所示:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/48a58e87311958ac0214afde471585fe.png\"><img class=\"aligncenter wp-image-88332 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/48a58e87311958ac0214afde471585fe.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"333\" height=\"24\"></a></p>\n<p>因此对<span style=\"color: #ff0000\"><strong>comment_div_lits </strong></span>代码中的html代码继续进行解析，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae4a764822899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\neachCommentList = []; \r\nfor item in comment_div_lits: \r\n        if item.find_all('p')[0].string is not None:     \r\n            eachCommentList.append(item.find_all('p')[0].string)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae4a764822899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae4a764822899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae4a764822899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae4a764822899-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae4a764822899-1\"><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae4a764822899-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae4a764822899-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae4a764822899-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>使用<span style=\"color: #ff0000\"><strong>print(eachCommentList)</strong></span>查看eachCommentList列表中的内容，可以看到里面存里我们想要的影评。如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9be8902ec90675c7e87e857a8a520f4.png\"><img class=\"aligncenter wp-image-88333 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9be8902ec90675c7e87e857a8a520f4.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"777\" height=\"52\"></a></p>\n<p>好的，至此我们已经爬取了豆瓣最近播放电影的评论数据，接下来就要对数据进行清洗和词云显示了。</p>\n<h1>二、数据清洗</h1>\n<p>为了方便进行数据进行清洗，我们将列表中的数据放在一个字符串数组中，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae4d478695834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncomments = ''\r\nfor k in range(len(eachCommentList)):\r\n    comments = comments + (str(eachCommentList[k])).strip()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae4d478695834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae4d478695834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae4d478695834-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae4d478695834-1\"><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae4d478695834-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae4d478695834-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>使用<span style=\"color: #ff0000\"><strong>print(comments)</strong></span>进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/13b063b5dfe4f22eeb86f794408219d3.png\"><img class=\"aligncenter wp-image-88334 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/13b063b5dfe4f22eeb86f794408219d3.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"57\"></a></p>\n<p>可以看到所有的评论已经变成一个字符串了，但是我们发现评论中还有不少的标点符号等。这些符号对我们进行词频统计时根本没有用，因此要将它们清除。所用的方法是正则表达式。python中正则表达式是通过re模块来实现的。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae51121365696\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport re\r\n\r\npattern = re.compile(r'[\\u4e00-\\u9fa5]+')\r\nfilterdata = re.findall(pattern, comments)\r\ncleaned_comments = ''.join(filterdata)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae51121365696-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae51121365696-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae51121365696-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae51121365696-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae51121365696-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae51121365696-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae51121365696-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae51121365696-3\"><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">compile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'[\\u4e00-\\u9fa5]+'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae51121365696-4\"><span class=\"crayon-v\">filterdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae51121365696-5\"><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>继续使用<span style=\"color: #ff0000\"><strong>print(cleaned_comments)</strong></span>语句进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/2b2a94bc16cc3b581407f49ca570a941.png\"><img class=\"aligncenter wp-image-88335 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/2b2a94bc16cc3b581407f49ca570a941.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"84\"></a><br>\n我们可以看到此时评论数据中已经没有那些标点符号了，数据变得“干净”了很多。</p>\n<p>因此要进行词频统计，所以先要进行中文分词操作。在这里我使用的是结巴分词。如果没有安装结巴分词，可以在控制台使用<span style=\"color: #ff0000\"><strong>pip install jieba</strong></span>进行安装。（注：可以使用<span style=\"color: #ff0000\"><strong>pip list</strong></span>查看是否安装了这些库）。代码如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae55858272794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport jieba    #分词包\r\nimport pandas as pd  \r\n\r\nsegment = jieba.lcut(cleaned_comments)\r\nwords_df=pd.DataFrame({'segment':segment})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae55858272794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae55858272794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae55858272794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae55858272794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae55858272794-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae55858272794-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#分词包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae55858272794-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd  </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae55858272794-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae55858272794-4\"><span class=\"crayon-v\">segment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lcut</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae55858272794-5\"><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>因为结巴分词要用到pandas，所以我们这里加载了pandas包。可以使用<span style=\"color: #ff0000\"><strong>words_df.head()</strong></span>查看分词之后的结果，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d2941e803004b245b40477ed9959a060.png\"><img class=\"aligncenter wp-image-88336 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d2941e803004b245b40477ed9959a060.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"107\" height=\"153\"></a></p>\n<p>从上图可以看到我们的数据中有“看”、“太”、“的”等虚词（停用词），而这些词在任何场景中都是高频时，并且没有实际的含义，所以我们要他们进行清除。</p>\n<p>我把停用词放在一个<span style=\"color: #ff0000\"><strong>stopwords.txt</strong></span>文件中，将我们的数据与停用词进行比对即可（注：只要在百度中输入<span style=\"color: #ff0000\"><strong>stopwords.txt</strong></span>，就可以下载到该文件）。去停用词代码如下代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae59287438858\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstopwords=pd.read_csv(\"stopwords.txt\",index_col=False,quoting=3,sep=\"\\t\",names=['stopword'], encoding='utf-8')#quoting=3全不引用\r\nwords_df=words_df[~words_df.segment.isin(stopwords.stopword)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae59287438858-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae59287438858-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae59287438858-1\"><span class=\"crayon-v\">stopwords</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stopwords.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index_col</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">quoting</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\t\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'stopword'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#quoting=3全不引用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae59287438858-2\"><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stopword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>继续使用<span style=\"color: #ff0000\"><strong>words_df.head()</strong></span>语句来查看结果，如下图所示，停用词已经被出去了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0c0eaacff86e9cf7026dd15f4559c8.png\"><img class=\"aligncenter wp-image-88337 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0c0eaacff86e9cf7026dd15f4559c8.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"113\" height=\"171\"></a></p>\n<p>接下来就要进行词频统计了，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae5c770173207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy    #numpy计算包\r\nwords_stat=words_df.groupby(by=['segment'])['segment'].agg({\"计数\":numpy.size})\r\nwords_stat=words_stat.reset_index().sort_values(by=[\"计数\"],ascending=False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae5c770173207-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae5c770173207-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae5c770173207-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae5c770173207-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numpy</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#numpy计算包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae5c770173207-2\"><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">agg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">numpy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae5c770173207-3\"><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reset_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>用<span style=\"color: #ff0000\"><strong>words_stat.head()</strong></span>进行查看，结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/04f72074b0acf979fafe97e6a3750e81.png\"><img class=\"aligncenter wp-image-88338 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/04f72074b0acf979fafe97e6a3750e81.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"153\" height=\"167\"></a></p>\n<p>由于我们前面只是爬取了第一页的评论，所以数据有点少，在最后给出的完整代码中，我爬取了10页的评论，所数据还是有参考价值。</p>\n<h1>三、用词云进行显示</h1>\n<p>代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae60811612372\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport matplotlib.pyplot as plt\r\n%matplotlib inline\r\nimport matplotlib\r\nmatplotlib.rcParams['figure.figsize'] = (10.0, 5.0)\r\nfrom wordcloud import WordCloud#词云包\r\n\r\nwordcloud=WordCloud(font_path=\"simhei.ttf\",background_color=\"white\",max_font_size=80) #指定字体类型、字体大小和字体颜色\r\nword_frequence = {x[0]:x[1] for x in words_stat.head(1000).values}\r\nword_frequence_list = []\r\nfor key in word_frequence:\r\n    temp = (key,word_frequence[key])\r\n    word_frequence_list.append(temp)\r\n\r\nwordcloud=wordcloud.fit_words(word_frequence_list)\r\nplt.imshow(wordcloud)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae60811612372-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae60811612372-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-i\">matplotlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inline</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">matplotlib</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-5\"><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rcParams</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'figure.figsize'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wordcloud </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WordCloud</span><span class=\"crayon-c\">#词云包</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-8\"><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">WordCloud</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">font_path</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"simhei.ttf\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">background_color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"white\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">max_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#指定字体类型、字体大小和字体颜色</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-9\"><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-10\"><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-11\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-14\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae60811612372-15\"><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_words</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae60811612372-16\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imshow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>simhei.ttf</strong></span>使用来指定字体的，可以在百度上输入<span style=\"color: #ff0000\"><strong>simhei.ttf</strong></span>进行下载后，放入程序的根目录即可。显示的图像如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3074bf71cd9dad3ab76c5c345a541392.png\"><img class=\"aligncenter wp-image-88339 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3074bf71cd9dad3ab76c5c345a541392.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"597\" height=\"298\"></a></p>\n<p><strong>到此为止，整个项目的介绍就结束了。由于自己也还是个初学者，接触python不久，代码写的并不好。而且第一次写技术博客，表达的有些冗余，请大家多多包涵，有不对的地方，请大家批评指正。以后我也会将自己做的小项目以这种形式写在博客上和大家一起交流！最后贴上完整的代码。</strong></p>\n<h1>完整代码</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d71f3aae64201961306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding:utf-8\r\n__author__ = 'hang'\r\n\r\nimport warnings\r\nwarnings.filterwarnings(\"ignore\")\r\nimport jieba    #分词包\r\nimport numpy    #numpy计算包\r\nimport codecs   #codecs提供的open方法来指定打开的文件的语言编码，它会在读取的时候自动转换为内部unicode \r\nimport re\r\nimport pandas as pd  \r\nimport matplotlib.pyplot as plt\r\nfrom urllib import request\r\nfrom bs4 import BeautifulSoup as bs\r\n%matplotlib inline\r\nimport matplotlib\r\nmatplotlib.rcParams['figure.figsize'] = (10.0, 5.0)\r\nfrom wordcloud import WordCloud#词云包\r\n\r\n#分析网页函数\r\ndef getNowPlayingMovie_list():   \r\n    resp = request.urlopen('https://movie.douban.com/nowplaying/hangzhou/')        \r\n    html_data = resp.read().decode('utf-8')    \r\n    soup = bs(html_data, 'html.parser')    \r\n    nowplaying_movie = soup.find_all('div', id='nowplaying')        \r\n    nowplaying_movie_list = nowplaying_movie[0].find_all('li', class_='list-item')    \r\n    nowplaying_list = []    \r\n    for item in nowplaying_movie_list:        \r\n        nowplaying_dict = {}        \r\n        nowplaying_dict['id'] = item['data-subject']       \r\n        for tag_img_item in item.find_all('img'):            \r\n            nowplaying_dict['name'] = tag_img_item['alt']            \r\n            nowplaying_list.append(nowplaying_dict)    \r\n    return nowplaying_list\r\n\r\n#爬取评论函数\r\ndef getCommentsById(movieId, pageNum): \r\n    eachCommentList = []; \r\n    if pageNum&gt;0: \r\n         start = (pageNum-1) * 20 \r\n    else: \r\n        return False \r\n    requrl = 'https://movie.douban.com/subject/' + movieId + '/comments' +'?' +'start=' + str(start) + '&amp;limit=20' \r\n    print(requrl)\r\n    resp = request.urlopen(requrl) \r\n    html_data = resp.read().decode('utf-8') \r\n    soup = bs(html_data, 'html.parser') \r\n    comment_div_lits = soup.find_all('div', class_='comment') \r\n    for item in comment_div_lits: \r\n        if item.find_all('p')[0].string is not None:     \r\n            eachCommentList.append(item.find_all('p')[0].string)\r\n    return eachCommentList\r\n\r\ndef main():\r\n    #循环获取第一个电影的前10页评论\r\n    commentList = []\r\n    NowPlayingMovie_list = getNowPlayingMovie_list()\r\n    for i in range(10):    \r\n        num = i + 1 \r\n        commentList_temp = getCommentsById(NowPlayingMovie_list[0]['id'], num)\r\n        commentList.append(commentList_temp)\r\n\r\n    #将列表中的数据转换为字符串\r\n    comments = ''\r\n    for k in range(len(commentList)):\r\n        comments = comments + (str(commentList[k])).strip()\r\n\r\n    #使用正则表达式去除标点符号\r\n    pattern = re.compile(r'[\\u4e00-\\u9fa5]+')\r\n    filterdata = re.findall(pattern, comments)\r\n    cleaned_comments = ''.join(filterdata)\r\n\r\n    #使用结巴分词进行中文分词\r\n    segment = jieba.lcut(cleaned_comments)\r\n    words_df=pd.DataFrame({'segment':segment})\r\n\r\n    #去掉停用词\r\n    stopwords=pd.read_csv(\"stopwords.txt\",index_col=False,quoting=3,sep=\"\\t\",names=['stopword'], encoding='utf-8')#quoting=3全不引用\r\n    words_df=words_df[~words_df.segment.isin(stopwords.stopword)]\r\n\r\n    #统计词频\r\n    words_stat=words_df.groupby(by=['segment'])['segment'].agg({\"计数\":numpy.size})\r\n    words_stat=words_stat.reset_index().sort_values(by=[\"计数\"],ascending=False)\r\n\r\n    #用词云进行显示\r\n    wordcloud=WordCloud(font_path=\"simhei.ttf\",background_color=\"white\",max_font_size=80)\r\n    word_frequence = {x[0]:x[1] for x in words_stat.head(1000).values}\r\n\r\n    word_frequence_list = []\r\n    for key in word_frequence:\r\n        temp = (key,word_frequence[key])\r\n        word_frequence_list.append(temp)\r\n\r\n    wordcloud=wordcloud.fit_words(word_frequence_list)\r\n    plt.imshow(wordcloud)\r\n\r\n#主函数\r\nmain()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599d71f3aae64201961306-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d71f3aae64201961306-98\">98</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-1\"><span class=\"crayon-c\">#coding:utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-2\"><span class=\"crayon-v\">__author__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hang'</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">warnings</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-5\"><span class=\"crayon-k \">warnings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filterwarnings</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ignore\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#分词包</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numpy</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#numpy计算包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-8\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">codecs</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#codecs提供的open方法来指定打开的文件的语言编码，它会在读取的时候自动转换为内部unicode </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-9\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-10\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd  </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-11\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-12\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-13\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-14\"><span class=\"crayon-ta\">%</span><span class=\"crayon-i\">matplotlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inline</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-16\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">matplotlib</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-17\"><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rcParams</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'figure.figsize'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-18\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wordcloud </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WordCloud</span><span class=\"crayon-c\">#词云包</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-20\"><span class=\"crayon-c\">#分析网页函数</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-21\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNowPlayingMovie_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'https://movie.douban.com/nowplaying/hangzhou/'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'nowplaying'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'li'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'list-item'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data-subject'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tag_img_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'img'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tag_img_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'alt'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_list</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-36\"><span class=\"crayon-c\">#爬取评论函数</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-37\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCommentsById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">movieId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-40\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">requrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://movie.douban.com/subject/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/comments'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'start='</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&amp;limit=20'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'comment'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eachCommentList</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-54\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#循环获取第一个电影的前10页评论</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">commentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">NowPlayingMovie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNowPlayingMovie_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">commentList_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCommentsById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NowPlayingMovie_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList_temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-62\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#将列表中的数据转换为字符串</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#使用正则表达式去除标点符号</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">compile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'[\\u4e00-\\u9fa5]+'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-72\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#使用结巴分词进行中文分词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">segment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lcut</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-76\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#去掉停用词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stopwords.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index_col</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">quoting</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\t\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'stopword'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#quoting=3全不引用</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stopword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-80\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#统计词频</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">agg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">numpy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reset_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-84\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-85\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#用词云进行显示</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-86\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">WordCloud</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">font_path</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"simhei.ttf\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">background_color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"white\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">max_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-88\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-93\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_words</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imshow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-96\"> </div><div class=\"crayon-line\" id=\"crayon-599d71f3aae64201961306-97\"><span class=\"crayon-c\">#主函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d71f3aae64201961306-98\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0204 seconds] -->\r\n<p>结果显示如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/05a3876d1a9c27b22ab48900bdbad449.png\"><img class=\"aligncenter wp-image-88340 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/05a3876d1a9c27b22ab48900bdbad449.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"597\" height=\"297\"></a></p>\n<p><strong>上图基本反映了《战狼2》这部电影的情况。PS:我本人并不喜欢这部电影，内容太空洞、太假，为了爱国而爱国，没意思。哎，这两年真是国产电影的低谷啊，没有一部拿得出手的国产电影，看看人家印度拍的《摔跤吧，爸爸》那才是拍的有深度，同样是表现爱国，国产电影还是需要向别的国家好好学学。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88325\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88325votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88325\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 9 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "实践项目,爬虫",
    "article_url": "http://python.jobbole.com/88325/",
    "url_object_id": "86206811adbc0f0c2a9bd5db3973a181",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png"
    ]
}
{
    "title": "Django 使用 Celery 实现异步任务",
    "create_date": "2017/08/10",
    "agree_num": 1,
    "comment_num": 0,
    "fav_num": 3,
    "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2721409931\">王海波</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>对于网站来说，给用户一个较好的体验是很重要的事情，其中最重要的指标就是网站的浏览速度。因此服务端要从各个方面对网站性能进行优化，比如可采用CDN加载一些公共静态文件，如js和css；合并css或者js从而减少静态文件的请求等等…..还有一种方法是将一些不需要立即返回给用户，可以异步执行的任务交给后台处理，以防网络阻塞，减小响应时间。看了the5fire的博客之后我受到了启发，决定从这方面进行改进。</p>\n<p>我采用celery实现后台异步执行的需求。对于celery，先看一下网上给的celery的定义和用途：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ac6234484600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCelery is a simple, flexible, and reliable distributed system to process vast amounts of messages, while providing operations with the tools required to maintain such a system.\r\n\r\nIt’s a task queue with focus on real-time processing, while also supporting task scheduling.\r\n\r\nCelery has a large and diverse community of users and contributors, you should come join us on IRC or our mailing-list.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ac6234484600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ac6234484600-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ac6234484600-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ac6234484600-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ac6234484600-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ac6234484600-1\"><span class=\"crayon-e\">Celery </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">simple</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flexible</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reliable </span><span class=\"crayon-e\">distributed </span><span class=\"crayon-e\">system </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">vast </span><span class=\"crayon-e\">amounts </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">providing </span><span class=\"crayon-e\">operations </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">tools </span><span class=\"crayon-e\">required </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">maintain </span><span class=\"crayon-i\">such</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">system</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ac6234484600-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ac6234484600-3\"><span class=\"crayon-i\">It</span>’<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">queue </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">focus </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">real</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">time </span><span class=\"crayon-v\">processing</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">also </span><span class=\"crayon-e\">supporting </span><span class=\"crayon-e\">task </span><span class=\"crayon-v\">scheduling</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ac6234484600-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ac6234484600-5\"><span class=\"crayon-e\">Celery </span><span class=\"crayon-i\">has</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">large </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">diverse </span><span class=\"crayon-e\">community </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">users </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">contributors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">should </span><span class=\"crayon-e\">come </span><span class=\"crayon-e\">join </span><span class=\"crayon-e\">us </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">IRC </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">our </span><span class=\"crayon-v\">mailing</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>上面的英文还是比较好理解的，简而言之，就是一个专注于实时处理和任务调度的分布式队列。</p>\n<p>我买了一本《Python Web开发实战》，那里面也介绍了celery。说了使用celery的常见场景：</p>\n<ol>\n<li>Web应用。当用户触发一个动作需要较长时间来执行完成时，可以把它作为任务交给celery异步执行，执行完再返回给用户。这点和你在前端使用ajax实现异步加载有异曲同工之妙。</li>\n<li>定时任务。假设有多台服务器，多个任务，定时任务的管理是很困难的，你要在不同电脑上写不同的crontab，而且还不好管理。Celery可以帮助我们快速在不同的机器设定不同任务。</li>\n<li>其他可以异步执行的任务。比如发送短信，邮件，推送消息，清理/设置缓存等。这点还是比较有用的。</li>\n</ol>\n<p>综上所述，第1点和第3点的用途是我考虑celery的原因。目前，考虑在Django中实现两个功能：</p>\n<ol>\n<li>文章阅读量的统计</li>\n<li>发送邮件</li>\n</ol>\n<p>关于文章阅读量的统计，我之前的做法就是在用户每一次访问文章的时候，都会同步执行一遍+1的函数，现在打算用异步执行的方式。</p>\n<p>下面介绍在Django中的使用方法：</p>\n<p>1、环境准备</p>\n<p>安装celery，rabbitmq,django-celery.</p>\n<p>2、启动消息中间件rabbitmq。<br>\n用它的原因是celery官方推荐的就是它，也可以用Redis等，但Redis会因为断电的原因造成数据全部丢失等问题。</p>\n<p>让其在后台运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ad0057114630\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo rabbitmq-server -detached</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad0057114630-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad0057114630-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">rabbitmq</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">detached</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>3、在Django中配置（源代码）</p>\n<p>项目代码结构</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ad4074020942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndailyblog\r\n\r\n    ├── blog\r\n│   ├── models.py\r\n│   ├── serializer.py\r\n│   ├── tasks.py\r\n│   ├── urls.py\r\n│   ├── views.py\r\n├── config.yaml\r\n├── dailyblog\r\n│   ├── celery.py\r\n│   ├── __init__.py\r\n│   ├── __init__.pyc\r\n│   ├── settings.py\r\n│   ├── urls.py\r\n│   ├── wsgi.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad4074020942-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad4074020942-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-1\"><span class=\"crayon-i\">dailyblog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-3\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">blog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-4\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">models</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-5\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">serializer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-6\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-7\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-8\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-9\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">yaml</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-10\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">dailyblog</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-11\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-12\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-13\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pyc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-14\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad4074020942-15\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad4074020942-16\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">wsgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>对于celery的配置，需要编写几个文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ad8530915491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  1、dailyblog/celery.py\r\n\r\n  2、dailyblog/settings.py\r\n\r\n  3、blog/tasks.py\r\n\r\n  4、dailyblog/__init__.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad8530915491-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad8530915491-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad8530915491-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad8530915491-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad8530915491-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ad8530915491-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ad8530915491-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad8530915491-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span>、<span class=\"crayon-v\">dailyblog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad8530915491-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad8530915491-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span>、<span class=\"crayon-v\">dailyblog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad8530915491-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad8530915491-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span>、<span class=\"crayon-v\">blog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ad8530915491-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ad8530915491-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span>、<span class=\"crayon-v\">dailyblog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>1、dailyblog/celery.py</p>\n<p>本模块主要是创建了celery应用，配置来自django的settings文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58adb886821521\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom __future__ import absolute_import,unicode_literals #目的是拒绝隐士引入，celery.py和celery冲突。\r\nimport os\r\nfrom celery import Celery\r\nfrom django.conf import settings\r\n\r\n\r\nos.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"dailyblog.settings\")\r\n\r\n#创建celery应用\r\napp = Celery('dailyblog')\r\n#You can pass the object directly here, but using a string is better since then the worker doesn’t have to serialize the object.\r\napp.config_from_object('django.conf:settings')\r\n#如果在工程的应用中创建了tasks.py模块，那么Celery应用就会自动去检索创建的任务。比如你添加了一个任务，在django中会实时地检索出来。\r\napp.autodiscover_tasks(lambda :settings.INSTALLED_APPS)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adb886821521-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adb886821521-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">__future__ </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">absolute_import</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">unicode_literals</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#目的是拒绝隐士引入，celery.py和celery冲突。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">os</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">celery </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Celery</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-4\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">settings</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-7\"><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DJANGO_SETTINGS_MODULE\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dailyblog.settings\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-8\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-9\"><span class=\"crayon-p\">#创建celery应用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-10\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Celery</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dailyblog'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-11\"><span class=\"crayon-p\">#You can pass the object directly here, but using a string is better since then the worker doesn’t have to serialize the object.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-12\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config_from_object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'django.conf:settings'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adb886821521-13\"><span class=\"crayon-p\">#如果在工程的应用中创建了tasks.py模块，那么Celery应用就会自动去检索创建的任务。比如你添加了一个任务，在django中会实时地检索出来。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adb886821521-14\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">autodiscover_tasks</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">INSTALLED_APPS</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>关于config_from_object，我对于如何加载配置文件还是比较感兴趣的，于是研究了一下源码，具体可以见：<a title=\"celery加载配置文件\" href=\"http://101.200.63.158/article/celeryloadsetting.html\">“celery加载配置文件”</a>。</p>\n<p>2、settings.py</p>\n<p>配置celery，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58adf174423234\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n import djcelery\r\n djcelery.setup_loader()\r\n\r\n\r\n #末尾添加\r\n CELERYBEAT_SCHEDULER = ‘djcelery.schedulers.DatabaseScheduler‘  # 这是使用了django-celery默认的数据库调度模型,任务执行周期都被存在你指定的orm数据库中\r\n\r\n #INstalled_apps\r\n     INSTALLED_APPS = (\r\n    ‘django.contrib.admin‘,\r\n    ‘django.contrib.auth‘,\r\n    ‘django.contrib.contenttypes‘,\r\n    ‘django.contrib.sessions‘,\r\n    ‘django.contrib.messages‘,\r\n    ‘django.contrib.staticfiles‘,\r\n    ‘djcelery‘,    #### 这里增加了djcelery 也就是为了在django admin里面可一直接配置和查看celery\r\n    ‘blog‘,     ###\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58adf174423234-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58adf174423234-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">djcelery</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">djcelery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setup_loader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#末尾添加</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CELERYBEAT_SCHEDULER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-v\">djcelery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">schedulers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">DatabaseScheduler</span>‘<span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 这是使用了django-celery默认的数据库调度模型,任务执行周期都被存在你指定的orm数据库中</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#INstalled_apps</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-9\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">INSTALLED_APPS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-10\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">admin</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-11\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">auth</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-12\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">contenttypes</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-13\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sessions</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-14\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">messages</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-15\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">staticfiles</span>‘<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-16\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-i\">djcelery</span>‘<span class=\"crayon-sy\">,</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#### 这里增加了djcelery 也就是为了在django admin里面可一直接配置和查看celery</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58adf174423234-17\"><span class=\"crayon-h\">    </span>‘<span class=\"crayon-i\">blog</span>‘<span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\">###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58adf174423234-18\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>setup_loader目的是设定celery的加载器，源码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ae2231298630\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  def setup_loader():  # noqa\r\n    os.environ.setdefault(\r\n        b'CELERY_LOADER', b'djcelery.loaders.DjangoLoader',\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae2231298630-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae2231298630-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae2231298630-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae2231298630-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae2231298630-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">setup_loader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># noqa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae2231298630-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae2231298630-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'CELERY_LOADER'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'djcelery.loaders.DjangoLoader'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae2231298630-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>3、dailyblog/<strong>init</strong>.py</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ae6818176323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom __future__ import absolute_import\r\n\r\n# This will make sure the app is always imported when\r\n# Django starts so that shared_task will use this app.\r\nfrom .celery import app as celery_app</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae6818176323-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae6818176323-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae6818176323-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae6818176323-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae6818176323-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae6818176323-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">__future__ </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">absolute_import</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae6818176323-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae6818176323-3\"><span class=\"crayon-p\"># This will make sure the app is always imported when</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae6818176323-4\"><span class=\"crayon-p\"># Django starts so that shared_task will use this app.</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae6818176323-5\"><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">celery </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">app </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">celery_app</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>4、blog/tasks.py</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58ae9084342443\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom django.db.models import F\r\n\r\nfrom .models import Article\r\nfrom dailyblog import celery_app\r\n\r\n\r\n@celery_app.task\r\ndef incr_readtimes(article_id):\r\n    return Article.objects.filter(id=article_id).update(read_times=F('read_times') + 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae9084342443-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae9084342443-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae9084342443-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae9084342443-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae9084342443-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae9084342443-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae9084342443-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58ae9084342443-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58ae9084342443-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae9084342443-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">models </span><span class=\"crayon-i\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">F</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae9084342443-2\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae9084342443-3\"><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">models </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Article</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae9084342443-4\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">dailyblog </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">_</span>app</div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae9084342443-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae9084342443-6\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae9084342443-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">celery_app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58ae9084342443-8\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">incr_readtimes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">article_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58ae9084342443-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Article</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">objects</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">article_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">read_times</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">F</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'read_times'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>这里面添加了一个任务。任务可以通过delay方法执行，也可以周期性地执行。</p>\n<h4>这里还需要注意，如果把上面任务的返回值赋值给一个变量，那么程序也会被阻塞，需要等待异步任务返回的结果。因此，实际应用不需要赋值。</h4>\n<p>上面的代码写好后，要执行数据库更新：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58aec904421499\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npython manage.py makemigrations\r\npython manage.py migrate.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58aec904421499-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58aec904421499-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58aec904421499-1\"><span class=\"crayon-e\">python </span><span class=\"crayon-v\">manage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-e\">makemigrations</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58aec904421499-2\"><span class=\"crayon-e\">python </span><span class=\"crayon-v\">manage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">migrate</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>Django会创建了几个数据库，分别为：</p>\n<p>Crontabs Intervals Periodic tasks Tasks Workers</p>\n<p>在views.py添加异步任务：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58af0812008950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom .tasks import incr_readtimes\r\nclass ArticleDetailView(BaseMixin,DetailView):\r\n\r\n\r\n    def get(self, request, *args, **kwargs):\r\n        .......\r\n         incr_readtimes.delay(self.object.id)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af0812008950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af0812008950-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af0812008950-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af0812008950-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af0812008950-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af0812008950-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af0812008950-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58af0812008950-1\"><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">incr_readtimes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af0812008950-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ArticleDetailView</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BaseMixin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">DetailView</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af0812008950-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af0812008950-4\"> </div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af0812008950-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af0812008950-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af0812008950-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">incr_readtimes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>这里不需要赋值。</p>\n<p>下面要启动celery，我采用supervisor进程管理器来管理celery：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58af3643117795\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[program:celery]\r\ncommand= celery -A dailyblog worker --loglevel=INFO\r\ndirectory=/srv/dailyblog/www/\r\nnumprocess=1\r\nstartsecs=0\r\nstopwaitsecs=0\r\nautostart=true\r\nautorestart=true\r\nstdout_logfile=/tmp/celery.log\r\nstderr_logfile=/tmp/celery.err</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af3643117795-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af3643117795-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af3643117795-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af3643117795-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af3643117795-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af3643117795-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af3643117795-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af3643117795-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af3643117795-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599d7a6d58af3643117795-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58af3643117795-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">program</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af3643117795-2\"><span class=\"crayon-v\">command</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dailyblog </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">INFO</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af3643117795-3\"><span class=\"crayon-v\">directory</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">srv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dailyblog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af3643117795-4\"><span class=\"crayon-v\">numprocess</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af3643117795-5\"><span class=\"crayon-v\">startsecs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af3643117795-6\"><span class=\"crayon-v\">stopwaitsecs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af3643117795-7\"><span class=\"crayon-v\">autostart</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af3643117795-8\"><span class=\"crayon-v\">autorestart</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-599d7a6d58af3643117795-9\"><span class=\"crayon-v\">stdout_logfile</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599d7a6d58af3643117795-10\"><span class=\"crayon-v\">stderr_logfile</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">celery</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">err</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>重新加载supervisor.conf文件，然后启动celery：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599d7a6d58af6834894945\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsupervisorctl start celery</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599d7a6d58af6834894945-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599d7a6d58af6834894945-1\"><span class=\"crayon-e\">supervisorctl </span><span class=\"crayon-e\">start </span><span class=\"crayon-v\">celery</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>至此，通过celery异步执行任务的程序写完了。除此之外，还可以写很多的异步任务，发邮件就是非常典型的一种。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d492771709a2a1ff32b54de94250ff2a.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/e0122cdbf3b649485d59a488e4b3599d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88276\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88276votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88276\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2721409931\">王海波</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2721409931\">\r\n\t\t\t<img src=\"http://tp4.sinaimg.cn/2721409931/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            热爱Python，希望能一直做自己热爱的事！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2721409931\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/2721409931/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2721409931/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://101.200.63.158\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2721409931\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：393993705\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>",
    "tags": "实践项目,Celery,Django,异步任务",
    "article_url": "http://python.jobbole.com/88276/",
    "url_object_id": "55a1799380a9aa33f7840607cdb9cd4d",
    "front_image_url": [
        "http://jbcdn2.b0.upaiyun.com/2015/04/736ee31682cb9cda71540b94b492eb06.jpg"
    ]
}
